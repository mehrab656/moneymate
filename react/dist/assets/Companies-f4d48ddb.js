import{r as s,j as e,F as M,a as n,y as se,z as ie,S as ce,A as de,B as me,d as ue}from"./index-8e1ee696.js";import{M as Y,ae as pe,K as he}from"./index-74298ed0.js";import{M as C}from"./Modal-bc712426.js";import{C as ge,R as x,a as m,b as B,n as j,d as Ce}from"./AuthRoutes-2e952a6b.js";import{C as ye}from"./CommonTable-27ef35ac.js";import{C as fe}from"./Card-e4e45dfb.js";import{S as be}from"./Stack-0f0f80e9.js";import{F as r}from"./Form-833e738d.js";import{e as $}from"./index-dc02ab6d.js";import{W as xe}from"./WizCard-c3a4d722.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./TableRow-3c1023d1.js";import"./jsx-runtime_commonjs-proxy-221d5456.js";import"./isMuiElement-18bae589.js";import"./useId-bebd534a.js";import"./useControlled-c67091af.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./CardContent-2022634c.js";import"./Typography-e228ba3d.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./LastPage-4ffce3d8.js";import"./CardHeaderContext-cb83d0a9.js";import"./classCallCheck-25f3f0e0.js";const Ne=({showModal:h,handelCloseModal:g,title:t,data:a})=>e(M,{children:n(C,{show:!0,centered:!0,onHide:g,className:"custom-modal modal-lg",children:[e(C.Header,{closeButton:!0,children:e(C.Title,{children:e("span",{children:t})})}),e(C.Body,{children:n(ge,{children:[n(x,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Company Details"}),n(m,{xs:12,md:6,children:[e("strong",{children:"Name: "}),a.name]}),n(m,{xs:12,md:4,children:[e("strong",{children:"Email: "}),a.email]}),n(m,{xs:12,md:4,children:[e("strong",{children:"Phone: "}),a.phone]})]}),n(x,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"License Details"}),n(m,{xs:6,md:6,children:[e("strong",{children:"Bank Name: "}),a==null?void 0:a.license_no]}),n(m,{xs:12,md:6,children:[e("strong",{children:"Registration Number: "}),a==null?void 0:a.registration_number]})]}),n(x,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Description"}),n(m,{xs:6,md:6,children:[e("strong",{children:"Issue date: "}),a==null?void 0:a.issue_date]}),n(m,{xs:6,md:6,children:[e("strong",{children:"Expiry date: "}),a==null?void 0:a.expiry_date]})]}),n(x,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Others"}),n(m,{xs:6,md:6,children:[e("strong",{children:"Note: "}),a==null?void 0:a.extra]})]})]})}),e(C.Footer,{children:e("button",{className:"btn btn-primary",onClick:g,children:"Close"})})]})}),we=s.memo(Ne);function _e(h){const{search:g,query:t,setQuery:a,resetFilterParameter:i,placeHolderTxt:L}=h;return e(M,{children:e(fe,{className:"p-3",style:{borderBottom:"1px solid"},children:n(be,{gap:3,children:[n(x,{className:"g-3",children:[e(m,{md:4,children:n(r.Group,{controlId:"search",children:[e(r.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Search"}),e(r.Control,{type:"text",size:"sm",value:t==null?void 0:t.searchTerm,onChange:y=>a({...t,searchTerm:y.target.value}),placeholder:L,style:{textTransform:"capitalize"}})]})}),e(m,{md:2,children:n(r.Group,{controlId:"order",children:[e(r.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Order"}),n(r.Select,{size:"sm",value:t.orderBy,onChange:y=>a({...t,orderBy:y.target.value}),children:[e("option",{value:"ASC",children:"Ascending"}),e("option",{value:"DESC",children:"Descending"})]})]})}),e(m,{md:2,children:n(r.Group,{controlId:"limit",children:[e(r.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Limit"}),n(r.Select,{size:"sm",value:t.limit,onChange:y=>a({...t,limit:y.target.value}),children:[e("option",{value:"",children:"Limit"}),e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"50",children:"50"}),e("option",{value:"100",children:"100"}),e("option",{value:"500",children:"500"})]})]})})]}),e(x,{className:"justify-content-end",children:e(m,{md:4,className:"text-end",children:e(B,{variant:"warning",size:"sm",onClick:i,children:"Reset"})})})]})})})}const b=["vacation homes rental","grocery","real estate","printing","shop","restaurant","super shop","cleaning service","management service"],U={id:null,name:null,phone:null,email:null,address:null,activity:null,license_no:null,issue_date:null,expiry_date:null,registration_number:null,logo:null};function ve({handelCloseModal:h,id:g}){var w;const[t,a]=s.useState(U),[i,L]=s.useState({}),[y,O]=s.useState(!1),{data:N,isFetching:E,isError:D}=se({id:g}),[P]=ie();s.useEffect(()=>{g&&N&&a(o=>({...o,...N,date:N.date||""}))},[N]),s.useEffect(()=>{(t==null?void 0:t.date)===""&&a({...t,date:new Date().toISOString().split("T")[0]})},[t==null?void 0:t.date]);const F=async(o,d)=>{o.preventDefault();const{name:l,phone:T,email:G,address:I,activity:k,license_no:_,issue_date:z,expiry_date:Q,registration_number:H,logo:v}=t;let u=new FormData;u.append("name",l),u.append("phone",T),u.append("email",G),u.append("address",I),u.append("activity",k),u.append("license_no",_),u.append("issue_date",z),u.append("expiry_date",Q),u.append("registration_number",H),u.append("logo",v);const f=t.id?`/company/update/${t==null?void 0:t.id}`:"/addCompany";try{const c=await P({url:f,formData:u}).unwrap();j("success",c==null?void 0:c.message,c==null?void 0:c.description),d?a(U):h()}catch(c){j("error",(c==null?void 0:c.message)||"An error occurred",(c==null?void 0:c.description)||"Please try again later.")}},A=o=>{const d=o.target.files[0];a(l=>({...l,logo:d}))};return e(M,{children:n(C,{show:!0,centered:!0,onHide:h,backdrop:"static",keyboard:!1,size:"lg",children:[e(C.Header,{closeButton:!0,children:e(C.Title,{children:n("span",{children:[g?"Update":"Add"," Company"]})})}),n(C.Body,{children:[e(Y,{loaderVisible:y}),e(xe,{className:"animated fadeInDown",children:n(r,{children:[n(x,{children:[n(m,{md:6,children:[n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Name"}),e(r.Control,{type:"text",value:t.name===null?"":t.name,onChange:o=>a({...t,name:o.target.value}),placeholder:"Company Name. ig: ABC company"}),i.name&&e("p",{className:"error-message mt-2",children:i.name[0]})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Phone"}),e(r.Control,{type:"number",value:t.phone===null?"":t.phone,onChange:o=>a({...t,phone:o.target.value}),placeholder:"Phone. ig: +971... or 0567..."}),i.phone&&e("p",{className:"error-message mt-2",children:i.phone[0]})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Email"}),e(r.Control,{type:"email",value:t.email===null?"":t.email,onChange:o=>a({...t,email:o.target.value}),placeholder:"Email. ig: abc@...com"}),i.email&&e("p",{className:"error-message mt-2",children:i.email[0]})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Address"}),e(r.Control,{type:"text",value:t.address===null?"":t.address,onChange:o=>a({...t,address:o.target.value}),placeholder:"Address. Area: abc, Flat:#33..."}),i.address&&e("p",{className:"error-message mt-2",children:i.address[0]})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Activity"}),n(r.Select,{value:((w=t.activity)==null?void 0:w.toLowerCase())||"",onChange:o=>a({...t,activity:o.target.value}),children:[e("option",{value:"",children:"Select Activity"}),b&&(b==null?void 0:b.length)>0&&(b==null?void 0:b.map(o=>e("option",{value:o,children:o.toUpperCase()},o)))]}),i.user_id&&e("p",{className:"text-danger mt-2",children:i.user_id[0]})]})]}),n(m,{md:6,children:[n(r.Group,{className:"mb-3",children:[e(r.Label,{children:" License No."}),e(r.Control,{type:"text",value:t.license_no===null?"":t.license_no,onChange:o=>a({...t,license_no:o.target.value}),placeholder:"License Number"})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:" Registration No."}),e(r.Control,{type:"text",value:t.registration_number!=="null"?t.registration_number:"",onChange:o=>a({...t,registration_number:o.target.value}),placeholder:"Registration Number"})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Issue Date"}),e($,{className:"form-control",selected:t.issue_date?new Date(t.issue_date):new Date,onChange:o=>{const d=o?new Date(o):null,l=d&&!t.issue_date?new Date(d.getTime()+24*60*60*1e3):d;a({...t,issue_date:l?l.toISOString().split("T")[0]:""})},dateFormat:"yyyy-MM-dd"}),i.issue_date&&e("p",{className:"error-message mt-2",children:i.issue_date[0]})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Expiry Date"}),e($,{className:"form-control",selected:t.expiry_date?new Date(t.expiry_date):new Date,onChange:o=>{const d=o?new Date(o):null,l=d&&!t.expiry_date?new Date(d.getTime()+24*60*60*1e3):d;a({...t,expiry_date:l?l.toISOString().split("T")[0]:""})},dateFormat:"yyyy-MM-dd"}),i.expiry_date&&e("p",{className:"error-message mt-2",children:i.expiry_date[0]})]}),n(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Logo"}),e(r.Control,{type:"file",onChange:A,placeholder:"Company Logo"})]})]})]}),e("div",{className:"text-end",children:t.id?e(B,{variant:"warning",onClick:o=>F(o,!1),children:"Update"}):n(M,{children:[e(B,{variant:"primary",onClick:o=>F(o,!0),className:"me-2",children:"Save"}),e(B,{variant:"secondary",onClick:o=>F(o,!1),children:"Save and Exit"})]})})]})})]})]})})}const Se={id:null,name:null,phone:null,email:null,address:null,activity:null,license_no:null,issue_date:null,expiry_date:null,registration_number:null,extra:null,logo:null},W={searchTerm:"",orderBy:"DESC",limit:10};function tt(){const[h,g]=s.useState(1),[t,a]=s.useState(0),{applicationSettings:i,userRole:L,userPermission:y}=s.useContext(ce),[O,N]=s.useState([]),[E,D]=s.useState(Se),[P,F]=s.useState(!0),[A,w]=s.useState(!1),[o,d]=s.useState(!1),[l,T]=s.useState(W),[G,I]=s.useState(!1),[k,_]=s.useState(!1),{num_data_per_page:z,default_currency:Q}=i,H=[{id:"name",label:"Name",align:"left"},{id:"phone",label:"Phone",align:"left"},{id:"issue_date",label:"Issue Date",align:"left"},{id:"license_no",label:"License No.",align:"left"},{id:"activity",label:"Activity",align:"left"}],v=z,u=Math.ceil(t/v),{data:f,isFetching:c,isError:Le}=de({currentPage:h,pageSize:v,query:l},{skip:!v,refetchOnMountOrArgChange:o}),[K]=me();s.useEffect(()=>{document.title="Company List",f!=null&&f.data?(N(f.data),a(f.total),w(!1)):w(!0),d(!1)},[f,h]);const J=()=>{T(W),I(!G)},X=()=>e(_e,{placeHolderTxt:"Search by name...",query:l,setQuery:T,resetFilterParameter:J}),Z=O.filter(p=>p.name.toLowerCase().includes(l.searchTerm.toLowerCase())||p.email.toLowerCase().includes(l.searchTerm.toLowerCase())||p.license_no.toLowerCase().includes(l.searchTerm.toLowerCase())||p.phone.toLowerCase().includes(l.searchTerm.toLowerCase())||p.activity.toLowerCase().includes(l.searchTerm.toLowerCase())),q=p=>{D(p),V(!0)},[ee,V]=s.useState(!1),te=()=>{V(!1)},ne=(p,R)=>{g(R),d(!0)},ae=()=>{_(!0)},re=p=>{_(!0),D(p)},oe=()=>{_(!1),D({})},le=[{actionName:"Edit",type:"modal",route:"",actionFunction:re,permission:"company_edit",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:q,permission:"company_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:async p=>{ue.fire({title:"Are you sure?",text:`You won't be able to revert the deletion of company ${p.name}!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async R=>{if(R.isConfirmed)try{const S=await K({id:p.uid}).unwrap();notification("success",S.message,S.description)}catch(S){notification("error",S.data.message,S.data.description||"An error occurred.")}})},permission:"company_delete",textClass:"text-danger"}];return n("div",{children:[e(Y,{loaderVisible:A}),e(ye,{cardTitle:"List of Companies",addBTN:{permission:Ce("company_create"),txt:"Create New",icon:e(pe,{icon:he}),linkTo:"modal",link:ae},paginations:{totalPages:u,totalCount:t,currentPage:h,handlePageChange:ne},table:{size:"small",ariaLabel:"company table",showIdColumn:L==="admin",tableColumns:H,tableBody:{loading:P,loadingColSpan:6,rows:Z},actionButtons:le},filter:X,loading:c,loaderRow:l==null?void 0:l.limit,loaderCol:5}),ee&&e(we,{handelCloseModal:te,title:"Company Details",data:E}),k&&e(ve,{handelCloseModal:oe,title:"Create New Company",id:E.id})]})}export{tt as default};
