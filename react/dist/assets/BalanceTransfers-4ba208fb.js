import{r as n,S as $,e as ee,j as t,a,F as te,L as ae,m as v}from"./index-8e1ee696.js";import{W as ne}from"./WizCard-c3a4d722.js";import{e as oe}from"./index-dc02ab6d.js";import{P as p}from"./Pagination-982a907e.js";import{M as se,ae as re,aw as ce}from"./index-74298ed0.js";import{M as u}from"./Modal-bc712426.js";import{b as D}from"./AuthRoutes-2e952a6b.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./classCallCheck-25f3f0e0.js";function be(){const[c,i]=n.useState({from_account_id:"",to_account_id:"",amount:"",transfer_date:null,note:""}),{applicationSettings:L,userRole:T}=n.useContext($),{num_data_per_page:F,default_currency:H}=L,[r,k]=n.useState({}),[P,E]=n.useState(""),[j,z]=n.useState(""),[w,V]=n.useState([]),[d,g]=n.useState(null),[b,o]=n.useState(!0),[O,W]=n.useState([]),[l,R]=n.useState(1),[U,q]=n.useState(0),[h,G]=n.useState(""),x=e=>{g(e)},{setNotification:J}=ee(),[y,A]=n.useState([]),[K,_]=n.useState(!1),Q=()=>{i({from_account_id:"",to_account_id:"",amount:"",transfer_date:null,note:""}),k({}),_(!0),A([])},B=()=>{_(!1)},X=()=>{o(!0),v.get("/all-bank-account").then(({data:e})=>{V(e.data),o(!1)}).catch(e=>{console.warn("Error fetching bank accounts:",e),o(!1)})},N=F,C=Math.ceil(U/N),Y=O.filter(e=>e.amount.toLowerCase().includes(h.toLowerCase())||e.from_account.toLowerCase().includes(h.toLowerCase())||e.to_account.toLowerCase().includes(h.toLowerCase())),I=(e,s)=>{o(!0),v.get("/transfer/histories",{params:{page:e,pageSize:s}}).then(({data:m})=>{W(m.data),q(m.total),o(!1)}).catch(m=>{console.warn("Unable to fetch transfer histories",m),o(!1)}).finally(()=>{o(!1)})};n.useEffect(()=>{document.title="Balance Transfer",I(l,N),X()},[l,N]);const S=e=>{R(e)},M=[];for(let e=1;e<=C;e++)M.push(t(p.Item,{active:e===l,onClick:()=>S(e),children:e},e));n.useEffect(()=>{d===null&&g(new Date)},[d]);const Z=e=>{e.preventDefault(),o(!0);const s={...c,transfer_date:d?new Date(d.getTime()-d.getTimezoneOffset()*6e4).toISOString().split("T")[0]:null};v.post("/bank-accounts/transfer-amount",s).then(()=>{i({from_account_id:"",to_account_id:"",amount:"",transfer_date:null,note:""}),g(null),I(),_(!1),J("Account transfer has been done"),o(!1)}).catch(m=>{const f=m.response;f&&f.status===422?k(f.data.errors):A(f.data.message),o(!1)})};return a(te,{children:[t(se,{loaderVisible:b}),a("div",{className:"d-flex justify-content-between align-content-center gap-2 mb-3",children:[t("h1",{className:"title-text mb-0",children:"Transfer Histories"}),t("div",{children:a(ae,{className:"custom-btn btn-add",onClick:Q,children:[t(re,{icon:ce})," Make a transfer"]})})]}),a(ne,{className:"animated fadeInDown",children:[t("div",{className:"mb-4",children:t("input",{className:"custom-form-control",type:"text",placeholder:"Search Transfer...",value:h,onChange:e=>G(e.target.value)})}),t("div",{className:"table-responsive-sm",children:a("table",{className:"table table-bordered custom-table",children:[t("thead",{children:a("tr",{className:"text-center",children:[T==="admin"&&t("th",{children:"id"}),t("th",{children:"From Account"}),t("th",{children:"To Account"}),t("th",{children:"Transferred Amount"}),t("th",{children:"Transfer Date"}),t("th",{children:"Note"})]})}),b&&t("tbody",{children:t("tr",{children:a("td",{colSpan:5,className:"text-center",children:[" ","Loading..."]})})}),!b&&t("tbody",{children:Y.map(e=>a("tr",{className:"text-center",children:[T==="admin"&&t("td",{children:e.id}),t("td",{children:e.from_account}),t("td",{children:e.to_account}),a("td",{children:[H,e.amount]}),t("td",{children:e.transfer_date}),t("td",{children:e.note})]},e.id))})]})}),C>1&&a(p,{children:[t(p.Prev,{disabled:l===1,onClick:()=>S(l-1)}),M,t(p.Next,{disabled:l===C,onClick:()=>S(l+1)})]}),a(u,{show:K,centered:!0,onHide:B,className:"custom-modal",children:[t(u.Header,{closeButton:!0,children:t(u.Title,{children:t("span",{className:"title-text",children:"Balance Transfer"})})}),a(u.Body,{children:[a("div",{className:"form-group",children:[t("label",{className:"custom-form-label",children:"From Account"}),a("select",{className:"custom-form-control",value:P,id:"from-bank-account",name:"form_account_id",onChange:e=>{const s=e.target.value||"";E(s),i({...c,from_account_id:parseInt(s)})},children:[t("option",{defaultValue:!0,children:"Select a bank account"}),w.map(e=>a("option",{value:e.id,children:[e.bank_name," - ",e.account_number," - Balance (",e.balance,")"]},e.id))]}),r.from_account_id&&t("p",{className:"error-message mt-2",children:r.from_account_id[0]})]}),a("div",{className:"form-group",children:[t("label",{className:"custom-form-label",children:"To Account ID:"}),a("select",{className:"custom-form-control",value:j,id:"to-bank-account",name:"to_account_id",onChange:e=>{const s=e.target.value||"";z(s),i({...c,to_account_id:parseInt(s)})},children:[t("option",{defaultValue:!0,children:"Select a bank account"}),w.map(e=>a("option",{value:e.id,children:[e.bank_name," - ",e.account_number," - Balance (",e.balance,")"]},e.id))]}),r.to_account_id&&t("p",{className:"error-message mt-2",children:r.to_account_id[0]})]}),a("div",{className:"form-group",children:[t("label",{className:"custom-form-label",children:"Amount:"}),t("input",{className:"custom-form-control",type:"number",name:"amount",value:c.amount,onChange:e=>i({...c,amount:e.target.value})}),r.amount&&t("p",{className:"error-message mt-2",children:r.amount[0]})]}),a("div",{className:"form-group",children:[t("label",{className:"custom-form-label",children:"Transfer Date:"}),t(oe,{className:"custom-form-control",selected:d,onChange:x,onSelect:x,dateFormat:"yyyy-MM-dd",placeholderText:"Transfer Date"}),r.transfer_date&&t("p",{className:"error-message mt-2",children:r.transfer_date[0]})]}),a("div",{className:"form-group",children:[t("label",{className:"custom-form-label",children:"Note:"}),t("input",{className:"custom-form-control",type:"text",name:"note",value:c.note,onChange:e=>i({...c,note:e.target.value})})]}),y&&t("p",{className:"error-message mt-2",children:y})]}),a(u.Footer,{children:[t(D,{className:"btn-sm",variant:"primary",onClick:Z,children:"Transfer Amount"}),t(D,{className:"btn-sm",variant:"secondary",onClick:B,children:"Close"})]})]})]})]})}export{be as default};
