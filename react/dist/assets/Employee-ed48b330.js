import{af as ne,r,m as I,a as l,F as oe,j as e,S as le,d as ie}from"./index-8e1ee696.js";import{M as R}from"./index-74298ed0.js";import{C as se,R as y,a as m,b as A,n as E,d as re}from"./AuthRoutes-2e952a6b.js";import{I as ce}from"./Iconify-5a94efd0.js";import{C as me}from"./CommonTable-27ef35ac.js";import{T as de}from"./TaskFilters-e7de5f81.js";import{M as L}from"./Modal-bc712426.js";import{F as t}from"./Form-833e738d.js";import{I as pe}from"./Image-bab1f910.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./TableRow-3c1023d1.js";import"./jsx-runtime_commonjs-proxy-221d5456.js";import"./isMuiElement-18bae589.js";import"./useId-bebd534a.js";import"./useControlled-c67091af.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./CardContent-2022634c.js";import"./Typography-e228ba3d.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./LastPage-4ffce3d8.js";import"./TextField-029e5f7c.js";import"./FormLabel-e3756905.js";import"./utils-a73c94d0.js";import"./useFormControl-e95281cb.js";import"./Select-2ff9a889.js";const k={first_name:"",last_name:"",user_name:"",dob:"",gender:"",email:"",phone:"",emergency_contact:"",joining_date:"",role_id:"",position:"",basic_salary:"",accommodation_cost:"",profile_picture:"",id_copy:""};function ue({show:b,closeFunc:C}){let{id:v}=ne();const[o,i]=r.useState(k),[a,S]=r.useState({}),[T,g]=r.useState(!1),[F,G]=r.useState([]),x=(n,s)=>{const h=n.target.files[0];i(c=>s==="id_copy"?{...c,id_copy:h}:{...c,profile_picture:h})};r.useEffect(()=>{g(!0),I.get("/roles-by-company").then(({data:n})=>{g(!1),G(n.data)}).catch(()=>{g(!1)})},[]);const N=n=>{n.preventDefault(),g(!0);let s=new FormData;s.append("first_name",o.first_name),s.append("last_name",o.last_name),s.append("user_name",o.user_name),s.append("dob",o.dob),s.append("gender",o.gender),s.append("email",o.email),s.append("phone",o.phone),s.append("emergency_contact",o.emergency_contact),s.append("joining_date",o.joining_date),s.append("position",o.position),s.append("role_id",o.role_id),s.append("basic_salary",o.basic_salary),s.append("accommodation_cost",o.accommodation_cost),s.append("profile_picture",o.profile_picture),s.append("id_copy",o.id_copy);const h=v?`/employee/${v}`:"/employee/add";I.post(h,s,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:c})=>{E("success",c==null?void 0:c.message,c==null?void 0:c.description),i(k),S({}),C(),g(!1)}).catch(c=>{if(c.response){const _=c.response.data;E("error",_==null?void 0:_.message,_.description),S(_.errors)}g(!1)})};return l(oe,{children:[e(R,{loaderVisible:T}),l(L,{show:b,onHide:C,backdrop:"static",keyboard:!1,size:"lg",children:[e(L.Header,{closeButton:!0,children:e(L.Title,{children:"Add new Employee"})}),e(L.Body,{children:e(se,{children:l(t,{children:[l(y,{children:[e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"first_name",children:[e(t.Label,{children:"First Name"}),e(t.Control,{type:"text",value:o.first_name,name:"first_name",onChange:n=>{i({...o,first_name:n.target.value})}}),(a==null?void 0:a.first_name)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.first_name[0]})]})}),e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"last_name",children:[e(t.Label,{children:"Last Name"}),e(t.Control,{type:"text",rows:3,value:o.last_name,name:"last_name",onChange:n=>{i({...o,last_name:n.target.value})}}),(a==null?void 0:a.last_name)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.last_name[0]})]})})]}),l(y,{children:[e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"user_name",children:[e(t.Label,{children:"User Name"}),e(t.Control,{type:"text",rows:3,value:o.user_name,name:"user_name",onChange:n=>{i({...o,user_name:n.target.value})}}),(a==null?void 0:a.user_name)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.user_name[0]})]})}),e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"email",children:[e(t.Label,{children:"E-mail"}),e(t.Control,{type:"email",rows:3,value:o.email,name:"email",onChange:n=>{i({...o,email:n.target.value})}}),(a==null?void 0:a.email)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.email[0]})]})})]}),l(y,{children:[e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"dob",children:[e(t.Label,{children:"Date Of Birth"}),e(t.Control,{type:"date",rows:3,value:o.dob,name:"dob",onChange:n=>{i({...o,dob:n.target.value})}})]})}),e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"gender",children:[e(t.Label,{children:"Gender"}),l(t.Select,{"aria-label":"gender",onChange:n=>{i({...o,gender:n.target.value})},children:[e("option",{defaultValue:!0,children:"Select Gender"}),e("option",{value:"male",children:"Male"}),e("option",{value:"female",children:"Female"})]})]})})]}),e("hr",{className:"border-danger"}),l(y,{children:[e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"phone",children:[e(t.Label,{children:"Phone"}),e(t.Control,{type:"text",rows:3,value:o.phone,name:"phone",onChange:n=>{i({...o,phone:n.target.value})}}),(a==null?void 0:a.phone)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.phone[0]})]})}),e(m,{xs:12,md:6,children:l(t.Group,{className:"mb-3",controlId:"emergency_contact",children:[e(t.Label,{children:"Emergency Contact"}),e(t.Control,{type:"text",rows:3,value:o.emergency_contact,name:"emergency_contact",autoFocus:!0,className:"border-none",onChange:n=>{i({...o,emergency_contact:n.target.value})}})]})})]}),e("hr",{className:"border-danger"}),e(y,{children:e(m,{xs:12,md:12,lg:12,sm:12,children:l(t.Group,{className:"mb-3",controlId:"role_id",children:[e(t.Label,{children:"Employee Role"}),l(t.Select,{"aria-label":"Task Type",onChange:n=>{i({...o,role_id:n.target.value})},children:[e("option",{defaultValue:!0,children:"Select Role"}),F.length>0?F.map(n=>e("option",{value:n.id,children:n.role},n.id)):e("option",{defaultValue:!0,children:"Select Role"})]}),(a==null?void 0:a.role_id)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.role_id[0]})]})})}),e("hr",{className:"border-danger"}),l(y,{children:[e(m,{xs:12,md:3,lg:3,sm:12,children:l(t.Group,{className:"mb-3",controlId:"joining_date",children:[e(t.Label,{children:"Joining Date"}),e(t.Control,{type:"date",value:o.joining_date,onChange:n=>{i({...o,joining_date:n.target.value})}}),(a==null?void 0:a.joining_date)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.joining_date[0]})]})}),e(m,{xs:12,md:3,lg:3,sm:12,children:l(t.Group,{className:"mb-3",controlId:"position",children:[e(t.Label,{children:"Designation"}),l(t.Select,{"aria-label":"Task Type",onChange:n=>{i({...o,position:n.target.value})},children:[e("option",{defaultValue:!0,children:"Select Designation"}),e("option",{value:"supervisor",children:"Supervisor"}),e("option",{value:"cleaner",children:"Cleaner"}),e("option",{value:"driver",children:"Driver"}),e("option",{value:"hr",children:"HR"}),e("option",{value:"intern",children:"Intern"}),e("option",{value:"accountant",children:"Accountant"}),e("option",{value:"investor",children:"Investor"}),e("option",{value:"others",children:"Others"})]}),(a==null?void 0:a.position)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.position[0]})]})}),e(m,{xs:12,md:3,lg:3,sm:12,children:l(t.Group,{className:"mb-3",controlId:"basic_salary",children:[e(t.Label,{children:" Basic Salary"}),e(t.Control,{type:"number",placeholder:"i.g: 50 AED",autoFocus:!0,onChange:n=>{i({...o,basic_salary:n.target.value})}}),(a==null?void 0:a.basic_salary)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.basic_salary[0]})]})}),e(m,{xs:12,md:3,lg:3,sm:12,children:l(t.Group,{className:"mb-3",controlId:"accommodation_cost",children:[e(t.Label,{children:" Accommodation Cost"}),e(t.Control,{type:"number",placeholder:"i.g: 1500 AED",autoFocus:!0,onChange:n=>{i({...o,accommodation_cost:n.target.value})}}),(a==null?void 0:a.accommodation_cost)&&e("small",{className:"error-message mt-2",children:a==null?void 0:a.accommodation_cost[0]})]})})]}),e("hr",{className:"border-danger"}),l(y,{children:[e(m,{xs:12,md:6,lg:6,sm:12,children:l(t.Group,{className:"mb-3",controlId:"profile_picture",children:[e(t.Label,{children:" Profile Picture"}),e(t.Control,{type:"file",onChange:n=>x(n,"profile_picture")})]})}),e(m,{xs:12,md:6,lg:6,sm:12,children:l(t.Group,{className:"mb-3",controlId:"id_copy",children:[e(t.Label,{children:" Identity copy"}),e(t.Control,{type:"file",onChange:n=>x(n,"id_copy")})]})})]})]})})}),l(L.Footer,{children:[e(A,{variant:"danger",onClick:C,children:"Close"}),e(A,{variant:"primary",onClick:n=>N(n),children:"Add Employee"})]})]})]})}const he={name:"",email:"",phone:"",dob:"",gender:"",emergency_contact:"",joining_date:"",role_id:"",position:"",basic_salary:"",accommodation_cost:"",profile_picture:"",id_copy:"",avatar:""},V={employee_id:"",status:"",payment_status:"",orderBy:"",order:"",limit:"",category_id:"",end_date:"",start_date:""};function Je(){const[b,C]=r.useState(1),[v,o]=r.useState(0),[i,a]=r.useState(""),{applicationSettings:S,userRole:T,userPermission:g}=r.useContext(le),[F,G]=r.useState([]);r.useState(he);const[x,N]=r.useState(!0),[n,s]=r.useState(!1),[h,c]=r.useState(V),{num_data_per_page:_}=S,[M,P]=r.useState(!1),U=[{id:"avatar",label:"Avatar",align:"left"},{id:"name",label:"Name",align:"left"},{id:"phone",label:"Phone",align:"left"},{id:"position",label:"Designation",align:"left"},{id:"joining_date",label:"Joined",align:"left"}],B=Number(h.limit)>0?Number(h.limit):_,H=Math.ceil(v/B),O=F.filter(d=>d.name.toLowerCase().includes(i.toLowerCase())||d.position.toLowerCase().includes(i.toLowerCase())||d.phone.toLowerCase().includes(i.toLowerCase())||d.emergency_contact.toLowerCase().includes(i.toLowerCase())).map(({id:d,name:f,accommodation_cost:p,attachment:w,basic_salary:X,emergency_contact:Z,joining_date:ee,phone:ae,position:j,avatar:te},_e)=>{const u={};return u.id=d,u.name=f.charAt(0).toUpperCase()+f.slice(1),u.accommodation_cost=p,u.basic_salary=X,u.emergency_contact=Z,u.joining_date=ee,u.phone=ae,u.position=j.charAt(0).toUpperCase()+j.slice(1),u.avatar=e(pe,{src:te,roundedCircle:!0,style:{height:"40px",width:"40px"}}),u}),z=d=>{ie.fire({title:"Are you sure?",text:"You will not be able to recover the employee !",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, remove it!",cancelButtonText:"Cancel"}).then(f=>{f.isConfirmed&&I.delete(`employee/${d.id}`).then(p=>{D(),E("success",p==null?void 0:p.message,p==null?void 0:p.description)}).catch(p=>{if(p.response){const w=p.response.data;E("error",w==null?void 0:w.message,w.description)}})})},$=()=>{s(!0)},J=()=>{s(!1)},D=()=>{N(!0),I.get("/all-employees",{params:{currentPage:b,pageSize:B,...h}}).then(({data:d})=>{N(!1),G(d.data),o(d.total)}).catch(()=>{N(!1)})};r.useEffect(()=>{document.title="Manage employees",D()},[b,B,M]);const Q=(d,f)=>{C(f)},Y=()=>{c(V),P(!M)},q=()=>{P(!M)},K=()=>e(de,{search:{filterByText:!0,placeHolderTxt:"Search employee...",searchBoxValue:i,handelSearch:a},query:h,setQuery:c,resetFilterParameter:Y,getTask:D,handelFilter:q}),W=[{actionName:"Edit",type:"modal",route:"",actionFunction:"editModal",permission:"edit_employee",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:"showViewModalFunc",permission:"employee_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:z,permission:"employee_delete",textClass:"text-danger"},{actionName:"Update Status",type:"modal",route:"",actionFunction:"showStatusModalFunc",permission:"employee_change_status",textClass:"text-primary"},{actionName:"Update Payment",type:"modal",route:"",actionFunction:"showPaymentModalFunc",permission:"employee_change_payment_status",textClass:"text-info"}];return l("div",{children:[e(R,{loaderVisible:x}),e(me,{cardTitle:"List of employees",addBTN:{permission:re("employee_create"),txt:"Add New employee",icon:e(ce,{icon:"eva:plus-fill"}),linkTo:"modal",link:$},paginations:{totalPages:H,totalCount:v,currentPage:b,handlePageChange:Q},table:{size:"small",ariaLabel:"employee table",showIdColumn:T==="admin",tableColumns:U,tableBody:{loading:x,loadingColSpan:7,rows:O},actionButtons:W},filter:K}),e(ue,{show:n,closeFunc:J})]})}export{Je as default};
