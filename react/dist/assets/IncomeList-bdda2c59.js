import{r as l,j as e,a as t,h as Ze,F as Z,Z as Je,G as Xe,$ as Me,a0 as Ve,a1 as Qe,S as qe,a2 as et,a3 as tt,d as at}from"./index-8e1ee696.js";import{h as Se,i as ke,j as ne,b as H,l as Ee,_ as Fe,c as we,m as xe,D as Ae,k as ce,o as ot,g as nt,ae as Q,am as be,an as lt,M as rt,ao as st,ap as ve}from"./index-74298ed0.js";import{c as ze,i as ct,u as it,r as Le,C as ie,R as V,a as y,b as ee,B as dt,j as mt,n as Y,H as ut}from"./AuthRoutes-2e952a6b.js";import{M as S}from"./Modal-bc712426.js";import{T as X,N as Ce}from"./Tab-e8b7d17a.js";import{I as q}from"./InputGroup-ffc38a75.js";import{m as ht,F as i}from"./Form-833e738d.js";import{S as oe}from"./react-select.esm-c00a6ec0.js";import{F as pt,a as ft}from"./FormLabel-e3756905.js";import{u as gt}from"./useControlled-c67091af.js";import{u as bt}from"./useId-bebd534a.js";import{u as vt,f as Ct}from"./useFormControl-e95281cb.js";import{F as re}from"./FormControlLabel-95d9d126.js";import{S as yt}from"./SwitchBase-353c16ce.js";import{m as Nt}from"./makeStyles-7d66d76c.js";import{F as St}from"./FilteredParameters-99083ecb.js";import{T as kt}from"./Table-9f2e03c0.js";import{A as Ft}from"./ActionButtonHelpers-3cc0c4c9.js";import{P as wt}from"./Pagination-fd6e0edf.js";import"./CardHeaderContext-cb83d0a9.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./classCallCheck-25f3f0e0.js";import"./toConsumableArray-46a81798.js";import"./utils-a73c94d0.js";import"./isMuiElement-18bae589.js";import"./Typography-e228ba3d.js";import"./Stack-7b3bc405.js";import"./Badge-ce00077f.js";import"./LastPage-4ffce3d8.js";function xt(o){return Se("MuiFormGroup",o)}ke("MuiFormGroup",["root","row","error"]);const It=["className","row"],_t=o=>{const{classes:r,row:c,error:a}=o;return xe({root:["root",c&&"row",a&&"error"]},xt,r)},Rt=ne("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(o,r)=>{const{ownerState:c}=o;return[r.root,c.row&&r.row]}})(({ownerState:o})=>H({display:"flex",flexDirection:"column",flexWrap:"wrap"},o.row&&{flexDirection:"row"})),Bt=l.forwardRef(function(r,c){const a=Ee({props:r,name:"MuiFormGroup"}),{className:n,row:p=!1}=a,_=Fe(a,It),w=vt(),m=Ct({props:a,muiFormControl:w,states:["error"]}),k=H({},a,{row:p,error:m.error}),I=_t(k);return e(Rt,H({className:we(I.root,n),ownerState:k,ref:c},_))}),Dt=Bt,$t=ze(e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Gt=ze(e("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Tt=ne("span",{shouldForwardProp:Ae})({position:"relative",display:"flex"}),Mt=ne($t)({transform:"scale(1)"}),Vt=ne(Gt)(({theme:o,ownerState:r})=>H({left:0,position:"absolute",transform:"scale(0)",transition:o.transitions.create("transform",{easing:o.transitions.easing.easeIn,duration:o.transitions.duration.shortest})},r.checked&&{transform:"scale(1)",transition:o.transitions.create("transform",{easing:o.transitions.easing.easeOut,duration:o.transitions.duration.shortest})}));function Pe(o){const{checked:r=!1,classes:c={},fontSize:a}=o,n=H({},o,{checked:r});return t(Tt,{className:c.root,ownerState:n,children:[e(Mt,{fontSize:a,className:c.background,ownerState:n}),e(Vt,{fontSize:a,className:c.dot,ownerState:n})]})}const Et=l.createContext(void 0),Ue=Et;function At(){return l.useContext(Ue)}function zt(o){return Se("MuiRadio",o)}const Lt=ke("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),_e=Lt,Pt=["checked","checkedIcon","color","icon","name","onChange","size","className"],Ut=o=>{const{classes:r,color:c,size:a}=o,n={root:["root",`color${ce(c)}`,a!=="medium"&&`size${ce(a)}`]};return H({},r,xe(n,zt,r))},Ot=ne(yt,{shouldForwardProp:o=>Ae(o)||o==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(o,r)=>{const{ownerState:c}=o;return[r.root,c.size!=="medium"&&r[`size${ce(c.size)}`],r[`color${ce(c.color)}`]]}})(({theme:o,ownerState:r})=>H({color:(o.vars||o).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:o.vars?`rgba(${r.color==="default"?o.vars.palette.action.activeChannel:o.vars.palette[r.color].mainChannel} / ${o.vars.palette.action.hoverOpacity})`:ot(r.color==="default"?o.palette.action.active:o.palette[r.color].main,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},r.color!=="default"&&{[`&.${_e.checked}`]:{color:(o.vars||o).palette[r.color].main}},{[`&.${_e.disabled}`]:{color:(o.vars||o).palette.action.disabled}}));function Ht(o,r){return typeof r=="object"&&r!==null?o===r:String(o)===String(r)}const Re=e(Pe,{checked:!0}),Be=e(Pe,{}),Kt=l.forwardRef(function(r,c){var a,n;const p=Ee({props:r,name:"MuiRadio"}),{checked:_,checkedIcon:w=Re,color:m="primary",icon:k=Be,name:I,onChange:F,size:N="medium",className:T}=p,R=Fe(p,Pt),E=H({},p,{color:m,size:N}),$=Ut(E),B=At();let f=_;const K=ct(F,B&&B.onChange);let z=I;return B&&(typeof f>"u"&&(f=Ht(B.value,p.value)),typeof z>"u"&&(z=B.name)),e(Ot,H({type:"radio",icon:l.cloneElement(k,{fontSize:(a=Be.props.fontSize)!=null?a:N}),checkedIcon:l.cloneElement(w,{fontSize:(n=Re.props.fontSize)!=null?n:N}),ownerState:E,classes:$,name:z,checked:f,onChange:K,ref:c,className:we($.root,T)},R))}),se=Kt;function jt(o){return Se("MuiRadioGroup",o)}ke("MuiRadioGroup",["root","row","error"]);const Wt=["actions","children","className","defaultValue","name","onChange","value"],Yt=o=>{const{classes:r,row:c,error:a}=o;return xe({root:["root",c&&"row",a&&"error"]},jt,r)},Zt=l.forwardRef(function(r,c){const{actions:a,children:n,className:p,defaultValue:_,name:w,onChange:m,value:k}=r,I=Fe(r,Wt),F=l.useRef(null),N=Yt(r),[T,R]=gt({controlled:k,default:_,name:"RadioGroup"});l.useImperativeHandle(a,()=>({focus:()=>{let f=F.current.querySelector("input:not(:disabled):checked");f||(f=F.current.querySelector("input:not(:disabled)")),f&&f.focus()}}),[]);const E=nt(c,F),$=bt(w),B=l.useMemo(()=>({name:$,onChange(f){R(f.target.value),m&&m(f,f.target.value)},value:T}),[$,m,R,T]);return e(Ue.Provider,{value:B,children:e(Dt,H({role:"radiogroup",ref:E,className:we(N.root,p)},I,{children:n}))})}),Jt=Zt,De=1e3;function Xt(o,r,c){const a=(o-r)/(c-r)*100;return Math.round(a*De)/De}function $e({min:o,now:r,max:c,label:a,visuallyHidden:n,striped:p,animated:_,className:w,style:m,variant:k,bsPrefix:I,...F},N){return e("div",{ref:N,...F,role:"progressbar",className:Le(w,`${I}-bar`,{[`bg-${k}`]:k,[`${I}-bar-animated`]:_,[`${I}-bar-striped`]:_||p}),style:{width:`${Xt(r,o,c)}%`,...m},"aria-valuenow":r,"aria-valuemin":o,"aria-valuemax":c,children:n?e("span",{className:"visually-hidden",children:a}):a})}const Oe=l.forwardRef(({isChild:o=!1,...r},c)=>{const a={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...r};if(a.bsPrefix=it(a.bsPrefix,"progress"),o)return $e(a,c);const{min:n,now:p,max:_,label:w,visuallyHidden:m,striped:k,animated:I,bsPrefix:F,variant:N,className:T,children:R,...E}=a;return e("div",{ref:c,...E,className:Le(T,F),children:R?ht(R,$=>l.cloneElement($,{isChild:!0})):$e({min:n,now:p,max:_,label:w,visuallyHidden:m,striped:k,animated:I,bsPrefix:F,variant:N},c)})});Oe.displayName="ProgressBar";const Qt=Oe,Ge=[{key:"filter-report-by-sector",name:"Sector"},{key:"filter-report-by-reference",name:"References"},{key:"filter-report-by-income-types",name:"Income Type"},{key:"filter-report-by-date",name:"Date"},{key:"filter-report-by-others",name:"Others"},{key:"filter-report-by-check-status",name:"Online Check Status"}],ye=[{value:"air-bnb",label:"Airbnb"},{value:"booking",label:"Booking.com"},{value:"vrbo",label:"VRBO"},{value:"expedia",label:"Expedia"},{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"},{value:"bankTransfer",label:"Bank Transfer"}],Ne=[{value:"reservation",label:"Reservation"},{value:"rent",label:"Rent"},{value:"electricity_bill",label:"Electricity Bill"},{value:"internet_bill",label:"Internet Bill"},{value:"service",label:"Service Provide"},{value:"others",label:"Others"}],qt=({showModal:o,closeModal:r,resetFilter:c,submitFilter:a,queryParams:n,setQueryParams:p})=>{const[_,w]=l.useState(Ge[0].key),[m,k]=l.useState([]),[I,F]=l.useState(!1),[N,T]=l.useState(""),[R,E]=l.useState(""),[$,B]=l.useState(""),{data:f,isFetching:K,isError:z}=Ze({skip:!I});l.useEffect(()=>{f!=null&&f.data&&(k(f.data),F(!1))},[f==null?void 0:f.data]);const D=m.filter(d=>d.label.toLowerCase().includes(N.toLowerCase())),P=(d,s)=>{let h=n.sectorIDS,v=n.sectorNames;d.target.checked?(h=h.concat(s.value),v=v.concat(s.label)):(h=h.filter(M=>M!==s.value),v=v.filter(M=>M!==s.label)),p({...n,sectorIDS:h,sectorNames:v})},L=(d,s)=>{let h=n.reference;d.target.checked?h=h.concat(s.value):h=h.filter(v=>v!==s.value),p({...n,reference:h})},G=(d,s)=>{let h=n.income_type;d.target.checked?h=h.concat(s.value):h=h.filter(v=>v!==s.value),p({...n,income_type:h})},x=()=>{F(!0)},A=d=>{if(d==="filter-report-by-sector")return t(X.Pane,{eventKey:"filter-report-by-sector",children:[t("label",{className:"custom-form-label",htmlFor:"filter-by-sector",children:["Filter By Sectors",e(Q,{icon:be,className:"reload-icon float-end",onClick:x,spin:K,title:"reload sectors"})]}),e("div",{className:"form-group mb-1",children:e("input",{className:"custom-form-control",placeholder:"search by keywards",value:N,onChange:s=>T(s.target.value)})}),e("span",{className:"results",children:`Found ${D.length} Results`}),e("div",{className:"report-filter-list",children:D.length>0?D.map((s,h)=>t(q,{className:"mb-3",size:"sm",children:[e(q.Checkbox,{"aria-label":`Checkbox for ${s.label}`,id:s.value,checked:n.sectorIDS.includes(s.value),onChange:v=>{P(v,s)}}),e(i.Control,{type:"text",value:s.label,disabled:!0,"aria-describedby":"basic-addon3"})]},`sector-${h}`)):"Nothing found"})]});if(d==="filter-report-by-reference")return t(X.Pane,{eventKey:"filter-report-by-reference",children:[t("label",{className:"custom-form-label",htmlFor:"filter-by-reference",children:["Filter By Reference",e(Q,{icon:be,className:"reload-icon float-end",spin:!1,title:"reload references"})]}),e("div",{className:"form-group mb-1",children:e("input",{className:"custom-form-control",placeholder:"search by keywards",value:R,onChange:s=>E(s.target.value)})}),e("span",{className:"results",children:`Found ${ye.length} Results`}),e("div",{className:"report-filter-list",children:ye.length>0?ye.map((s,h)=>t(q,{className:"mb-3",size:"sm",children:[e(q.Checkbox,{"aria-label":`Checkbox for ${s.label}`,id:s.value,checked:n.reference.includes(s.value),onChange:v=>{L(v,s)}}),e(i.Control,{type:"text",value:s.label,disabled:!0,"aria-describedby":"basic-addon3"})]},`sector-${h}`)):"Nothing found"})]});if(d==="filter-report-by-income-types")return t(X.Pane,{eventKey:"filter-report-by-income-types",children:[t("label",{className:"custom-form-label",htmlFor:"filter-by-income-types",children:["Filter By Reference",e(Q,{icon:be,className:"reload-icon float-end",spin:!1,title:"Reload Income Types"})]}),e("div",{className:"form-group mb-1",children:e("input",{className:"custom-form-control",placeholder:"search by keywards",value:$,onChange:s=>B(s.target.value)})}),e("span",{className:"results",children:`Found ${Ne.length} Results`}),e("div",{className:"report-filter-list",children:Ne.length>0?Ne.map((s,h)=>t(q,{className:"mb-3",size:"sm",children:[e(q.Checkbox,{"aria-label":`Checkbox for ${s.label}`,id:s.value,checked:n.income_type.includes(s.value),onChange:v=>{G(v,s)}}),e(i.Control,{type:"text",value:s.label,disabled:!0,"aria-describedby":"basic-addon3"})]},`incomeType-${h}`)):"Nothing found"})]});if(d==="filter-report-by-date")return t(X.Pane,{eventKey:"filter-report-by-date",children:[t(i.Group,{controlId:"start_date",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"From"}),e(i.Control,{size:"sm",type:"date",value:n.start_date,onChange:s=>{p({...n,start_date:s.target.value})}})]}),t(i.Group,{controlId:"to_date",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"To"}),e(i.Control,{size:"sm",type:"date",value:n.end_date,onChange:s=>{p({...n,end_date:s.target.value})}})]})]});if(d==="filter-report-by-check-status")return t(X.Pane,{eventKey:"filter-report-by-check-status",children:[t("div",{className:"form-group",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Dates"}),t(i.Select,{size:"sm","aria-label":"Default select example",id:"order",name:"order",value:n.check_for,onChange:s=>{const h=s.target.value||"";p({...n,check_for:h})},children:[e("option",{children:"Select Date Options"}),e("option",{value:"checkinout",children:"Checkin or Checkout"}),e("option",{value:"checkin",children:"Checkin"}),e("option",{value:"checkout",children:"Checkout"})]})]}),t(i.Group,{controlId:"start_date",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"From"}),e(i.Control,{size:"sm",type:"date",value:n.check_from,onChange:s=>{p({...n,check_from:s.target.value})}})]}),t(i.Group,{controlId:"to_date",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"To"}),e(i.Control,{size:"sm",type:"date",value:n.check_to,onChange:s=>{p({...n,check_to:s.target.value})}})]})]});if(d==="filter-report-by-others")return t(X.Pane,{eventKey:"filter-report-by-others",children:[t("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"income-filter-order-by",children:"Order By"}),t("select",{className:"form-control",name:"income-filter-order-by",value:n.orderBy,onChange:s=>{const h=s.target.value||"";p({...n,orderBy:h})},children:[e("option",{defaultValue:!0,children:"Filter By Order Column"}),e("option",{value:"id",children:"Id"}),e("option",{value:"date",children:"Date"}),e("option",{value:"amount",children:"Amount"}),e("option",{value:"refundable_amount",children:"Refundable Amount"}),e("option",{value:"refunded_amount",children:"Refunded Amount"})]})]}),t("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"income-filter-order",children:"Order"}),t("select",{className:"form-control",value:n.order,id:"order",name:"order",onChange:s=>{const h=s.target.value||"";p({...n,order:h})},children:[e("option",{defaultValue:!0,children:"Filter By Order"}),e("option",{value:"DESC",children:"DESCENDING"}),e("option",{value:"ASC",children:"ASCENDING"})]})]}),t("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"income-filter-limit",children:"Limit"}),t("select",{className:"form-control",name:"income-filter-limit",value:n.limit,onChange:s=>{const h=s.target.value||"";p({...n,limit:h})},children:[e("option",{defaultValue:!0,children:"Filter By Limit"}),e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"50",children:"50"}),e("option",{value:"100",children:"100"}),e("option",{value:"500",children:"500"}),e("option",{value:"1000",children:"1000"})]})]})]})};return e(Z,{children:t(S,{show:o,onHide:r,backdrop:"static",keyboard:!1,children:[e(S.Header,{closeButton:!0,onClick:c,children:e(S.Title,{children:"Filters"})}),e(S.Body,{className:"filter-modal-body",children:e(ie,{children:e(X.Container,{id:"left-tabs-example",defaultActiveKey:"filter-report-by-sector",children:t(V,{className:"filter-modal-row",children:[e(y,{md:6,xs:6,className:"filter-column",children:e(Ce,{variant:"pills",className:"flex-column",children:Ge.map(d=>e(Ce.Item,{children:e(Ce.Link,{eventKey:d.key,onClick:()=>{w(d.key)},children:d.name})},d.key))})}),e(y,{md:6,xs:6,className:"filter-column",children:e(X.Content,{children:A(_)})})]})})})}),t(S.Footer,{children:[e(ee,{variant:"danger",onClick:c,children:"Reset"}),e(ee,{variant:"info",onClick:a,children:"Filter"})]})]})})},ea=l.memo(qt),ta=Nt({option:{"&:hover":{backgroundColor:"#ff7961 !important"}}}),aa={id:null,account:[],category:[],income_type:[],reference:[],amount:"",description:"",date:"",checkin_date:"",checkout_date:"",deposit:"",note:"",attachment:""},oa=[{value:"air-bnb",label:"Airbnb"},{value:"booking",label:"Booking.com"},{value:"vrbo",label:"VRBO"},{value:"expedia",label:"Expedia"},{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"},{value:"bankTransfer",label:"Bank Transfer"}],na=[{value:"reservation",label:"Reservation"},{value:"rent",label:"Rent"},{value:"electricity_bill",label:"Electricity Bill"},{value:"internet_bill",label:"Internet Bill"},{value:"service",label:"Service Provide"},{value:"others",label:"Others"}];function la({handelCloseModal:o,title:r,id:c}){ta();const[a,n]=l.useState(aa),[p,_]=l.useState(na),[w,m]=l.useState([]),[k,I]=l.useState(oa),[F,N]=l.useState([]),[T,R]=l.useState("Select check in and check out dates."),[E,$]=l.useState("primary"),[B,f]=l.useState(""),[K,z]=l.useState(!1),[D,P]=l.useState("airbnb"),[L,G]=l.useState({}),[x,A]=l.useState("Upload"),[d,s]=l.useState(!1),[h,v]=l.useState(0),{data:M}=Je({id:c}),{data:j}=Xe({currentPage:"",pageSize:100}),{data:W,isFetching:te}=Me({categoryType:"income"}),de=(u,g)=>{const U=u.target.files[0];n({...a,attachment:U})};l.useEffect(()=>{if((j==null?void 0:j.data.length)>0){const u=j==null?void 0:j.data.map(({id:g,bank_name:U,account_number:C})=>({value:g,label:U+"("+C+")"}));N(u)}(W==null?void 0:W.data.length)>0&&m(W==null?void 0:W.data),c&&(M!=null&&M.data)&&n(M==null?void 0:M.data)},[c,j,W,M]);const J=u=>{const g=u.target.files[0];G({file:g})},me=u=>{P(u.target.value)},le=u=>{z(!K)},[ue]=Ve(),he=async u=>{var U;u.preventDefault(),A("Uploading..."),s(!0);let g=new FormData;g.append("channel",D),g.append("csvFile",L),g.append("category_id",D==="booking"?B.id:0),v(0);try{const C=await ue({url:"/income/add-csv",formData:{channel:D,csvFile:L,category_id:B.value}}).unwrap();console.log(C)}catch(C){C.status===406?(setShowExistingTask(!0),setExistingTask((U=C==null?void 0:C.errorData)==null?void 0:U.data)):C.status===422?Y("error",C==null?void 0:C.message):Y("error",(C==null?void 0:C.message)||"An error occurred",(C==null?void 0:C.description)||"Please try again later.")}A("Upload"),s(!1)},[pe]=Qe(),fe=async u=>{var C;u.preventDefault();let g=new FormData;g.append("account",a.account.value),g.append("income_type",a.income_type.value),g.append("amount",a.amount),g.append("category",a.category.value),g.append("description",a.description),g.append("note",a.note),g.append("reference",a.reference.value),g.append("date",a.date),g.append("checkin_date",a.checkin_date),g.append("checkout_date",a.checkout_date),g.append("attachment",a.attachment);const U=c?`/income/${c}`:"/income/add";try{const b=await pe({url:U,formData:g}).unwrap();Y("success",b==null?void 0:b.message,b==null?void 0:b.description),o()}catch(b){b.status===406?(setShowExistingTask(!0),setExistingTask((C=b==null?void 0:b.errorData)==null?void 0:C.data)):b.status===422?Y("error",(b==null?void 0:b.message)||"An error occurred",(b==null?void 0:b.description)||"Please fill the required fields."):Y("error",(b==null?void 0:b.message)||"An error occurred",(b==null?void 0:b.description)||"Please try again later.")}};return e(Z,{children:t(S,{show:!0,centered:!0,onHide:o,backdrop:"static",keyboard:!1,size:"lg",children:[e(S.Header,{closeButton:!0,children:e(S.Title,{children:e("span",{children:"Add new Income"})})}),K?t(Z,{children:[t(S.Body,{children:[!a.id&&e(V,{children:e("div",{className:"text-end",children:e("i",{children:e("u",{children:e("a",{onClick:le,className:"text-primary",children:"add by manually?"})})})})}),t("form",{className:"custom-form",children:[t("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"csv_file",children:"Upload CSV file"}),e("input",{className:"custom-form-control",type:"file",id:"csv_file",onChange:J,placeholder:"Attach CSV file here"})]}),e("div",{className:"form-control",children:t(pt,{children:[e(ft,{id:"demo-controlled-radio-buttons-group",children:"Channels"}),e(Jt,{"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",value:D,onChange:me,children:t(dt,{display:"flex",children:[e(re,{value:"airbnb",control:e(se,{}),label:"Airbnb"}),e(re,{value:"booking",control:e(se,{}),label:"Booking.com"}),e(re,{value:"vrbo",control:e(se,{}),label:"VRBO"}),e(re,{value:"experia",control:e(se,{}),label:"Expedia"})]})})]})}),e("div",{className:"",children:t(i.Group,{className:"mb-1",controlId:"category_id",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Category"}),e(oe,{className:"basic-single",classNamePrefix:"select",value:B,isSearchable:!0,name:"category_id",isLoading:te,options:w,onChange:u=>{f(u)}})]})})]}),e(Qt,{striped:!0,variant:"success",now:h,label:`${h}%`})]}),e(S.Footer,{children:e(ee,{loading:!0,className:"btn-sm load",variant:"primary",disabled:d,onClick:he,children:x})})]}):t(Z,{children:[e(S.Body,{className:"add-or-update",children:t(ie,{children:[!a.id&&e(V,{children:e("div",{className:"text-end",children:e("i",{children:e("u",{children:e("a",{onClick:le,className:"text-primary",children:"add income by CSV file?"})})})})}),e(V,{children:e(y,{xs:12,md:12,lg:12,sm:12,children:t(i.Group,{className:"mb-1",controlId:"description",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Description"}),e(i.Control,{as:"textarea",autoFocus:!0,rows:3,value:a.description,name:"description",onChange:u=>{n({...a,description:u.target.value})}})]})})}),t(V,{children:[e(y,{xs:12,md:6,lg:6,sm:12,children:t(i.Group,{className:"mb-1",controlId:"amount",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Amount"}),e(i.Control,{type:"number",placeholder:"i.g: 50 AED",value:a.amount,onChange:u=>{n({...a,amount:u.target.value})}})]})}),e(y,{xs:12,md:6,lg:6,sm:12,children:t(i.Group,{className:"mb-1",controlId:"account",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Account"}),e(oe,{className:"basic-single",classNamePrefix:"select",value:a.account,isSearchable:!0,name:"account",isLoading:!1,options:F,onChange:u=>{n({...a,account:u})}})]})})]}),t(V,{children:[e(y,{xs:12,md:4,lg:4,sm:12,children:t(i.Group,{className:"mb-1",controlId:"category_id",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Category"}),e(oe,{className:"basic-single",classNamePrefix:"select",value:a.category,isSearchable:!0,name:"category_id",isLoading:te,options:w,onChange:u=>{n({...a,category:u})}})]})}),e(y,{xs:12,md:4,lg:4,sm:12,children:t(i.Group,{className:"mb-1",controlId:"refrence",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Reference"}),e(oe,{className:"basic-single",classNamePrefix:"select",value:a.reference,isSearchable:!0,name:"reference",isLoading:!1,options:k,onChange:u=>{n({...a,reference:u})}})]})}),e(y,{xs:12,md:4,lg:4,sm:12,children:t(i.Group,{className:"mb-1",controlId:"income_type",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Income Type"}),e(oe,{className:"basic-single",classNamePrefix:"select",value:a.income_type,isSearchable:!0,name:"income_type",isLoading:!1,options:p,onChange:u=>{n({...a,income_type:u})}})]})})]}),t(V,{children:[e(y,{xs:12,md:4,lg:4,sm:12,children:t(i.Group,{className:"mb-1",controlId:"date",children:[e(i.Label,{className:"custom-form-label",children:"Date"}),e(i.Control,{type:"date",value:a.date,onChange:u=>{n({...a,date:u.target.value})}})]})}),a.income_type.value==="reservation"&&t(Z,{children:[e(y,{xs:12,md:4,lg:4,sm:12,children:t(i.Group,{className:"mb-1",controlId:"checkInDate",children:[e(i.Label,{className:"custom-form-label",children:"Check in date"}),e(i.Control,{type:"date",value:a.checkin_date,onChange:u=>{n({...a,checkin_date:u.target.value})}})]})}),e(y,{xs:12,md:4,lg:4,sm:12,children:t(i.Group,{className:"mb-1",controlId:"checkOutDate",children:[e(i.Label,{className:"custom-form-label",children:"Checkout Date"}),e(i.Control,{type:"date",value:a.checkout_date,onChange:u=>{n({...a,checkout_date:u.target.value});const g=mt(a.checkin_date,u.target.value);R(g.message),$(g.class)}}),e("span",{className:"text-"+E,children:e("small",{children:T})})]})})]})]}),e(V,{children:e(y,{xs:12,md:12,lg:12,sm:12,children:t(i.Group,{className:"mb-1",controlId:"note",children:[e(i.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Note"}),e(i.Control,{as:"textarea",autoFocus:!0,rows:3,value:a.note,name:"note",onChange:u=>{n({...a,note:u.target.value})}})]})})}),e(V,{children:e(y,{xs:12,md:12,lg:12,sm:12,children:t(i.Group,{className:"mb-1",controlId:"attachment",children:[e(i.Label,{children:" Attachments"}),e(i.Control,{type:"file",onChange:u=>de(u)})]})})})]})}),t(S.Footer,{children:[e(ee,{variant:"danger",onClick:o,children:"Close"}),e(ee,{variant:"primary",onClick:u=>fe(u),children:"Add Income"})]})]})]})})}const ra=({handleCloseModal:o,data:r,currency:c})=>e(Z,{children:t(S,{show:!0,centered:!0,onHide:o,className:"custom-modal modal-lg",children:[e(S.Header,{closeButton:!0,children:e(S.Title,{children:e("span",{children:"Incomes Details"})})}),e(S.Body,{children:t(ie,{children:[t(V,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Income Details"}),t(y,{xs:12,md:4,children:[e("strong",{children:"Category: "}),r.category_name]}),t(y,{xs:12,md:4,children:[e("strong",{children:"Amount: "}),c+" "+r.amount]}),t(y,{xs:12,md:4,children:[e("strong",{children:"Date: "}),r.date]})]}),t(V,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Bank Details"}),t(y,{xs:12,md:12,children:[e("strong",{children:"Bank Name: "}),r.account.label]})]}),t(V,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Description"}),t(y,{xs:9,md:9,children:[e("strong",{children:"Description: "}),r.description]}),t(y,{xs:3,md:3,children:[e("strong",{children:"Attachment: "}),r.attachment]})]}),t(V,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Others"}),t(y,{xs:6,md:6,children:[e("strong",{children:"Note: "}),r.note]}),t(y,{xs:6,md:6,children:[e("strong",{children:"Reference: "}),r.reference.label]})]})]})}),e(S.Footer,{children:e("button",{className:"btn btn-primary",onClick:o,children:"Close"})})]})}),sa=l.memo(ra);function ca({incomes:o,isFetching:r,hasError:c,tableColumns:a,actionBtns:n,paginations:p,cardSubTitle:_}){const w=()=>{if(r)return e(Z,{children:e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"Loading..."})})});if(c)return e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"Expense Loading Error..."})});if(o.length===0)return e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"No data found..."})});if(o.length>0)return o.map((m,k)=>t("tr",{children:[e("td",{children:m==null?void 0:m.date}),e("td",{children:t("div",{className:"custom-table-cell","data-tooltip-id":"income-description","data-tooltip-content":m==null?void 0:m.description,children:[e(ut,{id:"income-description",className:"income-description-tooltip"}),m==null?void 0:m.description]})}),e("td",{children:m==null?void 0:m.category_name}),e("td",{children:m==null?void 0:m.reference.value}),e("td",{children:m==null?void 0:m.amount}),e("td",{children:e(Ft,{actionBtn:n,element:m})})]},`expense-row-${k}`))};return t("div",{children:[t(kt,{responsive:"md",children:[e("thead",{children:t("tr",{children:[a.map(m=>e("th",{align:m.align,children:m.label},m.id)),e("th",{children:"Actions"})]})}),e("tbody",{children:w()})]}),p.totalPages>1&&t(Z,{children:[e(wt,{component:"div",count:p.totalPages,variant:"outlined",shape:"rounded",page:p.currentPage,onChange:p.handlePageChange}),e("span",{children:e("small",{className:"text-muted",children:e("i",{children:_})})})]})]})}const ia={account:[],category:[],income_type:[],reference:[],amount:"",description:"",date:"",checkin_date:"",checkout_date:"",deposit:"",note:"",attachment:""};function da({handelCloseModal:o}){l.useState(ia);const[r,c]=l.useState([]),[a,n]=l.useState(""),[p,_]=l.useState("airbnb"),[w,m]=l.useState({}),[k,I]=l.useState("Upload"),F=l.useRef(null),[N,T]=l.useState([]),[R,E]=l.useState([]),[$,B]=l.useState([]),{data:f,isFetching:K}=Me({categoryType:"income"});l.useEffect(()=>{(f==null?void 0:f.data.length)>0&&c(f==null?void 0:f.data)},[f]);const[z]=Ve(),D=async G=>{var A;G.preventDefault(),I("Uploading...");let x=new FormData;x.append("channel",p),x.append("csvFile",w),x.append("category_id",p==="booking"?a.id:0);try{const d=await z({url:"/income/add-csv",formData:{channel:p,csvFile:w,category_id:a.value}}).unwrap();console.log(d)}catch(d){d.status===406?(setShowExistingTask(!0),setExistingTask((A=d==null?void 0:d.errorData)==null?void 0:A.data)):d.status===422?Y("error",d==null?void 0:d.message):Y("error",(d==null?void 0:d.message)||"An error occurred",(d==null?void 0:d.description)||"Please try again later.")}I("Upload")},P=()=>{F.current.click()},L=G=>{const x=G.target.files[0];if(!x)return;const A=x.name.length>12?`${x.name.substring(0,13)}... .${x.name.split(".")[1]}`:x.name;new FormData().append("file",x),T(s=>[...s,{name:A,loading:0}]),B(!0)};return e(Z,{children:t(S,{show:!0,centered:!0,onHide:o,backdrop:"static",keyboard:!1,size:"lg",children:[e(S.Header,{closeButton:!0,children:e(S.Title,{children:e("span",{children:"Add new Income"})})}),e(S.Body,{children:e(ie,{children:t(V,{children:[e(y,{sm:8,children:"sm=8"}),e(y,{sm:4,children:t("div",{className:"upload-box",children:[e("p",{children:"Upload your file"}),t("form",{className:"custom-form",children:[e("input",{className:"file-input",type:"file",name:"file",hidden:!0,ref:F,onChange:L}),e("div",{className:"icon",onClick:P,children:e("img",{src:"upload-file.svg"})})]}),$&&e("section",{className:"loading-area",children:N.map((G,x)=>e("li",{className:"row",children:e("div",{className:"content",children:t("div",{className:"details",children:[e("div",{className:"name",children:`${G.name} - uploading`}),e("div",{className:"percent",children:`${G.loading}%`}),e("div",{className:"loading-bar",children:e("div",{className:"loading",style:{width:`${G.loading}%`}})})]})})},x))}),e("section",{className:"upload-area",children:R.map((G,x)=>t("li",{className:"row",children:[e("div",{className:"content upload",children:t("div",{className:"details",children:[e("span",{className:"name",children:G.name}),e("span",{className:"size",children:G.size})]})}),e(Q,{className:"fileIcon",icon:lt})]},x))})]})})]})})}),e(S.Footer,{children:e(ee,{className:"btn-sm load",variant:"primary",onClick:D,children:k})})]})})}const Te={type:"",income_type:[],orderBy:"",order:"",limit:"",to_date:"",from_date:"",account_id:"",start_date:"",end_date:"",sectorIDS:[],sectorNames:[],check_for:"checkinout",check_from:"",check_to:"",reference:[]},ma=[{id:"date",label:"Date",align:"left"},{id:"description",label:"Description",align:"left"},{id:"sector",label:"Sector",align:"left"},{id:"category_name",label:"Source",align:"left"},{id:"amount",label:"Amount",align:"right"}];function Pa(){const[o,r]=l.useState(!1),[c,a]=l.useState(1),[n,p]=l.useState(0);l.useState("");const{applicationSettings:_,userRole:w,userPermission:m}=l.useContext(qe),[k,I]=l.useState([]),[F,N]=l.useState({}),[T,R]=l.useState(!1),[E,$]=l.useState(!1),[B,f]=l.useState(!1),[K,z]=l.useState(!1),[D,P]=l.useState(Te),{num_data_per_page:L,default_currency:G}=_,[x,A]=l.useState(!1),[d,s]=l.useState(!1),[h,v]=l.useState(!0),[M,j]=l.useState("");l.useEffect(()=>{L>0&&P({...D,limit:L})},[]);const W=()=>{s(!d),v(!1)},te=Number(D.limit)>0?Number(D.limit):L||10,de=Math.ceil(n/te),{data:J,isFetching:me,isError:le}=et({currentPage:c,pageSize:te,query:D},{skip:!h},{refetchOnMountOrArgChange:x}),[ue]=tt(),he=O=>{at.fire({title:"Are you sure?",text:"You will not be able to recover the income!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(async ge=>{if(ge.isConfirmed)try{const ae=await ue({id:O.id}).unwrap();Y("success",ae.message,ae.description)}catch(ae){Y("error",ae.data.message,ae.data.description||"An error occurred.")}})},pe=()=>{R(!0)},fe=()=>{$(!0)},u=()=>{R(!1),N({})},g=()=>{$(!1),N({})},U=O=>{R(!0),N(O)},C=O=>{f(!0),N(O)},b=()=>{f(!1),N({})},He=(O,ge)=>{a(ge),A(!0)};l.useEffect(()=>{document.title="Manage Incomes",J!=null&&J.data?(I(J.data),p(J.total),z(!1)):z(!0),A(!1)},[J,c]);const Ie=k.filter(O=>O.description.toLowerCase().includes(M.toLowerCase())),Ke=[{actionName:"Edit",type:"modal",route:"",actionFunction:U,permission:"edit_income",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:C,permission:"income_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:he,permission:"income_delete",textClass:"text-danger"}],je=()=>{v(!0),s(!1)},We=()=>{P(Te),v(!h)},Ye=()=>{v(!h),s(!1)};return t("div",{children:[e(rt,{loaderVisible:K}),t("div",{className:"row mb-2",children:[e("div",{className:"col-md-4",children:e("span",{className:"page-title-header",children:"Incomes"})}),t("div",{className:"col-md-8 text-end",children:[t("button",{className:"btn btn-secondary btn-sm mr-2",children:[e(Q,{icon:st})," Download CSV"]}),t("button",{className:"btn btn-sm btn-primary mr-2",onClick:pe,children:[e(Q,{icon:ve})," Add Income"]}),t("button",{className:"btn btn-sm btn-success",onClick:fe,children:[e(Q,{icon:ve})," Upload CSV"]})]})]}),t("div",{className:"row mb-2",children:[e("div",{className:"col-md-8",children:t("button",{className:"btn btn-secondary btn-sm mr-2",onClick:W,children:[e(Q,{icon:ve})," Filter"]})}),e("div",{className:"col-md-4",children:e(i.Control,{type:"text",size:"sm",value:M,onChange:O=>j(O.target.value),placeholder:"search by key wards...",style:{textTransform:"capitalize"}})})]}),e("div",{className:"row mb-2",children:e(St,{queries:D,setQuery:P})}),e(ca,{incomes:Ie,tableColumns:ma,actionBtns:Ke,loading:o,paginations:{totalPages:de??0,totalCount:n,currentPage:c,handlePageChange:He},cardSubTitle:`Page-${c} (showing ${Ie.length} results from ${n})`,isFetching:me,hasError:le}),T&&e(la,{handelCloseModal:u,title:"Create New Income",id:F.id}),E&&e(da,{handelCloseModal:g,title:"Upload Csv Income File"}),B&&e(sa,{handleCloseModal:b,data:F,currency:G}),d&&e(ea,{showModal:d,closeModal:Ye,resetFilter:We,submitFilter:je,queryParams:D,setQueryParams:P,setHasFilter:v})]})}export{Pa as default};
