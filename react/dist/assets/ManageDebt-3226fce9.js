import{af as X,r as o,e as Y,a as n,j as e,m as f}from"./index-8e1ee696.js";import{e as j}from"./index-dc02ab6d.js";import{M as Z}from"./index-74298ed0.js";import{M as i}from"./Modal-bc712426.js";import{F as r}from"./Form-833e738d.js";import{b as S}from"./AuthRoutes-2e952a6b.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./classCallCheck-25f3f0e0.js";function se(){let{id:p}=X();const[a,d]=o.useState(null),[u,s]=o.useState(!0),[c,O]=o.useState({}),[I,V]=o.useState([]),[z,_]=o.useState(!1),[P,w]=o.useState(!1),[R,U]=o.useState([]),{setNotification:F}=Y(),[m,D]=o.useState(null),g=t=>{D(t)};let h="success";const[N,x]=o.useState({id:null,amount:"",date:null,debt_id:p,account_id:null,note:null}),[y,C]=o.useState({id:null,amount:null,note:null,debt_id:p,date:null,account_id:null}),[$,q]=o.useState([]),[v,k]=o.useState([]),M=()=>{f.get(`/debts/${p}`).then(({data:t})=>{O(t),s(!1)})},B=()=>{s(!0),f.get("/all-bank-account").then(({data:t})=>{s(!1),U(t.data)}).catch(()=>{s(!1)})},L=()=>{s(!0),f.get(`/get-debt-history/${p}`).then(({data:t})=>{V(t.infos),s(!1)})};o.useEffect(()=>{document.title="Manage Debt",M(),B(),L()},[]);const J=()=>{d(null),k([]),_(!0)},K=()=>{d(null),k([]),w(!0)},E=()=>{w(!1)},G=()=>{_(!1)},Q=t=>{t.preventDefault(),s(!0);const T={...N,date:m?new Date(m.getTime()-m.getTimezoneOffset()*6e4).toISOString().split("T")[0]:null};let b="/lends/add";c.type==="borrow"&&(b="/borrows/add"),f.post(b,T).then(({data:l})=>{l.status===422?d(l.data.errors):(F(l.message),l.status==="success"&&(_(!1),M(),L(),B(),x({id:null,amount:"",date:null,debt_id:p,account_id:null}),D(null))),s(!1)}).catch(l=>{s(!1);const A=l.response;d(A.data.errors)})};o.useEffect(()=>{c.date},[c]);const W=t=>{t.preventDefault(),s(!0);const T={...y,date:m?new Date(m.getTime()-m.getTimezoneOffset()*6e4).toISOString().split("T")[0]:null};d(null);let b="/lends/collection/add";c.type==="borrow"&&(b="/repayments/add"),f.post(b,T).then(({data:l})=>{l.status===422?d(l.data.errors):l.action_status==="insufficient_balance"||l.action_status==="invalid_amount"?(k(l.message),error.response,d(null),l&&l.status===409?d({bank_name:["Bank name already exists"]}):l&&l.status===422&&d(l.data.errors),s(!1)):(F(l.message),M(),L(),B(),w(!1),C({id:null,amount:"",note:null,debt_id:p,account_id:null,date:null}),D(null),s(!1)),s(!1)}).catch(l=>{const A=l.response;d(A.data.errors),s(!1)})};return o.useEffect(()=>{u||q([c])},[c,u]),n("div",{children:[e(Z,{loaderVisible:u}),e("div",{className:"d-flex justify-content-between align-content-center gap-2 mb-3",children:n("h1",{className:"title-text mb-0 uppercase",children:["Manage ",c.type]})}),n("table",{className:"table-bordered table-striped",children:[e("thead",{children:n("tr",{className:"text-center",children:[e("th",{children:"Amount"}),e("th",{children:"Person"}),e("th",{children:"Date"})]})}),n("tbody",{children:[u&&e("tr",{className:"text-center",children:e("td",{colSpan:3,className:"text-center",children:"Loading..."})}),!u&&$.map(t=>n("tr",{className:"text-center",children:[e("td",{children:t.amount}),e("td",{children:t.person}),e("td",{children:t.date})]},t.id))]})]}),e("br",{}),n("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e("a",{className:"btn-delete",onClick:J,children:c.type==="borrow"?"+ Borrow more":"+ Lend More"}),e("a",{className:"btn-edit",onClick:K,children:c.type==="borrow"?"- Repay":"+ Debt Collection"})]}),e("br",{}),e("div",{className:"table-responsive-sm",children:n("table",{className:"table table-bordered custom-table",children:[e("thead",{children:n("tr",{children:[e("th",{className:"text-center",children:"Date"}),e("th",{className:"text-center",children:"Type"}),e("th",{className:"text-center",children:"Amount"}),e("th",{className:"text-center",children:"Notes"}),e("th",{className:"text-center",children:"Bank Name"})]})}),u&&e("tbody",{children:e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"Loading..."})})}),!u&&e("tbody",{children:I.length===0?e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"No bank found"})}):I.map(t=>((t.type==="Lend"||t.type==="Borrow")&&(h="danger"),(t.type==="Debt Collection"||t.type==="Repayment")&&(h="success"),n("tr",{className:"text-center",children:[e("td",{className:"text-"+h,children:t.date}),e("td",{className:"text-"+h,children:t.type}),e("td",{className:"text-"+h,children:t.amount}),e("td",{className:"text-"+h,children:t.note}),e("td",{className:"text-"+h,children:t.bank_name})]},t.type+t.id)))})]})}),n(i,{show:z,centered:!0,onHide:G,className:"custom-modal",children:[e(i.Header,{closeButton:!0,children:e(i.Title,{children:c.type==="borrow"?"Borrow More":"Lend More"})}),e(i.Body,{children:n(r,{children:[n(r.Group,{controlId:"amount",children:[e(r.Label,{children:e("strong",{children:"Amount"})}),e(r.Control,{onChange:t=>x({...N,amount:t.target.value}),type:"number",placeholder:"Enter amount"}),a&&a.amount&&e("div",{className:"text-danger mt-2",children:a.amount[0]})]}),e("br",{}),n(r.Group,{controlId:"note",children:[e(r.Label,{children:e("strong",{children:"Note"})}),e(r.Control,{onChange:t=>x({...N,note:t.target.value}),placeholder:"Enter Note"}),a&&a.note&&e("div",{className:"text-danger mt-2",children:a.note[0]})]}),e("br",{}),n(r.Group,{controlId:"bank_account",children:[e(r.Label,{children:e("strong",{children:"Select Bank Account"})}),n(r.Control,{onChange:t=>x({...N,account_id:t.target.value}),as:"select",defaultValue:"",children:[e("option",{value:"",children:"Choose a bank account..."}),R.map(t=>n("option",{value:t.id,children:[t.bank_name," - ",t.account_number," - Balance (",t.balance,")"]},t.id))]}),a&&a.account_id&&e("div",{className:"text-danger mt-2",children:a.account_id[0]}),v&&e("div",{className:"text-danger mt-2",children:v})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"date",className:"custom-form-label",children:"Date :"}),e(j,{className:"custom-form-control",selected:m,onChange:g,onSelect:g,dateFormat:"yyyy-MM-dd",placeholderText:"Select Date"}),a&&a.date&&e("div",{className:"text-danger mt-2",children:a.date[0]})]})]})}),n(i.Footer,{children:[e(S,{className:"btn-sm",variant:"secondary",onClick:G,children:"Close"}),e(S,{className:"btn-sm",variant:"primary",onClick:Q,children:"Update"})]})]}),n(i,{show:P,centered:!0,onHide:E,className:"custom-modal",children:[e(i.Header,{closeButton:!0,children:e(i.Title,{children:c.type==="borrow"?"Repay":"Debt Collection"})}),e(i.Body,{children:n(r,{children:[n(r.Group,{controlId:"amount",children:[e(r.Label,{children:e("strong",{children:"Amount"})}),e(r.Control,{onChange:t=>C({...y,amount:t.target.value}),type:"number",placeholder:"Enter amount"}),a&&a.amount&&e("div",{className:"text-danger mt-2",children:a.amount[0]})]}),e("br",{}),n(r.Group,{controlId:"note",children:[e(r.Label,{children:e("strong",{children:"Note"})}),e(r.Control,{onChange:t=>C({...y,note:t.target.value}),placeholder:"Enter Note"}),a&&a.amount&&e("div",{className:"text-danger mt-2",children:a.note[0]})]}),e("br",{}),n(r.Group,{controlId:"bank_account",children:[e(r.Label,{children:e("strong",{children:"Select Bank Account"})}),n(r.Control,{onChange:t=>C({...y,account_id:t.target.value}),as:"select",defaultValue:"",children:[e("option",{value:"",children:"Choose a bank account..."}),R.map(t=>n("option",{value:t.id,children:[t.bank_name," - ",t.account_number," - Balance (",t.balance,")"]},t.id))]}),a&&a.account_id&&e("div",{className:"text-danger mt-2",children:a.account_id[0]}),v&&e("div",{className:"text-danger mt-2",children:v})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"date",className:"custom-form-label",children:"Date :"}),e(j,{className:"custom-form-control",selected:m,onChange:g,onSelect:g,dateFormat:"yyyy-MM-dd",placeholderText:"Select Date"}),a&&a.date&&e("div",{className:"text-danger mt-2",children:a.date[0]})]})]})}),n(i.Footer,{children:[e(S,{className:"btn-sm",variant:"secondary",onClick:E,children:"Close"}),e(S,{className:"btn-sm",variant:"primary",onClick:W,children:"Update"})]})]})]})}export{se as default};
