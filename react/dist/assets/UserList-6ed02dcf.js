import{r as c,m as I,j as e,F as E,a as s,aB as ne,aC as ie,S as ce,d as de}from"./index-8e1ee696.js";import{M as Q}from"./index-74298ed0.js";import{R as f,a as u,C as ue,b as D,n as L,d as me}from"./AuthRoutes-2e952a6b.js";import"./SummeryCard-fe96b9bb.js";import{I as pe}from"./Iconify-5a94efd0.js";import{C as he}from"./CommonTable-27ef35ac.js";import{I as q}from"./Image-bab1f910.js";import{a as ge}from"./CardContent-2022634c.js";import{F as a}from"./Form-833e738d.js";import{T as be}from"./TextField-029e5f7c.js";import{M as w}from"./Modal-bc712426.js";import"./Table-9f2e03c0.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./TableRow-3c1023d1.js";import"./jsx-runtime_commonjs-proxy-221d5456.js";import"./isMuiElement-18bae589.js";import"./useId-bebd534a.js";import"./useControlled-c67091af.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./Typography-e228ba3d.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./LastPage-4ffce3d8.js";import"./FormLabel-e3756905.js";import"./utils-a73c94d0.js";import"./useFormControl-e95281cb.js";import"./Select-2ff9a889.js";const P=["id","name","created_at"],z=["ASC","DESC"],O=[10,50,100,500];function fe(p){const{search:r,query:i,setQuery:g,resetFilterParameter:m,getUser:T,handelFilter:C}=p,{placeHolderTxt:y,searchBoxValue:N,handelSearch:b}=r,[x,_]=c.useState([]);return c.useEffect(()=>{I.get("/roles-by-company",{}).then(({data:t})=>{_(t.data)}).catch(t=>{console.error("Error loading role list:",t)})},[]),e(E,{children:s(ge,{style:{borderBottom:"1px solid"},children:[s(f,{className:"mb-3",children:[s(u,{xs:12,md:3,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Roles"}),s(a.Select,{size:"sm",value:i.role,"aria-label":"Roles",onChange:t=>{g({...i,role:t.target.value})},children:[e("option",{defaultValue:!0,children:"IncomeFilter by Roles"}),x.length>0?x.map(t=>e("option",{value:t.id,children:t.role.toUpperCase()},t.id)):e("option",{defaultValue:!0,children:"IncomeFilter by Roles"})]})]}),P.length>0&&s(u,{xs:12,md:3,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Order By"}),s(a.Select,{size:"sm",value:i.orderBy,"aria-label":"Order By",onChange:t=>{g({...i,orderBy:t.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Order by"}),P.map(t=>e("option",{value:t,children:t.replaceAll("_"," ").toUpperCase()},"user-filter-order-by"+t))]})]}),z.length>0&&s(u,{xs:12,md:3,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Order"}),s(a.Select,{size:"sm","aria-label":"Order",value:i.order,onChange:t=>{g({...i,order:t.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Order by"}),z.map(t=>e("option",{value:t,children:t.replaceAll("_"," ").toUpperCase()},"user-filter-order"+t))]})]}),O.length>0&&s(u,{xs:12,md:3,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Limit"}),s(a.Select,{size:"sm","aria-label":"order",value:i.limit,onChange:t=>{g({...i,limit:t.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Limit"}),O.map(t=>e("option",{value:t,children:t},"user-filter-order"+t))]})]})]}),s(f,{children:[e(u,{xs:12,md:10,children:s(a.Group,{controlId:"search",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Search"}),e(be,{sx:{textTransform:"capitalize"},size:"small",fullWidth:!0,value:N,onChange:t=>b(t.target.value),placeholder:y})]})}),e(u,{xs:12,md:2,style:{display:"flex",justifyContent:"end",alignItems:"flex-end"},children:s("div",{className:"text-end",children:[e("button",{className:"btn btn-success btn-sm mr-2",onClick:C,children:"Filter"}),e("button",{className:"btn btn-warning btn-sm",type:"reset",onClick:m,children:"Reset"})]})})]})]})})}function Ce({handelCloseModal:p,element:r,setElement:i}){const[g,m]=c.useState(!1),[T,C]=c.useState({});c.useState({task_status:"",comment:""});const[y,N]=c.useState([]),b=r.slug;c.useEffect(()=>{I.get("/roles-by-company",{}).then(({data:o})=>{N(o.data)}).catch(o=>{console.error("Error loading role list:",o)})},[]);const[x]=ne(),[_]=ie(),t=async o=>{var F;o.preventDefault();let d=new FormData;d.append("first_name",r.first_name),d.append("last_name",r.last_name),d.append("user_name",r.user_name),d.append("email",r.email),d.append("phone",r.phone),d.append("emergency_contact",r.emergency_contact),d.append("dob",r.dob),d.append("gender",r.gender),d.append("profile",r.profile),d.append("role",r.role),d.append("active",r.active),d.append("attachment",r.attachment),b&&`${r.slug}`;try{let l;b?l=await _({slug:b,formData:d}).unwrap():l=await x({formData:d}).unwrap(),L("success",l==null?void 0:l.message,l==null?void 0:l.description),p()}catch(l){if(l.status===406){const v=l.errorData;L("error",v.message,v.description)}else l.status===422?(C((F=l.errorData)==null?void 0:F.errors),L("error",l==null?void 0:l.message)):(L("error",(l==null?void 0:l.message)||"An error occurred",(l==null?void 0:l.description)||"Please try again later."),C({}))}},S=o=>{const d=o.target.files[0];i({...r,avatar:URL.createObjectURL(d),attachment:o.target.files[0]})};return s(E,{children:[e(Q,{loaderVisible:g}),s(w,{show:!0,onHide:p,backdrop:"static",keyboard:!1,size:"lg",children:[e(w.Header,{closeButton:!0,children:e(w.Title,{children:b?"Update Profile: "+r.username:"Add new user"})}),e(w.Body,{children:e(ue,{children:s(a,{children:[s(f,{children:[e(u,{xs:12,md:6,children:s(a.Group,{className:"mb-3",controlId:"first_name",children:[e(a.Label,{children:e("b",{children:"First Name"})}),e(a.Control,{type:"text",value:r.first_name==null?"":r.first_name,autoFocus:!0,className:"border-primary",onChange:o=>{i({...r,first_name:o.target.value})}})]})}),e(u,{xs:12,md:6,children:s(a.Group,{className:"mb-3",controlId:"last_name",children:[e(a.Label,{children:e("b",{children:"Last Name"})}),e(a.Control,{type:"text",value:r.last_name==null?"":r.last_name,autoFocus:!0,className:"border-primary",onChange:o=>{i({...r,last_name:o.target.value})}})]})})]}),s(f,{children:[e(u,{xs:12,md:6,children:s(a.Group,{className:"mb-3",controlId:"user_name",children:[e(a.Label,{children:e("b",{children:"User Name"})}),e(a.Control,{type:"text",value:r.user_name==null?"":r.user_name,autoFocus:!0,className:"border-primary",onChange:o=>{i({...r,user_name:o.target.value})}})]})}),e(u,{xs:12,md:6,children:s(a.Group,{className:"mb-3",controlId:"first_name",children:[e(a.Label,{children:e("b",{children:"Email"})}),e(a.Control,{type:"email",value:r.email==null?"":r.email,autoFocus:!0,className:"border-primary",onChange:o=>{i({...r,email:o.target.value})}})]})})]}),e("hr",{}),s(f,{children:[e(u,{xs:12,md:6,children:s(a.Group,{className:"mb-3",controlId:"phone",children:[e(a.Label,{children:e("b",{children:"Phone"})}),e(a.Control,{type:"text",value:r.phone==null?"":r.phone,autoFocus:!0,className:"border-primary",onChange:o=>{i({...r,phone:o.target.value})}})]})}),e(u,{xs:12,md:6,children:s(a.Group,{className:"mb-3",controlId:"emergency_contact",children:[e(a.Label,{children:e("b",{children:"Emergency Contract"})}),e(a.Control,{type:"text",value:r.emergency_contact==null?"":r.emergency_contact,autoFocus:!0,className:"border-primary",onChange:o=>{i({...r,emergency_contact:o.target.value})}})]})})]}),e("hr",{}),s(f,{children:[e(u,{xs:12,md:4,children:s(a.Group,{className:"mb-3",controlId:"dob",children:[e(a.Label,{children:e("b",{children:"Date of Birth"})}),e(a.Control,{type:"date",value:r.dob,className:"border-primary",onChange:o=>{i({...r,dob:o.target.value})}})]})}),e(u,{xs:12,md:4,children:s(a.Group,{controlId:"gender",children:[e(a.Label,{children:e("b",{children:"Gender"})}),s(a.Select,{"aria-label":"Gender",className:"border-primary",onChange:o=>{i({...r,gender:o.target.value})},children:[e("option",{defaultValue:!0,children:"Select Gender"}),e("option",{value:"male",children:"Male"}),e("option",{value:"female",children:"Female"})]})]})}),s(u,{xs:12,md:4,children:[e(a.Label,{children:e("b",{children:"Roles"})}),s(a.Select,{value:r.role,"aria-label":"Roles",className:"border-primary",onChange:o=>{i({...r,role:o.target.value})},children:[e("option",{defaultValue:!0,children:"Set user role"}),y.length>0?y.map(o=>e("option",{value:o.id,children:o.role.toUpperCase()},o.id)):e("option",{defaultValue:!0,children:"User Role"})]})]})]}),e("hr",{}),e(f,{children:e(u,{xs:12,md:12,children:s(a.Group,{controlId:"avatar",style:{textAlign:"center"},children:[e(q,{src:r.avatar,style:{height:"150px",width:"150px"}}),e(a.Control,{type:"file",className:"border-primary",onChange:S})]})})})]})})}),s(w.Footer,{children:[e(D,{variant:"danger",onClick:p,children:"Close"}),e(D,{variant:"primary",onClick:o=>t(o),children:"Update"})]})]})]})}const H={id:"",slug:"",first_name:"",last_name:"",username:"",email:"",phone:"",emergency_contract:"",dob:"",gender:"",avatar:"",role:"",active:"",profile:"",attachment:"",options:[]},j={orderBy:"",order:"",limit:"",role:""};function Je(){const[p,r]=c.useState(1),[i,g]=c.useState(0),[m,T]=c.useState(""),{applicationSettings:C,userRole:y,userPermission:N}=c.useContext(ce),[b,x]=c.useState([]),[_,t]=c.useState(H),[S,o]=c.useState(!0),[d,F]=c.useState(!1),[l,v]=c.useState(!1),[U,G]=c.useState(j),{num_data_per_page:Y}=C,[M,k]=c.useState(!1),$=[{id:"profile",label:"Avatar",align:"center"},{id:"username",label:"User Name",align:"center"},{id:"role",label:"Role",align:"center"},{id:"gender",label:"Gender",align:"center"},{id:"active",label:"Active",align:"center"}],R=Number(U.limit)>0?Number(U.limit):Y,W=Math.ceil(i/R),J=b.filter(n=>n.username.toLowerCase().includes(m.toLowerCase())||n.first_name.toLowerCase().includes(m.toLowerCase())||n.last_name.toLowerCase().includes(m.toLowerCase())||n.email.toLowerCase().includes(m.toLowerCase())||n.phone.toLowerCase().includes(m.toLowerCase())||n.role.toLowerCase().includes(m.toLowerCase())).map(n=>(n.profile=e(q,{src:n.avatar,roundedCircle:!0,style:{height:"50px",width:"50px"}}),n.active=e("span",{className:"text-success",children:n.active}),n.attachment="",n)),K=n=>{de.fire({title:"Are you sure?",text:"You will not be able to recover the user !",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, remove it!",cancelButtonText:"Cancel"}).then(A=>{A.isConfirmed&&I.delete(`user/${n.id}`).then(h=>{V(),L("success",h==null?void 0:h.message,h==null?void 0:h.description)}).catch(h=>{if(h.response){const B=h.response.data;L("error",B==null?void 0:B.message,B.description)}})})},X=n=>{t(n),v(!0)},Z=()=>{t(H),v(!0)},ee=()=>{v(!1)},re=n=>{F(!0),t(n)},V=()=>{o(!0),I.get("/users",{params:{currentPage:p,pageSize:R,...U}}).then(({data:n})=>{o(!1),x(n.data),g(n.total)}).catch(()=>{o(!1)})};c.useEffect(()=>{document.title="Manage Users",V()},[p,R,M]);const ae=(n,A)=>{r(A)},te=()=>{G(j),k(!M)},oe=()=>{k(!M)},se=()=>e(fe,{search:{filterByText:!0,placeHolderTxt:"Search Task...",searchBoxValue:m,handelSearch:T},query:U,setQuery:G,resetFilterParameter:te,getUser:V,handelFilter:oe}),le=[{actionName:"Edit",type:"modal",route:"",actionFunction:X,permission:"user_edit",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:re,permission:"user_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:K,permission:"user_delete",textClass:"text-danger"}];return s("div",{children:[e(Q,{loaderVisible:S}),e(he,{cardTitle:"List of Users",addBTN:{permission:me("user_create"),txt:"Add New User",icon:e(pe,{icon:"eva:plus-fill"}),linkTo:"modal",link:Z},paginations:{totalPages:W,totalCount:i,currentPage:p,handlePageChange:ae},table:{size:"small",ariaLabel:"user table",showIdColumn:y==="admin",tableColumns:$,tableBody:{loading:S,loadingColSpan:6,rows:J},actionButtons:le},filter:se}),l&&e(Ce,{handelCloseModal:ee,element:_,setElement:t})]})}export{Je as default};
