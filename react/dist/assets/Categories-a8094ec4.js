import{j as e,F as q,a as r,r as o,S as ee,V as te,e as ae,W as oe,X as re,Y as ne,d as se}from"./index-8e1ee696.js";import{M as ie,ae as le,K as ce}from"./index-74298ed0.js";import{R as M,a as C,b as de,d as me,n as f}from"./AuthRoutes-2e952a6b.js";import{C as ue}from"./CommonTable-27ef35ac.js";import{C as pe}from"./Card-e4e45dfb.js";import{S as he}from"./Stack-0f0f80e9.js";import{F as i}from"./Form-833e738d.js";import{M as S}from"./Modal-bc712426.js";import{B as ge}from"./Button-0b808ca5.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./TableRow-3c1023d1.js";import"./jsx-runtime_commonjs-proxy-221d5456.js";import"./isMuiElement-18bae589.js";import"./useId-bebd534a.js";import"./useControlled-c67091af.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./CardContent-2022634c.js";import"./Typography-e228ba3d.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./LastPage-4ffce3d8.js";import"./CardHeaderContext-cb83d0a9.js";function ye(v){const{search:N,query:s,setQuery:h,resetFilterParameter:m,placeHolderTxt:b}=v;return e(q,{children:e(pe,{className:"p-3",style:{borderBottom:"1px solid"},children:r(he,{gap:3,children:[r(M,{className:"g-3",children:[e(C,{md:4,children:r(i.Group,{controlId:"search",children:[e(i.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Search"}),e(i.Control,{type:"text",size:"sm",value:s==null?void 0:s.searchTerm,onChange:l=>h({...s,searchTerm:l.target.value}),placeholder:b,style:{textTransform:"capitalize"}})]})}),e(C,{md:2,children:r(i.Group,{controlId:"order",children:[e(i.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Order"}),r(i.Select,{size:"sm",value:s.orderBy,onChange:l=>h({...s,orderBy:l.target.value}),children:[e("option",{value:"ASC",children:"Ascending"}),e("option",{value:"DESC",children:"Descending"})]})]})}),e(C,{md:2,children:r(i.Group,{controlId:"limit",children:[e(i.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Limit"}),r(i.Select,{size:"sm",value:s.limit,onChange:l=>h({...s,limit:l.target.value}),children:[e("option",{value:"",children:"Limit"}),e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"50",children:"50"}),e("option",{value:"100",children:"100"}),e("option",{value:"500",children:"500"})]})]})})]}),e(M,{className:"justify-content-end",children:e(C,{md:4,className:"text-end",children:e(de,{variant:"warning",size:"sm",onClick:m,children:"Reset"})})})]})})})}const Ce=[{id:"name",label:" Category Name",align:"left"},{id:"type",label:"Category Type",align:"left"}],D={searchTerm:"",orderBy:"DESC",limit:10,selectedSectorId:"",type:""};function et(){const[v,N]=o.useState([]),[s,h]=o.useState(!1),[m,b]=o.useState(0),[l,P]=o.useState(0),[w,fe]=o.useState(null),[c,F]=o.useState(D),[A,B]=o.useState(!1),[_,Se]=o.useState(""),[ve,z]=o.useState(!1),[be,T]=o.useState(!1),[n,g]=o.useState({id:null,sector_id:null,name:"",type:"income"}),[I,k]=o.useState([]),{applicationSettings:H,userRole:j,userPermission:we}=o.useContext(ee),{num_data_per_page:E}=H,x=Number(c.limit)>0?Number(c.limit):E||10,G=Math.ceil(l/x),{data:d,isFetching:L,isError:xe}=te({currentPage:m,pageSize:x,query:c},{skip:!x,refetchOnMountOrArgChange:A}),{user:Ne,token:Q}=ae(),{data:u,isFetching:Fe,isError:Be}=oe({token:Q}),[R]=re(),[O]=ne();o.useEffect(()=>{document.title="Categories",d!=null&&d.data?(N(d.data),P(d.total),T(!1)):T(!0),B(!1)},[d,m]),o.useEffect(()=>{u!=null&&u.data&&k(u.data)},[u]);const Y=async t=>{t.preventDefault();const p=n.id?`/category/${n==null?void 0:n.id}`:"/category/add";try{const a=await R({url:p,formData}).unwrap();f("success",a==null?void 0:a.message,a==null?void 0:a.description),y(!1)}catch(a){setSaveBtnTxt("Save"),f("error",(a==null?void 0:a.message)||"An error occurred",(a==null?void 0:a.description)||"Please try again later.")}},$=()=>{F(D),setHasFilter(!hasFilter)},U=()=>e(ye,{placeHolderTxt:"Search by name...",query:c,setQuery:F,resetFilterParameter:$}),V=v.filter(t=>t.name.toLowerCase().includes(_.toLowerCase())),[K,y]=o.useState(!1),W=()=>{y(!1)},X=(t,p)=>{b(p),B(!0)},J=()=>{z(!0),y(!0)},Z=[{actionName:"Edit",type:"modal",route:"",actionFunction:t=>{g(t),y(!0)},permission:"company_edit",textClass:"text-info"},{actionName:"Delete",type:"modal",route:"",actionFunction:async t=>{se.fire({title:"Are you sure?",text:`You won't be able to revert the deletion of company ${t.name}!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async p=>{if(p.isConfirmed)try{const a=await O({id:t.id}).unwrap();f("success",a.message,a.description)}catch(a){f("error",a.data.message,a.data.description||"An error occurred.")}})},permission:"company_delete",textClass:"text-danger"}];return r("div",{children:[e(ie,{loaderVisible:L}),e(ue,{cardTitle:"List of Categories",addBTN:{permission:me("company_create"),txt:"Create New",icon:e(le,{icon:ce}),linkTo:"modal",link:J},paginations:{totalPages:G,totalCount:l,currentPage:m,handlePageChange:X},table:{size:"small",ariaLabel:"company table",showIdColumn:j==="admin",tableColumns:Ce,tableBody:{loading:s,loadingColSpan:6,rows:V},actionButtons:Z},filter:U,loading:L,loaderRow:c==null?void 0:c.limit,loaderCol:5}),r(S,{show:K,onHide:W,animation:!1,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e(S.Header,{closeButton:!0,children:e(S.Title,{children:n.id?"Update Category":"Add New Category"})}),r(S.Body,{children:[e("div",{className:"row",children:e("div",{className:"col-md-12",children:w&&e("div",{className:"alert alert-danger",children:e("ul",{className:"mt-0 mb-0",children:Object.keys(w).map(t=>e("li",{children:w[t][0]},t))})})})}),r("form",{onSubmit:Y,children:[r("div",{className:"row",children:[r("div",{className:"col-md-6",children:[e("label",{children:"Category Name"}),e("input",{type:"text",className:"form-control mb-3",value:n.name,onChange:t=>g({...n,name:t.target.value})})]}),r("div",{className:"col-md-6",children:[e("label",{children:"Category Type"}),r("select",{className:"form-control mb-3",value:n.type,onChange:t=>g({...n,type:t.target.value}),children:[e("option",{value:"income",children:"Income"}),e("option",{value:"expense",children:"Expense"})]})]}),r("div",{className:"col-md-6",children:[e("label",{children:"Sector"}),e("select",{className:"form-control mb-3",value:n.sector_id,onChange:t=>g({...n,sector_id:t.target.value}),children:I.map(t=>e("option",{value:t.value,children:t.label},t.value))})]})]}),e(ge,{variant:"contained",color:"primary",type:"submit",children:n.id?"Update Category":"Add Category"})]})]})]})]})}export{et as default};
