import{r as o,G as $,j as e,F as M,a as i,af as ne,ag as le,S as re,ah as se,ai as ie,d as ce}from"./index-8e1ee696.js";import{M as j}from"./index-74298ed0.js";import{R as G,a as f,b as R,C as de,n as k,e as H,d as ue}from"./AuthRoutes-2e952a6b.js";import{I as me}from"./Iconify-5a94efd0.js";import{C as pe}from"./CommonTable-27ef35ac.js";import{a as he}from"./CardContent-2022634c.js";import{F as n}from"./Form-833e738d.js";import{M as B}from"./Modal-bc712426.js";import{S as be}from"./react-select.esm-c00a6ec0.js";import{T as fe}from"./TextField-029e5f7c.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./TableRow-3c1023d1.js";import"./jsx-runtime_commonjs-proxy-221d5456.js";import"./isMuiElement-18bae589.js";import"./useId-bebd534a.js";import"./useControlled-c67091af.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./Typography-e228ba3d.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./LastPage-4ffce3d8.js";import"./classCallCheck-25f3f0e0.js";import"./FormLabel-e3756905.js";import"./utils-a73c94d0.js";import"./useFormControl-e95281cb.js";import"./Select-2ff9a889.js";function ge(g){const{search:C,query:t,setQuery:u,resetFilterParameter:h,placeHolderTxt:x}=g,[S,w]=o.useState([]),{data:r,isFetching:N,isError:T}=$({currentPage:"",pageSize:100});return o.useEffect(()=>{(r==null?void 0:r.data.length)>0&&w(r==null?void 0:r.data)},[r]),e(M,{children:i(he,{style:{borderBottom:"1px solid"},children:[i(G,{className:"g-3",children:[i(f,{xs:12,md:3,children:[e(n.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Account"}),i(n.Select,{value:t.account_id,"aria-label":"Account",onChange:l=>{u({...t,account_id:l.target.value})},children:[e("option",{defaultValue:!0,children:"Account"}),S.length>0?S.map(({id:l,bank_name:y,account_number:v})=>e("option",{value:l,children:y+"("+v+")"},l)):e("option",{defaultValue:!0,children:"Account"})]})]}),e(f,{md:4,children:i(n.Group,{controlId:"search",children:[e(n.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Search"}),e(n.Control,{type:"text",size:"sm",value:t==null?void 0:t.searchTerm,onChange:l=>u({...t,searchTerm:l.target.value}),placeholder:x,style:{textTransform:"capitalize"}})]})}),e(f,{md:2,children:i(n.Group,{controlId:"start-date",children:[e(n.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"From"}),e(n.Control,{type:"date",size:"sm",value:t.start_date,onChange:l=>u({...t,start_date:l.target.value})})]})}),e(f,{md:2,children:i(n.Group,{controlId:"end-date",children:[e(n.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"To"}),e(n.Control,{type:"date",size:"sm",value:t.end_date,onChange:l=>u({...t,end_date:l.target.value})})]})}),e(f,{md:2,children:i(n.Group,{controlId:"order",children:[e(n.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Order"}),i(n.Select,{size:"sm",value:t.orderBy,onChange:l=>u({...t,orderBy:l.target.value}),children:[e("option",{value:"ASC",children:"Ascending"}),e("option",{value:"DESC",children:"Descending"})]})]})}),e(f,{md:2,children:i(n.Group,{controlId:"limit",children:[e(n.Label,{className:"custom-form-label",style:{marginBottom:"0px"},children:"Limit"}),i(n.Select,{size:"sm",value:t.limit,onChange:l=>u({...t,limit:l.target.value}),children:[e("option",{value:"",children:"Limit"}),e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"50",children:"50"}),e("option",{value:"100",children:"100"}),e("option",{value:"500",children:"500"})]})]})})]}),e(G,{className:"justify-content-end",children:e(f,{md:4,className:"text-end",children:e(R,{variant:"warning",size:"sm",onClick:h,children:"Reset"})})})]})})}const ye={amount:{label:"",value:""},person:"",date:"",note:"",account:{label:"",value:""},type:{label:"",value:""}},Ce=[{label:"Lend(Give Loan to Others)",value:"lend"},{label:"Borrow(Taken Loan From Others)",value:"borrow"}];function Se({show:g,closeFunc:C}){ne();const[t,u]=o.useState(ye),[h,x]=o.useState(!1),[S,w]=o.useState([]),{data:r}=$({currentPage:"",pageSize:100}),[N]=le(),T=async c=>{c.preventDefault();let s=new FormData;s.append("amount",t.amount),s.append("date",t.date),s.append("person",t.person),s.append("account_id",t.account.value),s.append("note",t.note),s.append("type",t.type.value);try{const a=await N({url:"/debts/store",formData:s}).unwrap();k("success",a==null?void 0:a.message,a==null?void 0:a.description),C()}catch(a){k("error",(a==null?void 0:a.message)||"An error occurred",(a==null?void 0:a.description)||"Please try again later.")}},l=(c,s)=>{u({...t,[s]:c.target.value})},y=[[{name:"amount",type:"number",label:"Amount",placeholder:"Input an amount...",size:"small",colXS:12,colMD:6,col:12,value:t.amount,shrink:!0},{name:"person",type:"text",label:"Person",placeholder:"Input person name...",size:"small",colXS:12,colMD:6,col:12,value:t.person,shrink:!0}],[{name:"date",type:"date",label:"Date",placeholder:"date...",size:"small",colXS:12,colMD:6,col:12,value:t.date,shrink:!0},{name:"account",type:"select",label:"Bank Account",placeholder:"Select Bank Account",size:"small",colXS:12,colMD:6,col:12,value:t.account,shrink:!0,options:S}],[{name:"type",type:"select",label:"Debt Type",placeholder:"Select Debt Type",size:"small",colXS:12,colMD:6,col:12,value:t.type,shrink:!0,options:Ce},{name:"note",type:"text",label:"Note",placeholder:"Note...",size:"small",colXS:12,colMD:6,col:12,value:t.note,shrink:!0}]],v=c=>c.map(({colXS:s,shrink:a,options:L,colMD:P,type:_,label:I,name:b,size:z,value:D})=>e(f,{sm:s,md:P,children:_==="select"?i(M,{children:[e(be,{className:"basic-single",classNamePrefix:"select",value:D,isSearchable:!0,name:b,isLoading:!1,options:L,onChange:A=>{u({...t,[b]:A})}}),e(M,{})]}):e(M,{children:e(fe,{fullWidth:!0,type:_,label:I,id:b,name:b,defaultValue:D,InputLabelProps:{shrink:a},size:z,onBlur:A=>{l(A,b)}})})},"debt-col-"+H(8))),m=c=>c.map(s=>e(G,{className:"mb-2",children:v(s)},"debt-row-"+H(8)));return o.useEffect(()=>{if((r==null?void 0:r.data.length)>0){const c=r==null?void 0:r.data.map(({id:s,bank_name:a,account_number:L})=>({value:s,label:a+"("+L+")"}));w(c)}},[r]),i(M,{children:[e(j,{loaderVisible:h}),i(B,{show:g,onHide:C,backdrop:"static",keyboard:!1,size:"lg",children:[e(B.Header,{closeButton:!0,children:e(B.Title,{children:"Add new Debt"})}),e(B.Body,{children:e(de,{children:e(n,{children:m(y)})})}),i(B.Footer,{children:[e(R,{variant:"danger",onClick:C,children:"Close"}),e(R,{variant:"primary",onClick:c=>T(c),children:"Add Employee"})]})]})]})}const X={type:"",account_id:"",orderBy:"",order:"",limit:10,end_date:"",start_date:""},Q={id:null,amount:0,account_id:null,type:"",person:"",date:null,note:""};function Ue(){const[g,C]=o.useState(1),[t,u]=o.useState(0),[h,x]=o.useState(""),[S,w]=o.useState([]),[r,N]=o.useState(Q),[T,l]=o.useState(!1),[y,v]=o.useState(!1),[m,c]=o.useState(X),[s,a]=o.useState(!1),[L,P]=o.useState(""),{applicationSettings:_,userRole:I}=o.useContext(re),{num_data_per_page:b}=_,[z,D]=o.useState(!1),A=[{id:"person",label:"Person",align:"left"},{id:"type",label:"Type",align:"left"},{id:"date",label:"date",align:"left"},{id:"amount",label:"Amount",align:"right"}],V=Number(m.limit)>0?Number(m.limit):b||10,O=Math.ceil(t/V),{data:d,isFetching:Y}=se({currentPage:g,pageSize:V,query:m}),[W]=ie(),J=p=>{ce.fire({title:"Are you sure?",text:`You will not be able to recover the debt amount of ${p.amount}!`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(async E=>{if(E.isConfirmed)try{const F=await W({id:p.id}).unwrap();k("success",F.message,F.description)}catch(F){k("error",F.message,F.description||"An error occurred.")}})},K=()=>{v(!0)},U=()=>{v(!1),N(Q)};o.useEffect(()=>{document.title="Debts / Loan",d!=null&&d.data?(w(d==null?void 0:d.data),u(d==null?void 0:d.total),a(!1),P(`Showing ${d==null?void 0:d.data.length} results of ${d.total}`)):a(!0)},[g,d]);const Z=S.filter(p=>p.amount.includes(h)||p.type.toLowerCase().includes(h.toLowerCase())||p.person.toLowerCase().includes(h.toLowerCase())).map(p=>p),q=()=>{c(X),D(!z),x("")},ee=()=>{D(!z)},te=()=>e(ge,{search:{filterByText:!0,placeHolderTxt:"Search Task...",searchBoxValue:h,handelSearch:x},query:m,setQuery:c,resetFilterParameter:q,handelFilter:ee}),ae=[{actionName:"Edit",type:"modal",route:"/manage-debt/",actionFunction:"",permission:"debt_edit",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:y,permission:"debt_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:J,permission:"debt_delete",textClass:"text-danger"}],oe=(p,E)=>{C(E)};return i("div",{children:[e(j,{loaderVisible:T}),e(pe,{cardTitle:"Debt Lists",cardSubTitle:L,addBTN:{permission:ue("debt_create"),txt:"Add Debt",icon:e(me,{icon:"eva:plus-fill"}),linkTo:"modal",link:K},paginations:{totalPages:O,totalCount:t,currentPage:g,handlePageChange:oe},table:{size:"small",ariaLabel:"debt table",showIdColumn:I==="admin",tableColumns:A,tableBody:{loading:T,loadingColSpan:9,rows:Z},actionButtons:ae},filter:te,loading:Y,loaderRow:m==null?void 0:m.limit,loaderCol:3}),y&&e(Se,{show:y,closeFunc:U})]})}export{Ue as default};
