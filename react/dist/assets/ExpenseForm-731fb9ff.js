import{r as c,G as M,$ as T,ab as D,ac as P,j as a,F as v,a as o}from"./index-8e1ee696.js";import{W as R}from"./WizCard-c3a4d722.js";import{M as j}from"./index-74298ed0.js";import{R as h,a as i,b as N,n as C}from"./AuthRoutes-2e952a6b.js";import{S}from"./react-select.esm-c00a6ec0.js";import{M as f}from"./Modal-bc712426.js";import{F as t}from"./Form-833e738d.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./classCallCheck-25f3f0e0.js";import"./toConsumableArray-46a81798.js";const z={id:null,amount:"",refundable_amount:0,description:"",reference:"",date:"",note:"",attachment:"",account:[],category:[]};function X({handelCloseModal:b,id:g}){const[e,l]=c.useState(z),[G,Q]=c.useState(!1);c.useState(null),c.useState(null),c.useState(null);const[A,E]=c.useState([]),[I,B]=c.useState([]),[L,x]=c.useState("Save");c.useState("Save & Exit");const{data:d}=M({currentPage:"",pageSize:100}),{data:u,isFetching:_}=T({categoryType:"expense"}),{data:m}=D({id:g}),[w]=P();c.useEffect(()=>{if((d==null?void 0:d.data.length)>0){const n=d==null?void 0:d.data.map(({id:s,bank_name:p,account_number:r})=>({value:s,label:p+"("+r+")"}));E(n)}(u==null?void 0:u.data.length)>0&&B(u==null?void 0:u.data),g&&(m!=null&&m.data)&&l(m==null?void 0:m.data)},[g,m,d]),c.useEffect(()=>{(e==null?void 0:e.date)===""&&l({...e,date:new Date().toISOString().split("T")[0]})},[e==null?void 0:e.date]);const y=async n=>{n.preventDefault(),x("Saving...");const s=new FormData;s.append("account_id",e.account.value),s.append("amount",e.amount),s.append("refundable_amount",e.refundable_amount),s.append("category_id",e.category.value),s.append("description",e.description),s.append("note",e.note),s.append("reference",e.reference),s.append("date",e.date),s.append("attachment",e.attachment);const p=e.id?`/expense/${e==null?void 0:e.id}`:"/expense/add";try{const r=await w({url:p,formData:s}).unwrap();C("success",r==null?void 0:r.message,r==null?void 0:r.description),b()}catch(r){x("Save"),C("error",(r==null?void 0:r.message)||"An error occurred",(r==null?void 0:r.description)||"Please try again later.")}},F=(n,s)=>{const p=n.target.files[0];l({...e,attachment:p})};return a(v,{children:o(f,{show:!0,centered:!0,onHide:b,backdrop:"static",keyboard:!1,size:"lg",children:[a(f.Header,{closeButton:!0,children:a(f.Title,{children:o("span",{children:[g?"Update":"Add"," Expense"]})})}),o(f.Body,{children:[a(j,{loaderVisible:G}),a(R,{className:"animated fadeInDown",children:o(t,{children:[a(h,{children:a(i,{xs:12,md:12,lg:12,sm:12,children:o(t.Group,{className:"mb-3",controlId:"description",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Description"}),a(t.Control,{as:"textarea",autoFocus:!0,rows:3,value:e.description??"",name:"description",onChange:n=>{l({...e,description:n.target.value})},placeholder:"Enter description"})]})})}),o(h,{children:[a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",controlId:"amount",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Amount"}),a(t.Control,{type:"number",placeholder:"i.g: 50 AED",value:e.amount,onChange:n=>{l({...e,amount:n.target.value})}})]})}),a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",controlId:"refundable_amount",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Refundable Amount"}),a(t.Control,{type:"number",placeholder:"i.g: 50 AED",value:e.refundable_amount,onChange:n=>{l({...e,refundable_amount:n.target.value})}})]})})]}),o(h,{children:[a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",controlId:"account",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Account"}),a(S,{className:"basic-single",classNamePrefix:"select",value:e.account,isSearchable:!0,name:"account",isLoading:!1,options:A,onChange:n=>{l({...e,account:n})}})]})}),a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",controlId:"category_id",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Category"}),a(S,{className:"basic-single",classNamePrefix:"select",value:e.category,isSearchable:!0,name:"category_id",isLoading:_,options:I,onChange:n=>{l({...e,category:n})}})]})})]}),o(h,{children:[a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",controlId:"date",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Date"}),a(t.Control,{type:"date",value:e.date,onChange:n=>{l({...e,date:n.target.value})}})]})}),a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",controlId:"reference",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Reference"}),a(t.Control,{type:"text",placeholder:"i.g: 50 AED",value:e.reference??"",onChange:n=>{l({...e,reference:n.target.value})}})]})})]}),o(h,{children:[a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",controlId:"note",children:[a(t.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Note"}),a(t.Control,{as:"textarea",rows:3,value:e.note??"",name:"note",onChange:n=>{l({...e,note:n.target.value})}})]})}),a(i,{xs:12,md:6,lg:6,sm:12,children:o(t.Group,{className:"mb-3",children:[a(t.Label,{children:"Add Attachment"}),a(t.Control,{type:"file",onChange:F})]})})]}),a("div",{className:"text-end",children:e.id?a(N,{variant:"warning",onClick:n=>y(n),children:"Update"}):a(v,{children:a(N,{variant:"primary",onClick:n=>y(n),className:"me-2 btn-sm",children:L})})})]})})]})]})})}export{X as default};
