import{r,aj as Be,$ as Ae,ak as Ge,al as He,a as t,F as D,j as e,am as Ve,an as $e,S as Ue,ao as ze,ap as Re,d as Qe}from"./index-8e1ee696.js";import{M as z,ae as ne,ax as Oe,ak as je}from"./index-74298ed0.js";import{C as R,R as k,a as c,b as M,n as w,P as Ye,d as Je}from"./AuthRoutes-2e952a6b.js";import{I as Ke}from"./Iconify-5a94efd0.js";import{C as We}from"./CommonTable-27ef35ac.js";import{M as m}from"./Modal-bc712426.js";import{S as A}from"./react-select.esm-c00a6ec0.js";import{F as a}from"./Form-833e738d.js";import{T as Xe}from"./TaskFilters-e7de5f81.js";import{T as Ze}from"./TaskHistoryModal-ca5d7074.js";import{I as qe}from"./Image-bab1f910.js";import{T as et,a as tt,e as at,c as st,d as nt}from"./TableRow-3c1023d1.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./jsx-runtime_commonjs-proxy-221d5456.js";import"./isMuiElement-18bae589.js";import"./useId-bebd534a.js";import"./useControlled-c67091af.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./CardContent-2022634c.js";import"./Typography-e228ba3d.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./LastPage-4ffce3d8.js";import"./classCallCheck-25f3f0e0.js";import"./TextField-029e5f7c.js";import"./FormLabel-e3756905.js";import"./utils-a73c94d0.js";import"./useFormControl-e95281cb.js";import"./Select-2ff9a889.js";const ot={description:"",category:{},employee_list:[],date:"",startTime:"",endTime:"",type:{label:"Income",value:"income"},amount:"",status:{},payment_status:{},workflow:[],comment:""};function rt({handelCloseModal:b,title:u,id:l}){var V;const[y,_]=r.useState({}),[L,T]=r.useState(!1),[s,h]=r.useState(ot),[F,d]=r.useState([]),[f,S]=r.useState(!1),{data:n,isFetching:oe,isError:K}=Be({id:l}),{data:C,isFetching:Q,isError:O}=Ae({categoryType:(V=s==null?void 0:s.type)==null?void 0:V.value});r.useEffect(()=>{l&&(n!=null&&n.data)&&h(n==null?void 0:n.data),(C==null?void 0:C.data.length)>0&&d(C==null?void 0:C.data)},[l,n,C]);const{data:I,isFetching:G,isError:W}=Ge({refetchOnMountOrArgChange:f}),j=I==null?void 0:I.data.map(({id:o,name:g})=>({value:o,label:g})),[Y]=He(),H=async o=>{var v;o.preventDefault();let g=new FormData;g.append("employee_list",JSON.stringify(s.employee_list)),g.append("description",s.description),g.append("categoryID",s.category.value),g.append("date",s.date),g.append("startTime",s.startTime),g.append("endTime",s.endTime),g.append("type",s.type.value),g.append("amount",s.amount),l||(g.append("status",s.status.value),g.append("payment_status",s.payment_status.value)),g.append("comment",s.comment);const $=l?`/task/${l}`:"/task/add";try{const i=await Y({url:$,formData:g}).unwrap();w("success",i==null?void 0:i.message,i==null?void 0:i.description),b()}catch(i){if(i.status===406){const E=i.errorData;w("error",E.message,E.description)}else i.status===422?(_((v=i.errorData)==null?void 0:v.errors),w("error",i==null?void 0:i.message)):(w("error",(i==null?void 0:i.message)||"An error occurred",(i==null?void 0:i.description)||"Please try again later."),_({}))}};return t(D,{children:[e(z,{loaderVisible:L}),t(m,{show:!0,onHide:b,backdrop:"static",keyboard:!1,size:"lg",children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:l?"Task Modify":"Task Add"})}),e(m.Body,{children:t(R,{children:[t("div",{className:"alert alert-warning",role:"alert",children:['If you make the payment status as "Paid/Done" from here, it has to be added the income separately.',e("br",{})]}),t(a,{children:[e(k,{children:e(c,{xs:12,md:12,children:t(a.Group,{className:"mb-3",controlId:"description",children:[e(a.Label,{children:"Task Description"}),e(a.Control,{as:"textarea",autoFocus:!0,rows:3,value:s.description,name:"description",onChange:o=>{h({...s,description:o.target.value})}}),y.description&&e("p",{className:"error-message mt-2",children:y.description[0]})]})})}),t(k,{children:[e(c,{xs:12,md:4,lg:4,sm:12,children:t(a.Group,{className:"mb-3",controlId:"date",children:[e(a.Label,{children:"Schedule Date"}),e(a.Control,{type:"date",value:s.date,onChange:o=>{h({...s,date:o.target.value})}}),y.date&&e("p",{className:"error-message mt-2",children:y.date[0]})]})}),e(c,{xs:12,md:4,lg:4,sm:12,children:t(a.Group,{className:"mb-3",controlId:"startTime",children:[e(a.Label,{children:"Schedule Start Time"}),e(a.Control,{type:"time",value:s.startTime,onChange:o=>{h({...s,startTime:o.target.value})}}),y.startTime&&e("p",{className:"error-message mt-2",children:y.startTime[0]})]})}),e(c,{xs:12,md:4,lg:4,sm:12,children:t(a.Group,{className:"mb-3",controlId:"endTime",children:[e(a.Label,{children:"Schedule End Time"}),e(a.Control,{type:"time",value:s.endTime,onChange:o=>{h({...s,endTime:o.target.value})}}),y.endTime&&e("p",{className:"error-message mt-2",children:y.endTime[0]})]})})]}),e("hr",{className:"border-danger"}),t(k,{children:[e(c,{xs:12,md:6,children:t(a.Group,{className:"mb-3",controlId:"type",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Type"}),e(A,{className:"basic-single",classNamePrefix:"select",value:s.type,isSearchable:!0,name:"type",isLoading:!1,options:[{label:"Income",value:"income"},{label:"Expense",value:"expense"}],onChange:o=>{h({...s,type:o,category:{}})}})]})}),e(c,{xs:12,md:6,children:t(a.Group,{className:"mb-3",controlId:"category",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Category"}),e(A,{className:"basic-single",classNamePrefix:"select",value:s.category,isSearchable:!0,name:"category",isLoading:Q,options:F,onChange:o=>{h({...s,category:o})}})]})})]}),t(k,{children:[e(c,{xs:12,md:4,children:t(a.Group,{className:"mb-3",controlId:"amount",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Amount"}),e(a.Control,{type:"number",placeholder:"i.g: 50 AED",value:s.amount,onChange:o=>{h({...s,amount:o.target.value})}}),y.amount&&e("p",{className:"error-message mt-2",children:y.amount[0]})]})}),!l&&t(D,{children:[e(c,{xs:12,md:4,children:t(a.Group,{className:"mb-3",controlId:"status",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Status"}),e(A,{className:"basic-single",classNamePrefix:"select",value:s.status,isSearchable:!0,name:"status",isLoading:!1,options:[{label:"Pending",value:"pending"},{label:"Complete",value:"complete"}],onChange:o=>{h({...s,status:o})}})]})}),e(c,{xs:12,md:4,children:t(a.Group,{className:"mb-3",controlId:"payment_status",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Payment Status"}),e(A,{className:"basic-single",classNamePrefix:"select",value:s.payment_status,isSearchable:!0,name:"payment_status",isLoading:!1,options:[{label:"Pending",value:"pending"},{label:"Paid",value:"paid"}],onChange:o=>{h({...s,payment_status:o})}})]})})]})]}),e("hr",{className:"border-danger"}),e(k,{children:e(c,{xs:12,md:12,children:t(a.Group,{className:"mb-3",controlId:"employee_id",children:[e(a.Label,{children:"Assign to"}),e("small",{children:e("a",{onClick:o=>{S(!0)},className:"text-muted p-1",children:e(ne,{icon:Oe})})}),e(A,{isMulti:!0,className:"basic-single",classNamePrefix:"select",value:s.employee_list,isSearchable:!0,name:"employee_id",isLoading:G,options:j,onChange:o=>{h({...s,employee_list:o})}})]})})}),e(k,{children:e(c,{xs:12,md:12,children:t(a.Group,{className:"mb-3",controlId:"comment",children:[e(a.Label,{children:" Comment(if any)"}),e(a.Control,{type:"text",placeholder:"if any comment, put here...",value:s.comment,onChange:o=>{h({...s,comment:o.target.value})}})]})})})]})]})}),t(m.Footer,{children:[e(M,{variant:"danger",onClick:b,children:"Close"}),e(M,{variant:"primary",onClick:o=>H(o),children:"Add Task"})]})]})]})}const lt=b=>Math.random().toString(36).substring(2,b+2);function it({handelCloseModal:b,element:u}){return e(D,{children:t(m,{show:!0,onHide:b,backdrop:"static",keyboard:!1,size:"lg",children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:u.description})}),e(m.Body,{children:t(R,{children:[t(k,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Details"}),t(c,{xs:12,md:4,children:[e("strong",{children:"Task Details: "}),u.description]}),t(c,{xs:12,md:4,children:[e("strong",{children:"Amount: "}),u.amount]}),t(c,{xs:12,md:4,children:[e("strong",{children:"Task Type: "}),u.type]})]}),e(k,{className:"border p-2",children:t(c,{xs:12,md:12,children:[e("strong",{children:"Scheduled Slot: "}),u.slot]})}),t(k,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"Status"}),t(c,{xs:12,md:6,children:[e("strong",{children:"Task Status: "}),u.status]}),t(c,{xs:12,md:6,children:[e("strong",{children:"Payment Status: "}),u.payment_status]})]}),t(k,{className:"border p-2",children:[e("strong",{className:"text-primary",children:"History"}),e(et,{component:Ye,children:e(tt,{size:"small","aria-label":"show-task-history",children:e(at,{children:u.workflow.map((l,y)=>e(D,{children:e(st,{children:t(nt,{scope:"row",style:{textAlign:"left"},children:[e(qe,{src:l.avatar,roundedCircle:!0,style:{height:"40px",width:"40px",padding:"3px"}}),t("small",{children:[" [",l.type.replaceAll("_"," "),"] "]}),l.userName+" "+l.description,t("small",{className:"text-muted",children:["(",l.date_time,")"]})]})},lt(8))}))})})})]})]})}),e(m.Footer,{children:e(M,{variant:"danger",onClick:b,children:"Close"})})]})})}function ct({showModal:b,handelCloseModal:u,element:l,getFunc:y}){const[_,L]=r.useState(!1),[T,s]=r.useState({amount:0,payment_status:"",comment:""}),[h]=Ve(),F=async d=>{d.preventDefault();let f=new FormData;f.append("amount",T.amount),f.append("payment_status",T.payment_status),f.append("comment",T.comment);const S=`/update-task-payment-status/${l.id}`;try{const n=await h({url:S,formData:f}).unwrap();w("success",n==null?void 0:n.message,n==null?void 0:n.description),u()}catch(n){w("error",(n==null?void 0:n.message)||"An error occurred",(n==null?void 0:n.description)||"Please try again later.")}};return t(D,{children:[e(z,{loaderVisible:_}),t(m,{show:!0,onHide:u,backdrop:"static",keyboard:!1,size:"lg",children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:l.description})}),e(m.Body,{children:e(R,{children:t(a,{children:[t(k,{children:[e(c,{xs:12,md:6,children:t(a.Group,{className:"mb-3",controlId:"amountUpdate",children:[e(a.Label,{children:" Amount"}),e(a.Control,{type:"number",placeholder:"i.g: 50 AED",autoFocus:!0,onChange:d=>{s({...T,amount:d.target.value})}})]})}),e(c,{xs:12,md:6,children:t(a.Group,{className:"mb-3",controlId:"payment_status",children:[e(a.Label,{children:"Payment Status"}),t(a.Select,{"aria-label":"Payment Status",onChange:d=>{s({...T,payment_status:d.target.value})},children:[e("option",{defaultValue:!0,children:"Select Payment Status"}),e("option",{value:"pending",children:"Pending"}),e("option",{value:"paid",children:"Paid"})]})]})})]}),e(k,{children:e(c,{xs:12,md:12,children:t(a.Group,{className:"mb-3",controlId:"comment",children:[e(a.Label,{children:" Comment(if any)"}),e(a.Control,{type:"text",placeholder:"if any comment, put here...",autoFocus:!0,onChange:d=>{s({...T,comment:d.target.value})}})]})})})]})})}),t(m.Footer,{children:[e(M,{variant:"danger",onClick:u,children:"Close"}),e(M,{variant:"primary",onClick:d=>F(d),children:"Update"})]})]})]})}function dt({showModal:b,handelCloseModal:u,element:l,getFunc:y}){const[_,L]=r.useState(!1),[T,s]=r.useState({task_status:"",comment:""}),[h]=$e(),F=async d=>{d.preventDefault();let f=new FormData;f.append("task_status",T.task_status),f.append("comment",T.comment);const S=`/update-task-status/${l.id}`;try{const n=await h({url:S,formData:f}).unwrap();w("success",n==null?void 0:n.message,n==null?void 0:n.description),u()}catch(n){w("error",(n==null?void 0:n.message)||"An error occurred",(n==null?void 0:n.description)||"Please try again later.")}};return t(D,{children:[e(z,{loaderVisible:_}),t(m,{show:!0,onHide:u,backdrop:"static",keyboard:!1,size:"lg",children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:l.description})}),e(m.Body,{children:e(R,{children:t(a,{children:[e(k,{children:e(c,{xs:12,md:12,children:t(a.Group,{className:"mb-3",controlId:"task_status",children:[e(a.Label,{children:"Task Status"}),t(a.Select,{"aria-label":"Payment Status",onChange:d=>{s({...T,task_status:d.target.value})},children:[e("option",{defaultValue:!0,children:"Select Task Status"}),e("option",{value:"pending",children:"Pending"}),e("option",{value:"complete",children:"Complete"}),e("option",{value:"cancelled",children:"Cancel"})]})]})})}),e(k,{children:e(c,{xs:12,md:12,children:t(a.Group,{className:"mb-3",controlId:"comment",children:[e(a.Label,{children:" Comment(if any)"}),e(a.Control,{type:"text",placeholder:"if any comment, put here...",autoFocus:!0,onChange:d=>{s({...T,comment:d.target.value})}})]})})})]})})}),t(m.Footer,{children:[e(M,{variant:"danger",onClick:u,children:"Close"}),e(M,{variant:"primary",onClick:d=>F(d),children:"Update"})]})]})]})}const ae={description:"",employee:"",categoryID:"",employee_list:[],date:"",startTime:"",endTime:"",type:"income",amount:"",status:"pending",payment_status:"pending",workflow:[],comment:""},se={employee_id:"",status:"",payment_status:"",orderBy:"",order:"",limit:10,category_id:"",end_date:"",start_date:""};function Yt(){const[b,u]=r.useState(1),[l,y]=r.useState(0),[_,L]=r.useState(""),{applicationSettings:T,userRole:s,userPermission:h}=r.useContext(Ue),[F,d]=r.useState([]),[f,S]=r.useState(ae),[n,oe]=r.useState(!0),[K,C]=r.useState(!1),[Q,O]=r.useState(!1),[I,G]=r.useState(!1),[W,j]=r.useState([]),[Y,H]=r.useState(!1),[V,o]=r.useState(!1),[g,$]=r.useState(!1),[v,i]=r.useState(se),{num_data_per_page:E}=T,[re,X]=r.useState(!1),[le,ie]=r.useState(""),[Z,q]=r.useState(!1),ce=[{id:"description",label:"Description",align:"left"},{id:"amount",label:"Amount",align:"right"},{id:"slot",label:"Slot",align:"left"},{id:"status",label:"Status",align:"left"},{id:"payment_status",label:"Payment",align:"left"},{id:"history",label:"History",align:"left"},{id:"type",label:"Type",align:"left"}],ee=Number(v.limit)>0?Number(v.limit):E||10,de=Math.ceil(l/ee),{data:N,isFetching:me,isError:mt}=ze({currentPage:b,pageSize:ee,query:v},{refetchOnMountOrArgChange:re}),[ue]=Re(),pe=p=>{Qe.fire({title:"Are you sure?",text:"You will not be able to recover the task!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, remove it!",cancelButtonText:"Cancel"}).then(async B=>{if(B.isConfirmed)try{const P=await ue({id:p.id}).unwrap();w("success",P.message,P.description)}catch(P){w("error",P.message,P.description||"An error occurred.")}})},he=()=>{C(!0)},ge=()=>{C(!1),S(ae)},ye=p=>{C(!0),S(p)},fe=p=>{G(!0),j(p)},be=()=>{G(!1)},Te=p=>{p.task_status==="cancelled"?w("error","Error","Payment can not be updated for cancelled task."):(o(!0),S(p))},ke=p=>{o(!1)},Se=p=>{O(!0),S(p)},Ce=()=>{O(!1)},xe=p=>{H(!0),S(p)},we=()=>{H(!1)},ve=(p,B)=>{u(B),X(!0)},Ne=()=>{i(se),q(!Z),L("")},_e=()=>{q(!Z)};r.useEffect(()=>{document.title="Manage Tasks",N!=null&&N.data?(d(N.data),y(N.total),$(!1),ie(`Showing ${N==null?void 0:N.data.length} results of ${N.total}`)):$(!0),X(!1)},[N,b]);const Fe=F.filter(p=>p.description.toLowerCase().includes(_.toLowerCase())).map(({id:p,description:B,slot:P,employee_name:pt,amount:Le,status:U,payment_status:J,workflow:te,type:De},ht)=>{const x={},Ie=U.value==="pending"?"warning":U.value==="complete"?"success":"danger",Ee=J.value==="pending"?"warning":J.value==="paid"?"success":"info";return x.amount=Le,x.slot=P,x.task_status=U,x.status=e("span",{className:`text-${Ie}`,children:U.label}),x.payment_status=e("span",{className:`text-${Ee}`,children:J.label}),x.history=e("a",{onClick:()=>fe(te),style:{cursor:"pointer"},className:"text-primary","data-tooltip-id":"internet-account","data-tooltip-content":"IncomeShow this internet details",children:e("span",{className:"aside-menu-icon",children:e(ne,{icon:je})})}),x.type=De.label,x.description=B,x.id=p,x.workflow=te,x}),Pe=()=>e(Xe,{search:{filterByText:!0,placeHolderTxt:"Search Task...",searchBoxValue:_,handelSearch:L},query:v,setQuery:i,resetFilterParameter:Ne,handelFilter:_e}),Me=[{actionName:"Edit",type:"modal",route:"",actionFunction:ye,permission:"edit_task",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:Se,permission:"task_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:pe,permission:"task_delete",textClass:"text-danger"},{actionName:"Update Status",type:"modal",route:"",actionFunction:xe,permission:"task_change_status",textClass:"text-primary"},{actionName:"Update Payment",type:"modal",route:"",actionFunction:Te,permission:"task_change_payment_status",textClass:"text-info"}];return t("div",{children:[e(z,{loaderVisible:g}),e(We,{cardTitle:"List of Tasks",cardSubTitle:le,addBTN:{permission:Je("task_create"),txt:"Add New Task",icon:e(Ke,{icon:"eva:plus-fill"}),linkTo:"modal",link:he},paginations:{totalPages:de,totalCount:l,currentPage:b,handlePageChange:ve},table:{size:"small",ariaLabel:"task table",showIdColumn:s==="admin",tableColumns:ce,tableBody:{loading:n,loadingColSpan:9,rows:Fe},actionButtons:Me},filter:Pe,loading:me,loaderRow:v==null?void 0:v.limit,loaderCol:9}),K&&e(rt,{handelCloseModal:ge,title:"Add new Task",id:f.id}),I&&e(Ze,{handelCloseModal:be,workflow:W}),Q&&e(it,{handelCloseModal:Ce,element:f}),V&&e(ct,{handelCloseModal:ke,element:f}),Y&&e(dt,{handelCloseModal:we,element:f})]})}export{Yt as default};
