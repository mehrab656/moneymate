import{a as s,j as e,F as M,r as n,m as ie,S as le,a4 as ce,a5 as de,d as k}from"./index-8e1ee696.js";import{ae as E,aq as me,M as ue,ao as he,ap as I}from"./index-74298ed0.js";import{n as j}from"./AuthRoutes-2e952a6b.js";import{E as pe,a as fe}from"./ExpenseFilter-caaabd92.js";import ge from"./ExpenseForm-731fb9ff.js";import{F as be}from"./FilteredParameters-99083ecb.js";import{T as we}from"./Table-9f2e03c0.js";import{A as xe}from"./ActionButtonHelpers-3cc0c4c9.js";import{P as Ee}from"./Pagination-fd6e0edf.js";import{F as Ce}from"./Form-833e738d.js";import"./Modal-bc712426.js";import"./Tab-e8b7d17a.js";import"./CardHeaderContext-cb83d0a9.js";import"./InputGroup-ffc38a75.js";import"./WizCard-c3a4d722.js";import"./react-select.esm-c00a6ec0.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./classCallCheck-25f3f0e0.js";import"./toConsumableArray-46a81798.js";import"./Badge-ce00077f.js";import"./useControlled-c67091af.js";import"./LastPage-4ffce3d8.js";function Fe({expenses:l,isFetching:h,hasError:g,tableColumns:c,actionBtns:d,paginations:o,cardSubTitle:r}){const p=()=>{if(h)return e(M,{children:e("tr",{children:e("td",{colSpan:4,className:"text-center",children:"Loading..."})})});if(g)return e("tr",{children:e("td",{colSpan:4,className:"text-center",children:"Expense Loading Error..."})});if(l.length===0)return e("tr",{children:e("td",{colSpan:4,className:"text-center",children:"No data found..."})});if(l.length>0)return l.map((t,b)=>s("tr",{children:[e("td",{children:t==null?void 0:t.date}),e("td",{children:t==null?void 0:t.descriptions}),e("td",{children:t==null?void 0:t.amount}),e("td",{children:e(xe,{actionBtn:d,element:t})})]},`expense-row-${b}`))};return s("div",{children:[s(we,{responsive:"md",children:[e("thead",{children:s("tr",{children:[c.map(t=>e("th",{align:t.align,children:t.label},t.id)),e("th",{children:"Actions"})]})}),e("tbody",{children:p()})]}),o.totalPages>1&&s(M,{children:[e(Ee,{component:"div",count:o.totalPages,variant:"outlined",shape:"rounded",page:o.currentPage,onChange:o.handlePageChange}),e("span",{children:e("small",{className:"text-muted",children:e("i",{children:r})})})]})]})}function Se(){const[l,h]=n.useState(!1);return e("button",{className:"btn-info",onClick:async()=>{h(!0);try{const c=await ie.get("/export-expense-csv"),o=`expense-${new Date().toISOString().replace(/[-:.]/g,"")}.csv`,r=new Blob([c.data],{type:"text/csv"}),p=window.URL.createObjectURL(r),t=document.createElement("a");t.href=p,t.download=o,document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(c){console.error(c)}finally{h(!1)}},disabled:l,children:e(E,{icon:me})})}const O={start_date:"",end_date:"",categoryIDS:[],sectorIDS:[],categoryNames:[],sectorNames:[],orderBy:"",order:"",limit:""},ye=[{id:"date",label:"Date",align:"left"},{id:"descriptions",label:"Details",align:"left"},{id:"amount",label:"Amount",align:"right"}];function Je(){const[l,h]=n.useState(!1),[g,c]=n.useState([]),[d,o]=n.useState(1),[r,p]=n.useState(1),[t,b]=n.useState(!1),[ve,P]=n.useState(!1),[$,D]=n.useState(!1),[i,w]=n.useState(O),[_,x]=n.useState(!0),[H,C]=n.useState(!1),[L,Q]=n.useState(""),[F,S]=n.useState(!1),[A,y]=n.useState({id:null,user_id:null,account_id:"",amount:"",refundable_amount:"",refunded_amount:"",category_id:null,description:"",reference:"",date:"",note:"",attachment:""}),R=()=>{S(!F),x(!1)},z=a=>{y(a),b(!0)},U=()=>{b(!1)},{applicationSettings:V,userRole:q}=n.useContext(le),{num_data_per_page:v,default_currency:Y}=V;let m=1;i.limit?m=i==null?void 0:i.limit:m=v,typeof m>"u"&&(m=10),n.useEffect(()=>{v>0&&w({...i,limit:v})},[]);const G=r>0?Math.ceil(r/m):1,{data:u,isFetching:T,isError:J}=ce({currentPage:d,pageSize:m,query:i},{skip:!_},{refetchOnMountOrArgChange:$}),[K]=de();n.useEffect(()=>{document.title="Manage Expenses",u!=null&&u.data?(c(u.data),p(u.total),P(!1)):P(!0),D(!1)},[u,d]);const W=(a,N)=>{o(N),D(!0)},X=()=>{C(!0)},Z=()=>{C(!1),y({})},ee=a=>{C(!0),y(a)},te=g.filter(a=>({...a},a.description.toLowerCase().includes(L.toLowerCase()))),ae=a=>s(M,{children:[a.description.replaceAll("_"," ").toUpperCase(),e("br",{}),e("small",{children:e("a",{href:"/categories",children:a.category.label})})]}),B=te.map(a=>Object.assign({},a,{descriptions:ae(a)})),ne=[{actionName:"Edit",type:"modal",route:"",actionFunction:ee,permission:"expense_edit",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:z,permission:"expense_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:a=>{q!=="admin"?k.fire({title:"Permission Denied!",text:"Investors are not permitted to delete any data!",icon:"danger"}):k.fire({title:"Are you sure?",text:"You will not be able to recover the expense !",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(async N=>{if(N.isConfirmed)try{const f=await K({id:a.id}).unwrap();j("success",f.message,f.description)}catch(f){j("error",f.data.message,f.data.description||"An error occurred.")}})},permission:"expense_delete",textClass:"text-danger"}],se=()=>{x(!0),S(!1)},oe=()=>{w(O),x(!_)},re=()=>{S(!1)};return s("div",{children:[e(ue,{loaderVisible:T}),s("div",{className:"row mb-2",children:[e("div",{className:"col-md-4",children:e("span",{className:"page-title-header",children:"Expense Histories"})}),s("div",{className:"col-md-8 text-end",children:[s("button",{className:"btn btn-secondary btn-sm mr-2",children:[e(E,{icon:he})," Download CSV"]}),e(Se,{}),s("button",{className:"btn-sm btn-add",onClick:X,children:[e(E,{icon:I})," Add Expense"]})]})]}),s("div",{className:"row mb-2",children:[e("div",{className:"col-md-8",children:s("button",{className:"btn btn-secondary btn-sm mr-2",onClick:R,children:[e(E,{icon:I})," Filter"]})}),e("div",{className:"col-md-4",children:e(Ce.Control,{type:"text",size:"sm",value:L,onChange:a=>Q(a.target.value),placeholder:"search by key wards...",style:{textTransform:"capitalize"}})})]}),e("div",{className:"row mb-2",children:e(be,{queries:i,setQuery:w})}),e(Fe,{expenses:B,tableColumns:ye,actionBtns:ne,loading:l,paginations:{totalPages:G??0,totalCount:r,currentPage:d,handlePageChange:W},cardSubTitle:`Page-${d} (showing ${B.length} results from ${r})`,isFetching:T,hasError:J}),t&&e(pe,{handelCloseModal:U,title:"Expense Details ",data:A,currency:Y}),H&&e(ge,{handelCloseModal:Z,title:"Create New Expense",id:A.id}),F&&e(fe,{showModal:F,closeModal:re,resetFilter:oe,submitFilter:se,queryParams:i,setQueryParams:w,setHasFilter:x})]})}export{Je as default};
