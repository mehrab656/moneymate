import{r as h,j as e,a as n,C as gt,F as W,D as yt,f as ke,e as bt,E as ft,G as Ee,H as Ct,L as vt,S as xt,I as St,J as Nt,K as wt,d as X}from"./index-8e1ee696.js";import{j as Dt,b as Z,l as Pt,_ as Tt,c as Bt,m as It,M as ge,al as Me}from"./index-74298ed0.js";import{l as Ne,L as kt,g as Et,C as Mt,R as j,a as D,e as we,b as ne,n as $,G as b,B as Y,M as de,d as Ft,f as De}from"./AuthRoutes-2e952a6b.js";import{S as Lt}from"./SummeryCard-fe96b9bb.js";import{I as At}from"./Iconify-5a94efd0.js";import{C as zt}from"./CommonTable-27ef35ac.js";import{M}from"./Modal-bc712426.js";import{I}from"./InputGroup-ffc38a75.js";import{F as x}from"./Form-833e738d.js";import{T as L}from"./Typography-e228ba3d.js";import{T as w,I as ue}from"./TextField-029e5f7c.js";import{r as Fe,a as Le}from"./jsx-runtime_commonjs-proxy-221d5456.js";import{C as q,a as G}from"./CardContent-2022634c.js";import{F as me}from"./FormLabel-e3756905.js";import{S as he,O as Rt}from"./Select-2ff9a889.js";import{C as Wt}from"./Checkbox-ece7f89d.js";import{B as ae}from"./Button-0b808ca5.js";import"./Table-9f2e03c0.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./TableRow-3c1023d1.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./useControlled-c67091af.js";import"./LastPage-4ffce3d8.js";import"./useId-bebd534a.js";import"./useFormControl-e95281cb.js";import"./isMuiElement-18bae589.js";import"./utils-a73c94d0.js";import"./SwitchBase-353c16ce.js";const Ht=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],Vt=f=>{const{classes:t,inset:a,primary:E,secondary:P,dense:C}=f;return It({root:["root",a&&"inset",C&&"dense",E&&P&&"multiline"],primary:["primary"],secondary:["secondary"]},Et,t)},$t=Dt("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(f,t)=>{const{ownerState:a}=f;return[{[`& .${Ne.primary}`]:t.primary},{[`& .${Ne.secondary}`]:t.secondary},t.root,a.inset&&t.inset,a.primary&&a.secondary&&t.multiline,a.dense&&t.dense]}})(({ownerState:f})=>Z({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},f.primary&&f.secondary&&{marginTop:6,marginBottom:6},f.inset&&{paddingLeft:56})),Ot=h.forwardRef(function(t,a){const E=Pt({props:t,name:"MuiListItemText"}),{children:P,className:C,disableTypography:r=!1,inset:_=!1,primary:s,primaryTypographyProps:v,secondary:c,secondaryTypographyProps:S}=E,k=Tt(E,Ht),{dense:d}=h.useContext(kt);let u=s??P,l=c;const T=Z({},E,{disableTypography:r,inset:_,primary:!!u,secondary:!!l,dense:d}),A=Vt(T);return u!=null&&u.type!==L&&!r&&(u=e(L,Z({variant:d?"body2":"body1",className:A.primary,component:v!=null&&v.variant?void 0:"span",display:"block"},v,{children:u}))),l!=null&&l.type!==L&&!r&&(l=e(L,Z({variant:"body2",className:A.secondary,color:"text.secondary",display:"block"},S,{children:l}))),n($t,Z({className:Bt(A.root,C),ownerState:T,ref:a},k,{children:[u,l]}))}),Gt=Ot,jt=[{paymentNumber:"",paymentDate:"",amount:""}],Yt={contract_start_date:"",contract_end_date:"",rent:"",electricity_bill_month:"",internet_bill_month:""},Pe=[1,2,3,4,5,6,7,8,9,10,11,12,14,16,17,18,19,20,21,22,23,24];function Qt({handleCloseModal:f,element:t}){const[a,E]=h.useState(!1),[P,C]=h.useState(jt),[r,_]=h.useState(Yt),[s]=gt(),v=async d=>{d.preventDefault();let u=new FormData;u.append("contract_start_date",r.contract_start_date),u.append("contract_end_date",r.contract_end_date),u.append("rent",r.rent),u.append("electricity_bill_month",r.electricity_bill_month),u.append("internet_bill_month",r.internet_bill_month),P&&P.length>0&&P.forEach(l=>{u.append("payment_amount[]",l.amount),u.append("payment_date[]",l.paymentDate),u.append("payment_number[]",l.paymentNumber)});try{const l=await s({url:`/sector/update-contract/${t.id}`,formData:u}).unwrap();$("success",l==null?void 0:l.message,l==null?void 0:l.description),f()}catch(l){$("error",(l==null?void 0:l.message)||"An error occurred",(l==null?void 0:l.description)||"Please try again later.")}},c=(d,u)=>{let{name:l,value:T}=d.target;const A=[...P];A[u][l]=T,C(A)},S=d=>{C([...P,{paymentNumber:"",paymentDate:"",amount:""}])},k=d=>{const u=[...P];u.splice(d,1),C(u)};return e(W,{children:n(W,{children:[e(ge,{loaderVisible:a}),n(M,{show:!0,onHide:f,backdrop:"static",keyboard:!1,size:"lg",children:[e(M.Header,{closeButton:!0,children:e(M.Title,{children:"Extend Contract"})}),e(M.Body,{children:n(Mt,{children:[n(j,{children:[e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"current-starting-date",children:"Current Starting Date"}),e(x.Control,{type:"date",value:t.contract_start_date,disabled:!0,id:"current-starting-date","aria-describedby":"basic-addon3"})]})}),e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"new-starting-date",children:"New Starting Date"}),e(x.Control,{type:"date",id:"new-starting-date","aria-describedby":"basic-addon3",onChange:d=>{_({...r,contract_start_date:d.target.value})}})]})})]}),n(j,{children:[e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"current-starting-date",children:"Current Expire Date"}),e(x.Control,{type:"date",disabled:!0,value:t.contract_end_date,id:"current-expire-date","aria-describedby":"basic-addon3"})]})}),e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"current-expire-date",children:"New Expire Date"}),e(x.Control,{type:"date",id:"new-expire-date","aria-describedby":"basic-addon3",onChange:d=>{_({...r,contract_end_date:d.target.value})}})]})})]}),n(j,{children:[e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"current-contract-value",children:"Current Contract Value"}),e(x.Control,{type:"number",disabled:!0,value:t.rent,id:"current-contract-value","aria-describedby":"basic-addon3"})]})}),e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"new-contract-value",children:"New Contract Value"}),e(x.Control,{type:"number",id:"new-contract-value","aria-describedby":"new-contract-value",onChange:d=>{_({...r,rent:d.target.value})}})]})})]}),n(j,{children:[e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"internet-billing-mobth",children:"Generate Internet Bill for"}),n(x.Select,{size:"sm",value:r.internet_bill_month,"aria-label":"Internet Bill",onChange:d=>{_({...r,internet_bill_month:d.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Billing Month"}),Pe.map(d=>e("option",{value:d,children:d},we(8)))]})]})}),e(D,{xs:12,md:6,children:n(I,{className:"mb-3",children:[e(I.Text,{id:"internet-billing-mobth",children:"Generate Electricity Bill for"}),n(x.Select,{size:"sm",value:r.electricity_bill_month,"aria-label":"Electircity Bill",onChange:d=>{_({...r,electricity_bill_month:d.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Billing Month"}),Pe.map(d=>e("option",{value:d,children:d},we(8)))]})]})})]}),e(L,{variant:"h5",gutterBottom:!0,children:"Payment"}),P.map((d,u)=>n(j,{className:"mb-2",children:[e(D,{md:4,sm:4,children:e(w,{className:"w-100",label:"Payment Details",id:"paymentNumber",name:"paymentNumber",defaultValue:d.paymentNumber,size:"small",onChange:l=>{c(l,u)}})}),e(D,{md:3,sm:3,children:e(w,{type:"date",label:"Payment Date",id:"paymentDate",name:"paymentDate",InputLabelProps:{shrink:!0},defaultValue:d.paymentDate,size:"small",onChange:l=>{c(l,u)}})}),e(D,{md:3,sm:3,children:e(w,{label:"Payment Amount",id:"paymentAmount",name:"amount",defaultValue:d.amount,size:"small",onChange:l=>{c(l,u)}})}),e(D,{md:2,sm:2,children:n("div",{className:"add-remove-btn-grp",children:[e(ne,{className:"btn btn-sm btn-primary",onClick:S,children:"+"}),u>0&&e(ne,{className:"btn btn-sm btn-danger",onClick:()=>k(u),children:"-"})]})})]},"paymentData-"+u))]})}),n(M.Footer,{children:[e(ne,{variant:"danger",onClick:f,children:"Close"}),e(ne,{variant:"primary",onClick:d=>v(d),children:"Update"})]})]})]})})}function qt({handleCloseModal:f,element:t,currency:a}){const[E,P]=h.useState({income:0,expense:0}),{data:C,isFetching:r}=yt({id:t.id});h.useEffect(()=>{C!=null&&C.data&&P(C==null?void 0:C.data)},[C==null?void 0:C.data]);const _=s=>{let v=new Date,c=new Date(s);const S=v.getFullYear(),d=[31,S%4===0&&S%100!==0||S%400===0?29:28,31,30,31,30,31,31,30,31,30,31];let u=c.getFullYear()-S,l=c.getMonth()-v.getMonth();l<0&&(u--,l+=12);let T=c.getDate()-v.getDate();return T<0&&(l>0?l--:(u--,l=11),T+=d[v.getMonth()]),u+" Year "+l+" Months "+T+" Days."};return e(W,{children:n(M,{size:"lg",show:!0,centered:!0,onHide:f,className:"custom-modal lg",children:[e(M.Header,{closeButton:!0,children:e(M.Title,{children:e("span",{children:t==null?void 0:t.name})})}),e(M.Body,{children:e("table",{className:"table table-bordered border-primary ",children:n("tbody",{children:[n("tr",{children:[e("td",{children:e("strong",{children:"Rent"})}),e("td",{children:t==null?void 0:t.rent}),e("td",{children:e("strong",{children:"Contract Remaining"})}),e("td",{children:_(t.contract_end_date)})]}),n("tr",{children:[e("td",{children:e("strong",{children:"Contract Started"})}),e("td",{children:t==null?void 0:t.contract_start_date}),e("td",{children:e("strong",{children:"Contract End"})}),e("td",{children:t==null?void 0:t.contract_end_date})]}),n("tr",{children:[e("td",{children:e("strong",{children:"Elec. AC/No"})}),n("td",{children:[" ",t==null?void 0:t.el_acc_no]}),e("td",{children:e("strong",{children:"Business Num."})}),e("td",{children:t==null?void 0:t.el_business_acc_no})]}),n("tr",{children:[e("td",{children:e("strong",{children:"Elec. Premises"})}),n("td",{children:[" ",t==null?void 0:t.el_premises_no]}),e("td",{children:e("strong",{children:"Billing Date"})}),e("td",{children:t==null?void 0:t.el_billing_date})]}),n("tr",{children:[e("td",{children:e("strong",{children:" Electricity Note"})}),e("td",{colSpan:3,children:t==null?void 0:t.note})]}),n("tr",{children:[e("td",{children:e("strong",{children:"Internet account"})}),n("td",{children:[" ",t==null?void 0:t.internet_acc_no]}),e("td",{children:e("strong",{children:"Billing Date"})}),e("td",{children:t==null?void 0:t.internet_billing_date})]}),n("tr",{children:[e("td",{children:"Note"}),e("td",{colSpan:3,children:t==null?void 0:t.int_note})]}),n("tr",{children:[e("td",{children:e("strong",{children:"Total Income"})}),n("td",{children:[" ",a+" "+E.income]}),e("td",{children:e("strong",{children:"Total Expense"})}),e("td",{children:a+" "+E.expense})]}),(t==null?void 0:t.channels)&&(t==null?void 0:t.channels.length)>0&&e(W,{children:t==null?void 0:t.channels.map((s,v)=>n("tr",{children:[e("td",{children:e("strong",{children:"Channel Name"})}),e("td",{children:s.channel_name+"-"+s.reference_id}),e("td",{children:e("strong",{children:"Listing Date"})}),e("td",{children:s.listing_date})]},"channel-row-"+v))}),n("tr",{children:[e("th",{colSpan:3,children:"Payment No."}),e("th",{children:"Amount"})]}),(t==null?void 0:t.payments)&&(t==null?void 0:t.payments.length)>0&&(t==null?void 0:t.payments.map((s,v)=>n("tr",{children:[n("td",{colSpan:3,children:[s==null?void 0:s.payment_number,e("sub",{children:` (${s.date} - ${s.type} )`})]}),n("td",{children:[`${a} ${s==null?void 0:s.amount}`,e("sub",{style:{textDecoration:"none",float:"right",color:(s==null?void 0:s.status)==="paid"?"green":"red"},children:s==null?void 0:s.status})]})]},s.id)))]})})}),e(M.Footer,{children:e("button",{className:"btn btn-primary",onClick:f,children:"Close"})})]})})}var ye={},Ut=Me;Object.defineProperty(ye,"__esModule",{value:!0});var pe=ye.default=void 0,Jt=Ut(Fe()),Kt=Le;pe=ye.default=(0,Jt.default)((0,Kt.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddBox");var be={},Xt=Me;Object.defineProperty(be,"__esModule",{value:!0});var _e=be.default=void 0,Zt=Xt(Fe()),en=Le;_e=be.default=(0,Zt.default)((0,en.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11H7v-2h10z"}),"DoDisturbOn");const tn=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],nn=48,an=8,rn={PaperProps:{style:{maxHeight:nn*4.5+an,width:250}}},Te={name:"",payment_account_id:"",contract_start_date:"",contract_end_date:"",el_premises_no:"",el_business_acc_no:"",el_acc_no:"",el_billing_date:"",int_note:"",internet_acc_no:"",internet_billing_date:"",contract_period:6},Be=[{paymentNumber:"",paymentDate:"",amount:""}],ln=[{channel_name:"",reference_id:"",listing_date:""}];let cn=["Rent","Electricity","Internet","DTCM","Furniture","Maintenance","Cleaning","Gas","Chiller","Management","Others"];function on({handelCloseModal:f,id:t}){ke(),bt();const[a,E]=h.useState({}),[P,C]=h.useState(!1),[r,_]=h.useState(Te),[s,v]=h.useState(Be),[c,S]=h.useState(ln),[k,d]=h.useState([]),[u,l]=h.useState([]),{data:T,isFetching:A,isError:fe}=ft({id:t}),{data:H,isFetching:re,isError:Ae}=Ee({currentPage:"",pageSize:100}),[ee]=Ct();h.useEffect(()=>{T!=null&&T.data&&_(T==null?void 0:T.data),(H==null?void 0:H.data.length)>0&&l(H==null?void 0:H.data)},[T,H]);const ie=i=>{const{target:{value:m}}=i;d(typeof m=="string"?m.split(","):m)},V=i=>{const{name:m,value:o}=i.target;_({...r,[m]:o})},U=(i,m)=>{const{name:o,value:O}=i.target,p=[...s];p[m][o]=O,v(p)},Q=(i,m)=>{const{name:o,value:O}=i.target,p=[...c];p[m][o]=O,S(p)},le=()=>{v([...s,{paymentNumber:"",paymentDate:"",amount:""}])},te=()=>{S([...c,{channel_name:"",reference_id:"",listing_date:""}])},ce=i=>{const m=[...s];m.splice(i,1),v(m)},oe=i=>{const m=[...c];m.splice(i,1),S(m)},J=async(i,m)=>{i.preventDefault(),C(!0);let o=new FormData;o.append("name",r.name),o.append("payment_account_id",r.payment_account_id),o.append("contract_start_date",r.contract_start_date),o.append("contract_end_date",r.contract_end_date),o.append("el_premises_no",r.el_premises_no),o.append("el_acc_no",r.el_acc_no),o.append("el_billing_date",r.el_billing_date),o.append("el_business_acc_no",r.el_business_acc_no),o.append("internet_acc_no",r.internet_acc_no),o.append("internet_billing_date",r.internet_billing_date),o.append("int_note",r.int_note),t||o.append("contract_period",r.contract_period),!t&&s&&s.length>0&&s.forEach(p=>{o.append("payment_amount[]",p.amount),o.append("payment_date[]",p.paymentDate),o.append("payment_number[]",p.paymentNumber)}),!t&&c&&c.length>0&&c.forEach(p=>{o.append("channel_name[]",p.channel_name),o.append("reference_id[]",p.reference_id),o.append("listing_date[]",p.listing_date)}),!t&&k&&k.length>0&&k.forEach(p=>{o.append("category_name[]",p)});const O=t?`/sector/${t}`:"/sector/add";try{const p=await ee({url:O,formData:o}).unwrap();$("success",p==null?void 0:p.message,p==null?void 0:p.description),m?(_(Te),v(Be)):f()}catch(p){$("error",(p==null?void 0:p.message)||"An error occurred",(p==null?void 0:p.description)||"Please try again later.")}};return e(W,{children:n(M,{show:!0,centered:!0,onHide:f,backdrop:"static",keyboard:!1,size:"lg",children:[e(M.Header,{closeButton:!0,children:e(M.Title,{children:n("span",{children:[t?"Update":"Add"," Sector"]})})}),n(M.Body,{children:[e(ge,{loaderVisible:P}),n("div",{className:"alert alert-warning",role:"alert",children:["You need to create a bank before add a bank account, if you haven't added a bank yet, ",e(vt,{to:"/banks",children:"Click Here"})," to create a bank first."]}),e(q,{children:n(G,{children:[e(L,{variant:"h6",gutterBottom:!0,children:"Sector Information"}),e("form",{children:n(b,{container:!0,spacing:2,children:[n(b,{item:!0,xs:12,sm:3,children:[e(w,{fullWidth:!0,label:"Sector Name",variant:"outlined",name:"name",value:r.name,onChange:V,size:"small"}),(a==null?void 0:a.name)&&e("p",{className:"error-message mt-2",children:a.name[0]})]}),n(b,{item:!0,xs:12,sm:3,children:[e(w,{fullWidth:!0,label:"Contract Start Date",type:"date",variant:"outlined",name:"contract_start_date",value:r.contract_start_date,onChange:V,InputLabelProps:{shrink:!0},size:"small"}),(a==null?void 0:a.contract_start_date)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.contract_start_date[0]})]}),n(b,{item:!0,xs:12,sm:3,children:[e(w,{fullWidth:!0,label:"Contract End Date",type:"date",variant:"outlined",name:"contract_end_date",value:r.contract_end_date,onChange:V,InputLabelProps:{shrink:!0},size:"small"}),(a==null?void 0:a.contract_end_date)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.contract_end_date[0]})]}),n(b,{item:!0,xs:12,sm:3,children:[e(Y,{sx:{minWidth:120},children:n(me,{fullWidth:!0,children:[e(ue,{id:"demo-simple-select-label",children:"Payment Account"}),e(he,{labelId:"demo-simple-select-label",id:"demo-simple-select",name:"payment_account_id",value:r.payment_account_id,label:"Payment Account",onChange:V,size:"small",children:u.map((i,m)=>n(de,{value:i.id,children:[i.bank_name," - ",i.account_number]},i.id+m))})]})}),(a==null?void 0:a.contract_end_date)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.contract_end_date[0]})]})]})})]})}),e(q,{style:{marginTop:"20px"},children:n(G,{children:[e(L,{variant:"h6",gutterBottom:!0,children:"Electricity"}),e("form",{children:n(b,{container:!0,spacing:2,children:[n(b,{item:!0,xs:12,sm:3,children:[e(w,{fullWidth:!0,label:"DEWA",type:"number",variant:"outlined",name:"el_premises_no",value:r.el_premises_no,onChange:i=>_({...r,el_premises_no:i.target.value}),size:"small"}),(a==null?void 0:a.el_premises_no)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.el_premises_no[0]})]}),n(b,{item:!0,xs:12,sm:3,children:[e(w,{fullWidth:!0,label:"Business Account No",type:"number",variant:"outlined",name:"el_business_acc_no",value:r.el_business_acc_no,onChange:i=>_({...r,el_business_acc_no:i.target.value}),size:"small"}),(a==null?void 0:a.el_business_acc_no)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.el_business_acc_no[0]})]}),n(b,{item:!0,xs:12,sm:3,children:[e(w,{fullWidth:!0,label:"Account Number",variant:"outlined",type:"number",name:"el_acc_no",value:r.el_acc_no,onChange:i=>_({...r,el_acc_no:i.target.value}),size:"small"}),(a==null?void 0:a.el_acc_no)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.el_acc_no[0]})]}),n(b,{item:!0,xs:12,sm:3,children:[e(w,{fullWidth:!0,label:"Billing Date",type:"date",variant:"outlined",name:"el_billing_date",value:r.el_billing_date,onChange:i=>_({...r,el_billing_date:i.target.value}),InputLabelProps:{shrink:!0},size:"small"}),(a==null?void 0:a.el_billing_date)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.el_billing_date[0]})]})]})})]})}),e(q,{style:{marginTop:"20px"},children:n(G,{children:[e(L,{variant:"h6",gutterBottom:!0,children:"Internet"}),e("form",{children:n(b,{container:!0,spacing:2,children:[n(b,{item:!0,xs:12,sm:r.id?4:3,children:[e(w,{fullWidth:!0,label:"Account Number",variant:"outlined",name:"internet_acc_no",type:"text",value:r.internet_acc_no,onChange:i=>_({...r,internet_acc_no:i.target.value}),size:"small"}),(a==null?void 0:a.internet_acc_no)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.internet_acc_no[0]})]}),e(b,{item:!0,xs:12,sm:r.id?4:3,children:e(w,{fullWidth:!0,label:"Billing Date",type:"date",variant:"outlined",name:"internet_billing_date",value:r.internet_billing_date,onChange:i=>_({...r,internet_billing_date:i.target.value}),InputLabelProps:{shrink:!0},size:"small"})}),!r.id&&n(b,{item:!0,xs:12,sm:3,children:[e(Y,{sx:{minWidth:120},children:n(me,{fullWidth:!0,children:[e(ue,{id:"demo-simple-select-label",children:"Contract period"}),e(he,{labelId:"demo-simple-select-label",id:"demo-simple-select",name:"contract_period",value:r.contract_period,label:"Contract period",onChange:i=>_({...r,contract_period:i.target.value}),size:"small",children:tn.map(i=>e(de,{value:i,children:i},i))})]})}),(a==null?void 0:a.contract_period)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.contract_period[0]})]}),n(b,{item:!0,xs:12,sm:r.id?4:3,children:[e(w,{fullWidth:!0,label:"Note",variant:"outlined",name:"note",value:r.int_note,onChange:i=>_({...r,int_note:i.target.value}),size:"small"}),(a==null?void 0:a.int_note)&&e("p",{className:"error-message mt-2",children:a==null?void 0:a.int_note[0]})]})]})})]})}),!r.id&&n(W,{children:[e(q,{style:{marginTop:"20px"},children:n(G,{children:[e(L,{variant:"h6",gutterBottom:!0,children:"Payment"}),s.map((i,m)=>n(b,{container:!0,spacing:2,sx:{mb:2},children:[e(b,{item:!0,xs:12,sm:4,children:e(w,{fullWidth:!0,label:"Payment Number",variant:"outlined",name:"paymentNumber",value:i.paymentNumber,onChange:o=>U(o,m),size:"small"})}),e(b,{item:!0,xs:12,sm:3,children:e(w,{fullWidth:!0,label:"Payment Date",type:"date",variant:"outlined",name:"paymentDate",value:i.paymentDate,onChange:o=>U(o,m),InputLabelProps:{shrink:!0},size:"small"})}),e(b,{item:!0,xs:12,sm:3,children:e(w,{fullWidth:!0,label:"Amount",variant:"outlined",name:"amount",type:"number",value:i.amount,onChange:o=>U(o,m),size:"small"})}),n(b,{item:!0,xs:12,sm:2,children:[e(pe,{sx:{ml:2,mt:1},onClick:le}),m>0&&e(_e,{sx:{ml:2,mt:1},onClick:()=>ce(m)})]})]},m))]})}),e(q,{style:{marginTop:"20px"},children:n(G,{children:[e(L,{variant:"h6",gutterBottom:!0,children:"Associative Categories"}),n(me,{fullWidth:!0,children:[e(ue,{id:"demo-multiple-checkbox-label",children:"Associative Categories"}),e(he,{labelId:"demo-multiple-checkbox-label",id:"demo-multiple-checkbox",multiple:!0,value:k,onChange:ie,input:e(Rt,{label:" Associative Categories"}),renderValue:i=>i.join(", "),MenuProps:rn,style:{backgroundColor:"#eeeeee"},size:"small",children:cn.map(i=>n(de,{value:i,children:[e(Wt,{checked:k.indexOf(i)>-1}),e(Gt,{primary:i})]},i))})]})]})}),e(q,{style:{marginTop:"20px"},children:n(G,{children:[e(L,{variant:"h6",gutterBottom:!0,children:"Channel References"}),c.map((i,m)=>n(b,{container:!0,spacing:2,sx:{mb:2},children:[e(b,{item:!0,xs:12,sm:4,children:e(w,{fullWidth:!0,label:"Channel Name",variant:"outlined",name:"channel_name",value:i.channel_name,onChange:o=>Q(o,m),size:"small"})}),e(b,{item:!0,xs:12,sm:4,children:e(w,{fullWidth:!0,label:"Reference ID",variant:"outlined",name:"reference_id",value:i.reference_id,onChange:o=>Q(o,m),InputLabelProps:{shrink:!0},size:"small"})}),e(b,{item:!0,xs:12,sm:2,children:e(w,{fullWidth:!0,label:"Amount",variant:"outlined",name:"listing_date",type:"date",value:i.listing_date,onChange:o=>Q(o,m),InputLabelProps:{shrink:!0},size:"small"})}),n(b,{item:!0,xs:12,sm:2,children:[e(pe,{sx:{ml:2,mt:1},onClick:te}),m>0&&e(_e,{sx:{ml:2,mt:1},onClick:()=>oe(m)})]})]},m))]})})]}),n(Y,{display:"flex",justifyContent:"center",justifyItems:"center",sx:{mt:5,mb:5},children:[r.id&&e(ae,{variant:"contained",sx:{m:2},onClick:i=>J(i,!1),children:"Update"}),!r.id&&n(W,{children:[e(ae,{variant:"contained",sx:{m:2},onClick:i=>J(i,!0),children:"Create"}),e(ae,{variant:"contained",sx:{m:2},onClick:i=>J(i,!1),children:"Create & Exit"})]})]})]})]})})}function sn(f){const{query:t,setQuery:a,resetFilterParameter:E,placeHolderTxt:P}=f,[C,r]=h.useState([]),{data:_,isFetching:s,isError:v}=Ee({currentPage:"",pageSize:100});return h.useEffect(()=>{(_==null?void 0:_.data.length)>0&&r(_==null?void 0:_.data)},[_]),e(W,{children:n(G,{style:{borderBottom:"1px solid"},children:[n(j,{className:"mb-3",children:[n(D,{xs:12,md:4,children:[e(x.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Account"}),n(x.Select,{value:t.payment_account_id,"aria-label":"payment_account_id",onChange:c=>{a({...t,payment_account_id:c.target.value})},children:[e("option",{defaultValue:!0,children:"Account"}),C.length>0?C.map(({id:c,bank_name:S,account_number:k})=>e("option",{value:c,children:S+"("+k+")"},c)):e("option",{defaultValue:!0,children:"Account"})]})]}),e(D,{xs:12,md:4,children:n(x.Group,{controlId:"contract_start_date",children:[e(x.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Contract Start"}),e(x.Control,{type:"date",value:t.contract_start_date,onChange:c=>{a({...t,contract_start_date:c.target.value})}})]})}),e(D,{xs:12,md:4,children:n(x.Group,{controlId:"contract_end_date",children:[e(x.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Contract End"}),e(x.Control,{type:"date",value:t.contract_end_date,onChange:c=>{a({...t,contract_end_date:c.target.value})}})]})})]}),n(j,{children:[e(D,{xs:12,md:4,children:n(x.Group,{controlId:"search",children:[e(x.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Search"}),e(w,{sx:{textTransform:"capitalize"},size:"small",fullWidth:!0,value:t==null?void 0:t.searchTerm,onChange:c=>a({...t,searchTerm:c.target.value}),placeholder:P})]})}),n(D,{xs:12,md:2,children:[e(x.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Order By"}),n(x.Select,{value:t.orderBy,"aria-label":"Order By",onChange:c=>{a({...t,orderBy:c.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Order by"}),e("option",{value:"rent",children:"Rent"}),e("option",{value:"contract_start_date",children:"Contract ending date"}),e("option",{value:"contract_end_date",children:"Contract starting date"})]})]}),n(D,{xs:12,md:2,children:[e(x.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Order"}),n(x.Select,{"aria-label":"Order",value:t.order,onChange:c=>{a({...t,order:c.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Order"}),e("option",{value:"ASC",children:"Ascending"}),e("option",{value:"DESC",children:"Descending"})]})]}),n(D,{xs:12,md:2,children:[e(x.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Limit"}),n(x.Select,{"aria-label":"order",value:t.limit,onChange:c=>{a({...t,limit:c.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Limit"}),e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"50",children:"50"}),e("option",{value:"100",children:"100"}),e("option",{value:"500",children:"500"}),e("option",{value:"500",children:"1000"})]})]}),e(D,{xs:12,md:2,style:{display:"flex",justifyContent:"end",alignItems:"flex-end"},children:e("div",{className:"text-end",children:e("button",{className:"btn btn-warning btn-sm",type:"reset",onClick:E,children:"Reset"})})})]})]})})}const dn={contract_end_date:"",contract_start_date:"",el_acc_no:"",el_billing_date:"",el_business_acc_no:"",el_note:"",el_premises_no:"",id:null,int_note:"",internet_acc_no:"",internet_billing_date:"",name:"",payments:[]},Ie={searchTerm:"",payment_account_id:"",contract_start_date:"",contract_end_date:"",orderBy:"DESC",order:"",limit:10};function Gn(){const[f,t]=h.useState(1),[a,E]=h.useState(0),{applicationSettings:P,userRole:C,userPermission:r}=h.useContext(xt),[_,s]=h.useState([]),[v,c]=h.useState(dn),[S,k]=h.useState(Ie),[d,u]=h.useState(!1),[l,T]=h.useState(!1),[A,fe]=h.useState(""),[H,re]=h.useState(null),[Ae,ee]=h.useState(null),[ie,V]=h.useState(!1),[U,Q]=h.useState(!1),[le,te]=h.useState(!1),[ce,oe]=h.useState(""),[J,i]=h.useState(!1),[m,o]=h.useState(!1),{num_data_per_page:O,default_currency:p}=P,ze=[{id:"name",label:"Sector",align:"left"},{id:"rent",label:"Rent",align:"right"},{id:"electricity",label:"Next Electricity Bill",align:"left"},{id:"internet",label:"Next internet Bill",align:"left"},{id:"cheque",label:"Next Payment",align:"left"}],se=O,Re=Math.ceil(a/se),{data:z,isFetching:Ce}=St({currentPage:f,pageSize:se,query:S},{skip:!se,refetchOnMountOrArgChange:d}),[We]=Nt(),[He]=wt();h.useEffect(()=>{document.title="Manage Sectors",z!=null&&z.data?(s(z.data),E(z.total),te(!1),oe(`Showing ${z==null?void 0:z.data.length} results of ${z.total}`)):te(!0),u(!1)},[z,f]);const Ve=g=>{i(!0),c(g)},$e=_.filter(g=>g.name.toLowerCase().includes(S.searchTerm.toLowerCase())),Oe=async g=>{X.fire({title:"Are you sure?",text:"You will not be able to recover the sector !",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(async B=>{if(B.isConfirmed)try{const y=await He({id:g.id}).unwrap();$("success",y.message,y.description)}catch(y){$("error",y.data.message,y.data.description||"An error occurred.")}})},Ge=()=>{ee(""),re(""),T(!1)},je=(g,B)=>{t(B)},Ye=X.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:g=>{g.onmouseenter=X.stopTimer,g.onmouseleave=X.resumeTimer}}),Qe=async g=>{await X.fire({title:`${p+" "+g.amount} has already paid?`,text:"Are You sure the payment has paid!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes ! Sure",cancelButtonText:"Not Now !"}).then(async B=>{if(B.isConfirmed)try{const y=await We({paymentID:g.id}).unwrap();$("success",y==null?void 0:y.message,y==null?void 0:y.description)}catch(y){$("error",(y==null?void 0:y.message)||"An error occurred",(y==null?void 0:y.description)||"Please try again later.")}})},qe=()=>{k(Ie),o(!m)},Ue=()=>e(sn,{placeHolderTxt:"Search by name...",query:S,setQuery:k,resetFilterParameter:qe}),ve=(g,B)=>{let y="";for(let R=0;R<g.length;R++){const F=g[R];if(F.type===B&&F.status==="unpaid"){y=F.date;break}}return e("span",{className:y===""?"text-success":"text-warning",children:y===""?"All Clear":y})},xe=(g,B,y="electricity")=>{y==="electricity"?ee(B):re(B),c(g),fe(y),T(!0)},Je=(g,B,y)=>{let R=!1,F;return g.map(K=>{R||K.status==="unpaid"&&K.type==="cheque"&&(F=K,R=!0)}),F?n(W,{children:[e("span",{className:" text-"+De(F.date),children:F.date}),De(F.date)==="danger"&&e(ae,{onClick:()=>Qe(F),sx:{cursor:"pointer"},children:e("small",{children:"pay"})})]}):e("span",{className:"text-success",children:"All Paid"})},Ke=(g,B)=>e(Y,{display:"flex",children:e(Y,{sx:{ml:2},onClick:()=>xe(g,B,"electricity"),children:ve(g.payments,"electricity")})}),Xe=(g,B)=>e(Y,{display:"flex",children:e(Y,{sx:{ml:2},onClick:()=>xe(g,B,"internet"),children:ve(g.payments,"internet")})}),Ze=$e.map(({id:g,name:B,rent:y,payments:R,contract_start_date:F,contract_end_date:K,el_premises_no:ct,el_business_acc_no:ot,el_acc_no:st,el_note:dt,el_billing_date:ut,internet_acc_no:mt,internet_billing_date:ht,int_note:pt,channels:_t},Se)=>{const N={};return N.id=g,N.name=B,N.rent=y,N.contract_start_date=F,N.contract_end_date=K,N.el_premises_no=ct,N.el_business_acc_no=ot,N.el_acc_no=st,N.el_note=dt,N.el_billing_date=ut,N.internet_acc_no=mt,N.internet_billing_date=ht,N.int_note=pt,N.payments=R,N.channels=_t,N.electricity=Ke(N,Se),N.internet=Xe(N,Se),N.cheque=Je(R),N}),et=g=>{V(!0),c(g)},tt=g=>{Q(!0),c(g)},nt=()=>{Q(!1)},at=[{actionName:"Edit",type:"modal",route:"",actionFunction:et,permission:"sector_edit",textClass:"text-info"},{actionName:"Extend Contract",type:"modal",route:"",actionFunction:tt,permission:"sector_edit",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:Ve,permission:"sector_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:Oe,permission:"sector_delete",textClass:"text-danger"},{actionName:"WelcomeScreen",type:"route",route:"/manage-welcome-screen/",actionFunction:"",permission:"view_welcome_screen",textClass:"text-danger"}],rt=()=>{V(!0)},it=()=>{V(!1),c({})},lt=()=>{i(!1)};return n("div",{children:[e(ge,{loaderVisible:le}),e(zt,{cardTitle:"List of Sectors",cardSubTitle:ce,addBTN:{permission:Ft("sector_create"),txt:"New Sector",icon:e(At,{icon:"eva:plus-fill"}),linkTo:"modal",link:rt},paginations:{totalPages:Re,totalCount:a,currentPage:f,handlePageChange:je},table:{size:"small",ariaLabel:"sector table",showIdColumn:C==="admin",tableColumns:ze,tableBody:{loading:Ce,loadingColSpan:3,rows:Ze},actionButtons:at},filter:Ue,loading:Ce,loaderRow:S==null?void 0:S.limit,loaderCol:3}),ie&&e(on,{handelCloseModal:it,title:"Create New Sector",id:v.id}),U&&e(Qt,{handleCloseModal:nt,element:v}),J&&e(qt,{handleCloseModal:lt,element:v,currency:p}),A&&e(Lt,{showModal:l,handelCloseModal:Ge,data:v,currency:p,modalType:A,Toast:Ye,navigation:ke})]})}export{Gn as default};
