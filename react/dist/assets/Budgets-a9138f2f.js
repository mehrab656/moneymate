import{r as s,S as ne,e as se,j as e,a as n,F as oe,L as le,m as h,d as w}from"./index-8e1ee696.js";import{W as re}from"./WizCard-c3a4d722.js";import{M as de,ae as ce,Q as ie}from"./index-74298ed0.js";import{P as S}from"./Pagination-982a907e.js";import{S as me}from"./react-select.esm-c00a6ec0.js";import{e as I}from"./index-dc02ab6d.js";import{A as ue}from"./ActionButtonHelpers-3cc0c4c9.js";import{b as $,n as C}from"./AuthRoutes-2e952a6b.js";import{M as g}from"./Modal-bc712426.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./classCallCheck-25f3f0e0.js";import"./toConsumableArray-46a81798.js";function we(){const[x,l]=s.useState(!1),[z,j]=s.useState([]),[B,G]=s.useState(""),[d,H]=s.useState(1),[R,V]=s.useState(0),{applicationSettings:W,userRole:p}=s.useContext(ne),{num_data_per_page:Y,default_currency:E}=W,f=Y,v=Math.ceil(R/f),D=z.filter(t=>t.amount.toLowerCase().includes(B.toLowerCase())||t.budget_name.toLowerCase().includes(B.toLowerCase())),[o,Q]=s.useState({}),[q,J]=s.useState([]),[M,y]=s.useState([]),[i,A]=s.useState(null),[b,K]=s.useState(null),[F,he]=s.useState(null),O=t=>{A(t)},P=t=>{K(t)},[L,N]=s.useState(!1),[r,u]=s.useState({id:null,budget_name:"",amount:"",start_date:null,end_date:null,use_id:null});se();const X=()=>{l(!0),h.get("/expense-categories").then(({data:t})=>{J(t.categories),l(!1)}).catch(t=>{l(!1),console.error("Error loading expense categories:",t)})},_=(t,m)=>{l(!0),h.get("/budgets",{params:{page:t,pageSize:m}}).then(({data:a})=>{l(!1),j(a.data),V(a.total)}).catch(a=>{l(!1)})};s.useEffect(()=>{document.title="Manage Budget",_(d,f),X()},[d]);const Z=()=>{u({id:null,budget_name:"",amount:"",start_date:"",end_date:"",use_id:null}),y([]),Q({}),N(!0)},U=()=>{N(!1)},ee=t=>{y(t)};s.useEffect(()=>{i===null&&A(new Date)},[i]);const te=t=>{t.preventDefault(),l(!0);const m={...r,start_date:i?new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().split("T")[0]:null,end_date:b?new Date(b.getTime()-b.getTimezoneOffset()*6e4).toISOString().split("T")[0]:null,categories:M.map(a=>a.value)};r.id?h.put(`/budgets/${r.id}`,m).then(({data:a})=>{_(d,f),N(!1),u({id:null,budget_name:"",amount:"",start_date:"",end_date:"",use_id:null}),C("success",a==null?void 0:a.message,a==null?void 0:a.description),l(!1)}).catch(a=>{if(a.response){const c=a.response.data;C("error",c==null?void 0:c.message,c.description)}l(!1)}):h.post("/budgets",m).then(({data:a})=>{a&&a.status===422||(_(d,f),N(!1),u({id:null,budget_name:"",amount:"",start_date:"",end_date:"",use_id:null})),C("success",a==null?void 0:a.message,a==null?void 0:a.description),l(!1)}).catch(a=>{if(a.response){const c=a.response.data;C("error",c==null?void 0:c.message,c.description)}l(!1)})},T=t=>{H(t)},k=[];for(let t=1;t<=v;t++)k.push(e(S.Item,{active:t===d,onClick:()=>T(t),children:t},t));const ae=[{actionName:"Edit",type:"route",route:"/budget/",actionFunction:"editModal",permission:"budget_edit",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:L,permission:"budget_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:t=>{w.fire({title:"Are you sure?",text:`You will not be able to recover the budget ${t.budget_name}!`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(m=>{m.isConfirmed&&h.delete(`budgets/${t.id}`).then(()=>{_(),w.fire({title:"Deleted!",text:"Budget has been deleted.",icon:"success"})}).catch(a=>{w.fire({title:"Error!",text:"Budget could not be deleted."+a,icon:"error"})})})},permission:"budget_delete",textClass:"text-danger"}];return n(oe,{children:[e(de,{loaderVisible:x}),n("div",{className:"d-flex justify-content-between align-content-center gap-2 mb-3",children:[e("h1",{className:"title-text mb-0",children:"Budgets"}),n(le,{className:"btn-add",onClick:Z,children:[e(ce,{icon:ie})," Add New Budget"]})]}),n(re,{className:"animated fadeInDown",children:[e("div",{className:"mb-4",children:e("input",{className:"custom-form-control",type:"text",placeholder:"Search budget...",value:B,onChange:t=>G(t.target.value)})}),e("div",{className:"table-responsive-sm",children:n("table",{className:"table-bordered custom-table",children:[e("thead",{children:n("tr",{className:"text-center",children:[p==="admin"&&e("th",{children:"id"}),e("th",{children:"BUDGET NAME"}),e("th",{children:"PROPOSED AMOUNT"}),e("th",{children:"UPDATED BUDGET AMOUNT"}),e("th",{children:"BUDGET START DATE"}),e("th",{children:"BUDGET END DATE"}),p==="admin"&&e("th",{width:"20%",children:"ACTIONS"})]})}),x&&n("tbody",{children:[D.length===0,e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"Loading..."})})]}),!x&&e("tbody",{children:D.length===0?e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"No budget found"})}):D.map(t=>n("tr",{className:"text-center",children:[p==="admin"&&e("td",{children:t.id}),e("td",{children:t.budget_name}),e("td",{children:E+t.amount}),e("td",{children:E+t.updated_amount}),e("td",{children:t.start_date}),e("td",{children:t.end_date}),p==="admin"&&e("td",{children:e(ue,{actionBtn:ae,element:t})})]},t.id))})]})}),v>1&&n(S,{children:[e(S.Prev,{disabled:d===1,onClick:()=>T(d-1)}),k,e(S.Next,{disabled:d===v,onClick:()=>T(d+1)})]})]}),n(g,{show:L,centered:!0,onHide:U,className:"custom-modal",children:[e(g.Header,{closeButton:!0,children:n(g.Title,{children:[r.id&&n("span",{children:["Update Budget: ",r.budget_name]}),!r.id&&e("span",{children:"Add New Budget"})]})}),n(g.Body,{children:[n("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"budget_name",children:"Budget Name"}),e("input",{className:`custom-form-control ${o.budget_name?"has-error":""}`,value:r.budget_name,onChange:t=>u({...r,budget_name:t.target.value}),placeholder:"Budget Name"}),o.budget_name&&e("p",{className:"error-message mt-2",children:o.budget_name[0]})]}),n("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"budget_amount",children:"Budget Amount"}),e("input",{className:`custom-form-control ${o.amount?"has-error":""}`,value:r.amount,onChange:t=>u({...r,amount:t.target.value}),placeholder:"Budget Amount"}),o.amount&&e("p",{className:"error-message mt-2",children:o.amount[0]})]}),n("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"expense_categories",children:"Expense Categories"}),e(me,{isMulti:!0,value:M,options:q.map(t=>({value:t.id,label:t.name})),onChange:ee}),o.categories&&e("p",{className:"error-message mt-2",children:o.categories[0]})]}),n("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"start_date",children:"Start Date"}),e(I,{className:"custom-form-control",selected:i,onChange:O,onSelect:O,dateFormat:"yyyy-MM-dd",placeholderText:"Start Date"}),o.start_date&&e("p",{className:"error-message mt-2",children:o.start_date[0]})]}),n("div",{className:"form-group",children:[e("label",{className:"custom-form-label",htmlFor:"end_date",children:"End Date"}),e(I,{className:"custom-form-control",selected:b,onChange:P,onSelect:P,dateFormat:"yyyy-MM-dd",placeholderText:"End Date"}),o.end_date&&e("p",{className:"error-message mt-2",children:o.end_date[0]})]}),F&&e("div",{className:"text-danger mt-2 mb-3",children:F})]}),n(g.Footer,{children:[e($,{className:"btn-sm",variant:"primary",onClick:te,children:"Save"}),e($,{className:"btn-sm",variant:"secondary",onClick:U,children:"Close"})]})]})]})}export{we as default};
