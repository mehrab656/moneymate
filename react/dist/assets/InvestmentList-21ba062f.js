import{a6 as $,j as e,F as H,a as t,r as i,S as W,G as de,a7 as me,a8 as ue,L as he,a9 as pe,aa as ve,d as ge}from"./index-8e1ee696.js";import{M as q,ae as fe,at as be}from"./index-74298ed0.js";import{R as F,a as u,C as Ce,b as j,n as N,d as xe}from"./AuthRoutes-2e952a6b.js";import{I as ye}from"./Iconify-5a94efd0.js";import{C as Se}from"./CommonTable-27ef35ac.js";import{a as we}from"./CardContent-2022634c.js";import{F as a}from"./Form-833e738d.js";import{T as Ie}from"./TextField-029e5f7c.js";import{M as v}from"./Modal-bc712426.js";import{S as U}from"./react-select.esm-c00a6ec0.js";import"./ActionButtonHelpers-3cc0c4c9.js";import"./TableRow-3c1023d1.js";import"./jsx-runtime_commonjs-proxy-221d5456.js";import"./isMuiElement-18bae589.js";import"./useId-bebd534a.js";import"./useControlled-c67091af.js";import"./makeStyles-7d66d76c.js";import"./unsupportedIterableToArray-5ed4c917.js";import"./toConsumableArray-46a81798.js";import"./Typography-e228ba3d.js";import"./Collapse-bfde31ed.js";import"./Stack-7b3bc405.js";import"./Pagination-fd6e0edf.js";import"./LastPage-4ffce3d8.js";import"./FormLabel-e3756905.js";import"./utils-a73c94d0.js";import"./useFormControl-e95281cb.js";import"./Select-2ff9a889.js";import"./classCallCheck-25f3f0e0.js";function _e(m){var b;const{search:l,query:o,setQuery:h,resetFilterParameter:S,handelFilter:B}=m,{placeHolderTxt:L,searchBoxValue:c,handelSearch:g}=l,{data:f,isFetching:E,isError:A}=$({currentPage:"",pageSize:100});return e(H,{children:t(we,{style:{borderBottom:"1px solid"},children:[t(F,{className:"mb-3",children:[t(u,{xs:12,md:4,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Investor"}),t(a.Select,{value:o.investor_id,"aria-label":"Assign to",onChange:r=>{h({...o,investor_id:r.target.value})},children:[e("option",{defaultValue:!0,children:"Investor"}),((b=f==null?void 0:f.data)==null?void 0:b.length)>0?f==null?void 0:f.data.map(r=>e("option",{value:r.slug,children:r.full_name},r.slug)):e("option",{defaultValue:!0,children:"Investor"})]})]}),e(u,{xs:12,md:4,children:t(a.Group,{controlId:"from_date",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"From"}),e(a.Control,{size:"sm",type:"date",value:o.from_date,onChange:r=>{h({...o,from_date:r.target.value})}})]})}),e(u,{xs:12,md:4,children:t(a.Group,{controlId:"to_date",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"To"}),e(a.Control,{size:"sm",type:"date",value:o.to_date,onChange:r=>{h({...o,to_date:r.target.value})}})]})})]}),t(F,{children:[e(u,{xs:12,md:6,children:t(a.Group,{controlId:"search",children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Search"}),e(Ie,{sx:{textTransform:"capitalize"},size:"small",fullWidth:!0,value:c,onChange:r=>g(r.target.value),placeholder:L})]})}),t(u,{xs:12,md:2,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Order By"}),t(a.Select,{value:o.orderBy,"aria-label":"Order By",onChange:r=>{h({...o,orderBy:r.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Order by"}),e("option",{value:"investment_date",children:"Date"}),e("option",{value:"amount",children:"Amount"})]})]}),t(u,{xs:12,md:2,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Order"}),t(a.Select,{"aria-label":"Order",value:o.order,onChange:r=>{h({...o,order:r.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Order"}),e("option",{value:"ASC",children:"Ascending"}),e("option",{value:"DESC",children:"Descending"})]})]}),t(u,{xs:12,md:2,children:[e(a.Label,{style:{marginBottom:"0px"},className:"custom-form-label",children:"Limit"}),t(a.Select,{"aria-label":"order",value:o.limit,onChange:r=>{h({...o,limit:r.target.value})},children:[e("option",{defaultValue:!0,value:"",children:"Limit"}),e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"50",children:"50"}),e("option",{value:"100",children:"100"}),e("option",{value:"500",children:"500"})]})]})]})]})})}function Fe({handleCloseModal:m,element:l}){const{applicationSettings:o}=i.useContext(W),{default_currency:h}=o;return e(H,{children:t(v,{show:!0,centered:!0,onHide:m,className:"custom-modal",children:[e(v.Header,{closeButton:!0,children:e(v.Title,{children:e("span",{children:"Investment Details"})})}),e(v.Body,{children:e("table",{className:"footable table table-bordered table-striped mb-0",children:t("tbody",{children:[t("tr",{children:[e("td",{width:"50%",children:e("strong",{children:"Investor Name :"})}),e("td",{children:l==null?void 0:l.investor_name})]}),t("tr",{children:[e("td",{width:"50%",children:e("strong",{children:"Investment Amount :"})}),t("td",{children:[" ",h+" "+(l==null?void 0:l.amount)]})]}),t("tr",{children:[e("td",{width:"50%",children:e("strong",{children:"Note :"})}),e("td",{children:l==null?void 0:l.note})]}),t("tr",{children:[e("td",{width:"50%",children:e("strong",{children:"Date :"})}),e("td",{children:l==null?void 0:l.investment_date})]})]})})}),e(v.Footer,{children:e("button",{className:"btn btn-primary",onClick:m,children:"Close"})})]})})}const Ne={id:null,investor_id:null,investor:[],account_id:null,amount:"",investment_date:"",note:""};function Be({handelCloseModal:m,title:l,id:o}){const[h,S]=i.useState({}),[B,L]=i.useState(!1),[c,g]=i.useState(Ne),[f,E]=i.useState(!1),[A,b]=i.useState({});i.useState([]);const{data:r,isFetching:Q,isError:R}=$({currentPage:"",pageSize:100}),{data:y,isFetching:k,isError:V}=de({currentPage:"",pageSize:100}),{data:p,isFetching:G,isError:C}=me({id:o}),D=r==null?void 0:r.data.map(({slug:s,full_name:d})=>({value:s,label:d})),M=y==null?void 0:y.data.map(({id:s,bank_name:d,account_number:w})=>({value:s,label:d+"("+w+")"})),[z]=ue(),T=async s=>{var I,P;s.preventDefault();let d=new FormData;d.append("account_id",c.account_id),d.append("amount",c.amount),d.append("investor_id",c.investor_id),d.append("note",c.note),d.append("investment_date",c.investment_date);const w=o?`/investment/${o}`:"/investment/add";try{const n=await z({url:w,formData:d}).unwrap();N("success",n==null?void 0:n.message,n==null?void 0:n.description),m()}catch(n){n.status===406?(E(!0),b((I=n==null?void 0:n.errorData)==null?void 0:I.data)):n.status===422?(S((P=n.errorData)==null?void 0:P.errors),N("error",n==null?void 0:n.message)):(N("error",(n==null?void 0:n.message)||"An error occurred",(n==null?void 0:n.description)||"Please try again later."),S({}))}};return i.useEffect(()=>{o&&(p!=null&&p.data)&&g(p==null?void 0:p.data)},[p==null?void 0:p.data]),t(H,{children:[e(q,{loaderVisible:B}),t(v,{show:!0,onHide:m,backdrop:"static",keyboard:!1,size:"lg",children:[e(v.Header,{closeButton:!0,children:e(v.Title,{children:l.toUpperCase()})}),e(v.Body,{children:t(Ce,{children:[t("div",{className:"alert alert-warning",role:"alert",children:["If you forgot to add any INVESTOR, please Click here to add ",t(he,{className:"custom-btn btn-add",to:"",children:[e(fe,{icon:be})," Add New Investor"]}),"."]}),t(a,{children:[t(F,{children:[e(u,{xs:12,md:6,children:t(a.Group,{className:"mb-3",controlId:"investment_users",children:[e(a.Label,{children:"Investor"}),e(U,{className:"basic-single",classNamePrefix:"select",defaultValue:c.investor,isSearchable:!0,name:"investment-user",isClearable:!0,isLoading:Q,options:D,onChange:s=>{s!==null&&g({...c,investor_id:s.value})}})]})}),e(u,{xs:12,md:6,children:t(a.Group,{className:"mb-3",controlId:"bank_account",children:[e(a.Label,{children:"Bank Account"}),e(U,{className:"basic-single",classNamePrefix:"select",isSearchable:!0,name:"bank-account",isClearable:!0,isLoading:k,options:M,onChange:s=>{s!==null&&g({...c,account_id:s.value})}})]})})]}),t(F,{children:[e(u,{xs:12,md:6,lg:6,sm:12,children:t(a.Group,{className:"mb-3",controlId:"date",children:[e(a.Label,{children:"Amount(*)"}),e(a.Control,{type:"number",value:c.amount||"",onChange:s=>{g({...c,amount:s.target.value})}})]})}),e(u,{xs:12,md:6,lg:6,sm:12,children:t(a.Group,{className:"mb-3",controlId:"date",children:[e(a.Label,{children:"Date"}),e(a.Control,{type:"date",value:c.investment_date||"",onChange:s=>{g({...c,investment_date:s.target.value})}})]})})]}),e("hr",{className:"border-danger"}),e(F,{children:e(u,{xs:12,md:12,lg:12,sm:12,children:t(a.Group,{className:"mb-3",controlId:"note",children:[e(a.Label,{children:"Note"}),e(a.Control,{as:"textarea",autoFocus:!0,rows:3,value:c.note,name:"note",onChange:s=>{g({...c,note:s.target.value})}})]})})})]})]})}),t(v.Footer,{children:[e(j,{variant:"danger",onClick:m,children:"Close"}),e(j,{variant:"primary",onClick:s=>T(s),children:"Add Investment"})]})]})]})}const Y={investor_id:"",orderBy:"",order:"",limit:10,to_date:"",from_date:""};function ot(){const[m,l]=i.useState(1),[o,h]=i.useState(0),[S,B]=i.useState(""),{applicationSettings:L,userRole:c,userPermission:g}=i.useContext(W),[f,E]=i.useState([]),[A,b]=i.useState({}),[r,Q]=i.useState(!0),[R,y]=i.useState(!1),[k,V]=i.useState(!1),[p,G]=i.useState(!1),[C,D]=i.useState(Y),{num_data_per_page:M}=L,[z,T]=i.useState(!1),[s,d]=i.useState(!1),w=[{id:"investor_name",label:"Name",align:"left"},{id:"amount",label:"Amount",align:"right"},{id:"investment_date",label:"Date",align:"left"},{id:"added_by_name",label:"Added By",align:"left"}],I=Number(C.limit)>0?Number(C.limit):M||10,P=Math.ceil(o/I),{data:n,isFetching:J,isError:Le}=pe({currentPage:m,pageSize:I,query:C},{refetchOnMountOrArgChange:z}),[K]=ve(),X=x=>{ge.fire({title:"Are you sure?",text:"You will not be able to recover the investment!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(async O=>{if(O.isConfirmed)try{const _=await K({id:x.id}).unwrap();N("success",_.message,_.description)}catch(_){N("error",_.data.message,_.data.description||"An error occurred.")}})},Z=()=>{y(!0)},ee=()=>{y(!1),b({})},te=x=>{y(!0),b(x)},ae=x=>{V(!0),b(x)},ne=()=>{V(!1),b({})},re=(x,O)=>{l(O),T(!0)},oe=()=>{D(Y),d(!s)},se=()=>{d(!s)};i.useEffect(()=>{document.title="Manage Investments",n!=null&&n.data?(E(n.data),h(n.total),G(!1)):G(!0),T(!1)},[n,m]);const ie=f.filter(x=>x.investor_name.toLowerCase().includes(S.toLowerCase())),le=()=>e(_e,{search:{filterByText:!0,placeHolderTxt:"Search by name...",searchBoxValue:S,handelSearch:B},query:C,setQuery:D,resetFilterParameter:oe,handelFilter:se}),ce=[{actionName:"Edit",type:"modal",route:"",actionFunction:te,permission:"edit_investment",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:ae,permission:"investment_view",textClass:"text-warning"},{actionName:"Delete",type:"modal",route:"",actionFunction:X,permission:"investment_delete",textClass:"text-danger"}];return t("div",{children:[e(q,{loaderVisible:p}),e(Se,{cardTitle:"List of Investments",addBTN:{permission:xe("investment_create"),txt:"Add New Investment",icon:e(ye,{icon:"eva:plus-fill"}),linkTo:"modal",link:Z},paginations:{totalPages:P,totalCount:o,currentPage:m,handlePageChange:re},table:{size:"small",ariaLabel:"investment table",showIdColumn:c==="admin",tableColumns:w,tableBody:{loading:r,loadingColSpan:4,rows:ie},actionButtons:ce},filter:le,loading:J,loaderRow:C==null?void 0:C.limit,loaderCol:4}),R&&e(Be,{handelCloseModal:ee,title:"Create New Investment",id:A.id}),k&&e(Fe,{handleCloseModal:ne,element:A})]})}export{ot as default};
