import{r as l,S as V,d as C,e as W,j as e,a,m as M}from"./index-8e1ee696.js";import{P as p}from"./Pagination-982a907e.js";import{W as q}from"./WizCard-c3a4d722.js";import{M as $}from"./index-74298ed0.js";import{A as G}from"./ActionButtonHelpers-3cc0c4c9.js";import{M as m}from"./Modal-bc712426.js";import{b as F}from"./AuthRoutes-2e952a6b.js";function te(){const[f,d]=l.useState(!1),[T,B]=l.useState([]),[N,L]=l.useState(""),[o,D]=l.useState(1),[E,j]=l.useState(0),[O,g]=l.useState(!1),[b,k]=l.useState(null),[s,x]=l.useState({}),{applicationSettings:z,userRole:u}=l.useContext(V),{num_data_per_page:H,default_currency:i}=z;let n={totalRefundableAmount:0,totalRefundedAmount:0,totalRemaining:0,totalRefundedPercent:0,totalRemainingPercent:0};const S=C.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=C.stopTimer,t.onmouseleave=C.resumeTimer}}),h=H,v=Math.ceil(E/h),_=T.filter(t=>t.description.toLowerCase().includes(N.toLowerCase())||t.reference.toLowerCase().includes(N.toLowerCase())),y=()=>{g(!1)};W();const I=t=>{t.preventDefault(),d(!0);const c=new FormData;c.append("account_id",s.account.value),c.append("amount",s.amount),c.append("id",s.id),c.append("return_amount",s.return_amount),c.append("amount",s.amount),M.post(`/return/${s.id}`,c).then(({data:r})=>{g(!1),w(o,h),x(r),S.fire({icon:"success",title:r.message,text:r.description}),d(!1)}).catch(r=>{r.response&&S.fire({icon:"error",title:r.response.data.message,text:r.response.data.description}),d(!1)})},A=t=>{x(t),k(null),g(!0)},w=(t,c)=>{d(!0),M.get("/returns",{params:{page:t,pageSize:c}}).then(({data:r})=>{d(!1),B(r.data),j(r.total)}).catch(()=>{d(!1)})};l.useEffect(()=>{document.title="Market Returns",w(o,h)},[o,h]);const R=t=>{D(t)},P=[];for(let t=1;t<=v;t++)P.push(e(p.Item,{active:t===o,onClick:()=>R(t),children:t},t));const U=[{actionName:"Edit",type:"modal",route:"",actionFunction:A,permission:"return_edit",textClass:"text-info"},{actionName:"View",type:"modal",route:"",actionFunction:A,permission:"return_view",textClass:"text-warning"}];return a("div",{children:[e($,{loaderVisible:f}),e("div",{className:"col-9",children:a(q,{className:"animated fadeInDown",children:[a("div",{className:"row",children:[e("div",{className:"col-4",children:e("div",{className:"d-flex justify-content-between align-content-center gap-2 mb-3",children:e("h1",{className:"title-text mb-0",children:"Market Returns"})})}),e("div",{className:"col-8",children:e("div",{className:"mb-4",children:e("input",{className:"custom-form-control",type:"text",placeholder:"Search Returns...",value:N,onChange:t=>L(t.target.value)})})})]}),e("div",{className:"table-responsive-sm",children:a("table",{className:"table table-bordered table-responsive",children:[e("thead",{children:a("tr",{children:[u==="admin"&&e("th",{children:"id"}),e("th",{className:"text-center",children:"Date"}),e("th",{className:"text-center",children:"Description"}),e("th",{className:"text-center",children:"Refundable Amount"}),e("th",{className:"text-center",children:"Refunded Amount"}),e("th",{className:"text-center",children:"Remaining"}),u==="admin"&&e("th",{className:"text-center",children:"Action"})]})}),f&&e("tbody",{children:e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"Loading..."})})}),!f&&e("tbody",{children:_.length===0?e("tr",{children:e("td",{colSpan:6,className:"text-center",children:"No Refundable expense found"})}):_.map(t=>(n.totalRefundableAmount+=Number(parseFloat(t.refundable_amount)),n.totalRefundedAmount+=Number(parseFloat(t.refunded_amount)),n.totalRefundedPercent=Math.ceil(n.totalRefundedAmount*100/n.totalRefundableAmount),n.totalRemainingPercent=100-n.totalRefundedPercent,a("tr",{children:[u==="admin"&&e("td",{children:t.id}),e("td",{children:t.date}),e("td",{children:t.description}),e("td",{className:"text-right",children:i+" "+ +t.refundable_amount}),e("td",{className:"text-right",children:i+" "+ +t.refunded_amount}),e("td",{className:"text-right",children:i+" "+ +(t.refundable_amount-t.refunded_amount).toString()}),u==="admin"&&e("td",{children:e(G,{element:t,actionBtn:U})})]},t.id)))})]})}),v>1&&a(p,{children:[e(p.Prev,{disabled:o===1,onClick:()=>R(o-1)}),P,e(p.Next,{disabled:o===v,onClick:()=>R(o+1)})]})]})}),e("div",{className:"col-xl-3 col-md-3",children:e("div",{className:"card quater-card summery-card",children:a("div",{className:"card-block",children:[e("h6",{className:"text-muted m-b-20",children:"Summary"}),e("h4",{children:i+" "+n.totalRefundableAmount}),e("p",{className:"text-muted",children:"Total refundable amount"}),e("h5",{className:"m-t-30",children:i+" "+n.totalRefundedAmount}),a("p",{className:"text-muted",children:["Total Refunded ",e("span",{className:"f-right",children:n.totalRefundedPercent+"%"})]}),e("div",{className:"progress",children:e("div",{className:"progress-bar bg-success",style:{width:n.totalRefundedPercent+"%"}})}),e("h5",{className:"m-t-30",children:i+" "+(n.totalRefundableAmount-n.totalRefundedAmount)}),a("p",{className:"text-muted",children:["Total Remaining ",e("span",{className:"f-right",children:n.totalRemainingPercent+"%"})]}),e("div",{className:"progress",children:e("div",{className:"progress-bar bg-danger",style:{width:n.totalRemainingPercent+"%"}})})]})})}),a(m,{show:O,centered:!0,onHide:y,className:"custom-modal",children:[e(m.Header,{closeButton:!0,children:e(m.Title,{children:a("span",{children:["Update Return: ",s.reference]})})}),e(m.Body,{children:a("form",{className:"custom-form",children:[a("div",{className:"form-group",children:[e("label",{htmlFor:"expense_amount",className:"custom-form-label",children:"Expense Amount"}),e("input",{value:s.amount,className:"custom-form-control",readOnly:!0})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"refundable_amount",className:"custom-form-label",children:"Refundable Amount"}),e("input",{value:s.refundable_amount,className:"custom-form-control",readOnly:!0})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"refunded_amount",className:"custom-form-label",children:"Refunded Amount"}),e("input",{value:s.refunded_amount,className:"custom-form-control",readOnly:!0})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"return_amount",className:"custom-form-label",children:"Return Amount"}),e("input",{className:"custom-form-control",type:"number",onBlur:t=>x({...s,return_amount:parseFloat(t.target.value).toFixed(2)}),placeholder:"Return Amount"}),b&&b.type&&e("div",{className:"text-danger mt-2",children:b.type[0]})]})]})}),a(m.Footer,{children:[e(F,{className:"btn-sm",variant:"primary",onClick:I,children:"Update"}),e(F,{className:"btn-sm",variant:"secondary",onClick:y,children:"Close"})]})]})]})}export{te as default};
